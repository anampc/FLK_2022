---
title: "Carbon Chemistry analysis: seasonality and long trends - 2022"
author: "Ana Palacio-Castro"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    fig_height: 8
    fig_width: 8
    df_print: paged
    toc: yes
    toc_float: true
bibliography: packages.bib
nocite: '@*'
editor_options:
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      options(knitr.kable.NA = '',
                      rows.print=48))
```

# Libraries and settings

```{r, include=FALSE}
# Libraries
    library(plyr)
    library(tidyverse)
    library(reshape2)
    library(lubridate)
    library(knitr)
    library(dplyr)
    library(broom)

#Plots
    library(ggpubr)
    library(ggthemes)
    library(gridExtra)
    library(ggExtra)
    library(colorspace)
    
#Models     
    library(plotrix)
    library(lmodel2)    
    library(lmerTest)
    library(emmeans)
    library(effects)
    library(modelsummary) # model results in table
    # library(lsmeans) #cld functon 
    #library(jtools) # Plot modesl
    library(kableExtra) # ANOVA tables


# Interactive Maps
    library(leaflet)

# Plots
MyTheme<-theme_bw() +  
theme(legend.position="top",
          plot.background=element_blank(),
          axis.text.x = element_text(angle = 90, vjust = 0.5),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          legend.title = element_blank(),
          panel.background =element_rect(fill = NA, 
                                         color = "black"))#+
  #guides(fill=guide_legend(nrow=2,byrow=TRUE), shape=guide_legend(nrow=3,byrow=TRUE))

Season_fill<-scale_fill_manual(values =
                           c("#2b83ba", "#abdda4",
                             "#d7191c", "#fdae61"))

Season_colour<-scale_colour_manual(values =
                           c("#2b83ba", "#abdda4",
                             "#d7191c", "#fdae61"))

Zone_shapes4<- scale_shape_manual(values=c(21,23,24, 25))
Zone_shapes3<- scale_shape_manual(values=c(21,23,24))

# Region_fill<-scale_fill_manual(values =
#                            c("#663043", "#EDAB79", "#306754", "#79BAEC"))
# 
# Region_colour<-scale_colour_manual(values =
#                           c("#663043", "#EDAB79", "#306754", "#79BAEC"))

```

# 1. Import and format carbon chemistry data

```{r, include=FALSE}
# 1. Get data
  FLK.data<-read.csv("FLK_results/FLK_filtered_ve4.csv", header = T)

  FLK.data$Location<-NULL
  FLK.data$TA_0<-NULL
  FLK.data$DIC_0<-NULL
  FLK.data$nTA<-NULL
  FLK.data$nDIC<-NULL
  FLK.data$n35TA<-NULL
  FLK.data$n35DIC<-NULL
  FLK.data$Survey_design <-NULL
  FLK.data$Sample_frequency<-NULL
  FLK.data$Sample_Depth_m<-NULL
  FLK.data$Conductivity_Sm<-NULL
  FLK.data$Pressure_db<-NULL
  FLK.data$Density_Sigmat<-NULL
  #head(FLK.data)

# 2. Format variables
  # Date/times
    # Year
    FLK.data$Year<-as.numeric(FLK.data$Year)
    #summary(FLK.data$Year)

    FLK.data$Month<-factor(FLK.data$Month, 
                          levels = c("Apr", "May","Jun",
                                    "Jul", "Aug", "Sep",
                                    "Oct","Nov","Dec",
                                    "Jan", "Feb", "Mar"))
    
    FLK.data$Month2<-factor(FLK.data$Month, 
                          levels = c("Jan", "Feb", "Mar",
                                     "Apr", "May","Jun",
                                    "Jul", "Aug", "Sep",
                                    "Oct","Nov","Dec"
                                    ))
    
    summary(FLK.data$Month)
    summary(FLK.data$Month2)
    #FLK.data$Months<-months(FLK.data$ESTDate)
    FLK.data$Months<-factor(FLK.data$Months, levels = month.name)
    FLK.data$Date<-as.Date(FLK.data$Date)
    
  FLK.data$Sub_region<-factor(FLK.data$Sub_region, levels = c(
                          "BB", "UK", "MK", "LK"))
  
  FLK.data$Zone<-factor(FLK.data$Zone, levels = c(
                        "Inshore", "Mid channel", 
                        "Offshore", "Oceanic"))
  FLK.data$Reference<-factor(FLK.data$Reference, levels = c(
                        "BB_1", "BB_2", "UK_3", "UK_4", 
                        "MK_5", "MK_6", "MK_7",
                        "LK_8", "LK_9", "LK_10"))
      
  FLK.data$Season<-factor(FLK.data$Season, levels = c(
                        "Winter", "Spring", "Summer", "Fall"))
#summary(FLK.data)

# ## Seasonality (NOPE)
# -   Winter: Dec 20-March 19
# -   Spring: March 20-June 18
# -   Summer: June 19-Sep 20
# -   Fall: Sep 21-Dec 19
```

## Seasonality

-   Winter: Jan-Mar

-   Spring: Apr-Jun

-   Summer: Jul-Sep

-   Fall: Oct-Dec

-   Wet: May - October

-   Dry: November - April

# 2. Check data available

## 2.1 Locations (all samples)

```{r MapINformation, include=FALSE}
Locations <- FLK.data %>% select(Latitude,
                                Longitude, 
                                Sub_region, 
                                SiteID)
Locations<-unique(Locations)

pal.gen <- colorFactor(palette = "Set1",
                         domain = FLK.data$Zone)
```

```{r AllMap, echo=FALSE}

leaflet(FLK.data, height = '400px') %>%
  addTiles() %>%
  addProviderTiles(providers$Esri.WorldImagery)%>%
  #addProviderTiles(providers$OpenStreetMap) %>%
  #addProviderTiles("Esri.WorldGrayCanvas") %>%
  #addProviderTiles("Wikimedia") %>%
  
  #addMarkers(icon=coral.icon) %>%
  addCircleMarkers(lng = ~Longitude, lat = ~Latitude,
                   #stroke = TRUE,
                   radius = 2,
                   fillOpacity = 1,
                   color = ~pal.gen(Zone),
                   label = ~CTDID,
                   labelOptions = labelOptions(
                     noHide = F, direction = "bottom",
                     textOnly = TRUE,
                     style = list(
        "color" = "white")))  %>%
  addLegend(position = "topright",
            pal = pal.gen,
            values = ~Zone, opacity = 1) %>%
  fitBounds(lng1=-81.20, lat=26, lng2=-80.5, lat2=24)

```

**Figure Supp:** Map of the sites where individual samples were collected

**Notes:** \* Check location of individual SiteIDs

## 2.2 Average GPS point location

```{r WS.POINTS, include=FALSE}
WS.GPS.Sites <- ddply (FLK.data, .(Sub_region, Zone, SiteID),summarise,
                Lat = mean (Latitude, na.rm = T), 
                Lon = mean (Longitude, na.rm = T),
                number = n())
#write.csv(WS.GPS.Sites, "FLK_results/1_meanSatationGPS.csv")
```

Flag samples with coordinates that seem off from the permanent station

```{r}
# Coordinates<-select(FLK.data, "CTDID", "Latitude", "Longitude", "SiteID")
# Coordinates<-join(Coordinates, WS.GPS.Sites, 
#                  type = "left", by="SiteID")
# Coordinates$Lat_diff <- abs(Coordinates$Latitude-Coordinates$Lat)
# Coordinates$Lon_diff <- abs(Coordinates$Longitude-Coordinates$Lon)
# Check.coordinates1 <- Coordinates[(Coordinates$Lat_diff>0.02), ]
# Check.coordinates2 <- Coordinates[(Coordinates$Lon_diff>0.02), ]
# Check.coordinates <- rbind(Check.coordinates1, Check.coordinates2)
# Check.coordinates <- unique(Check.coordinates)
# #write.csv(Check.coordinates, "FLK_results/2_WrongGPS_points.csv", row.names=F)
```

```{r Mean.Map, include=FALSE}
# Map information
pal.gen <- colorFactor(palette = "Set1",
                         domain = WS.GPS.Sites$Zone)


# add colour label column
WS.GPS.Sites <- WS.GPS.Sites %>%
  mutate(color = case_when(
    Zone == "Inshore" ~ "red",
    Zone == "Mid channel" ~ "pink",
    Zone == "Offshore" ~ "purple",
    Zone == "Oceanic" ~ "darkblue"))

# add icon label column
WS.GPS.Sites <- WS.GPS.Sites %>%
  mutate(icon = case_when(
    Zone == "Inshore" ~ "home",
    Zone == "Mid channel" ~ "square",
    Zone == "Offshore" ~ "triangle",
    Zone == "Oceanic" ~ "home"))

# create awesome icons
my_icons <- awesomeIcons(icon = WS.GPS.Sites$icon,
                         markerColor = WS.GPS.Sites$color,
                         library = "glyphicon")

# leaflet using AwesomeMarkers
WS.GPS.Sites %>% 
  leaflet() %>% 
  addTiles() %>% 
  addAwesomeMarkers(lng = ~ Lon, lat = ~ Lat, 
                    icon = ~ my_icons[Zone])
  
```

# - Figure 1: Stations

```{r WSmap, echo=FALSE}
pal.gen <- colorFactor(c(" red", "purple", "navy", "blue"), 
                      domain = c("Inshore", "Mid channel", "Offshore", "Oceanic" ))

pal.gen <- colorFactor(c("azure", "cyan", "navy", "blue2"), 
                      domain = c("Inshore", "Mid channel", "Offshore", "Oceanic" ))

leaflet(WS.GPS.Sites, height = '900px') %>%
  addTiles() %>%
  addScaleBar(position = "topleft")%>%
  #addProviderTiles(providers$OpenStreetMap) %>%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%

  # Sub_regions
     addRectangles(
      lng1=-80.26, lat1=25.7,
      lng2=-80.02, lat2=25.25,
      opacity = 1,
      color = "black",
      #color = "#F8766D",
      weight=2,
      fillColor = "transparent",
      label = "Biscayne Bay",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                       textOnly = F))  %>%
    addRectangles(
      lng1=-80.6, lat1=25.20,
      lng2=-80.2, lat2=24.8,
      opacity = 1,
      color = "black",
      weight=2,
      fillColor = "transparent",
      label = "Upper Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                       offset = c(20, 20),
                       textOnly = F))  %>%

    addRectangles(
      lng1=-81.11, lat1=24.85,
      lng2=-80.61, lat2=24.55,
      opacity = 1,
      color = "black",
      weight=2,
      fillColor = "transparent",
      label = "Middel Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                       offset = c(15, 20),
                       textOnly = F)) %>%
    addRectangles(
      lng1=-81.88, lat1=24.34,
      lng2=-81.14, lat2=24.72,
      opacity = 1,
      color = "black",
      weight=2,
      fillColor = "transparent",
      label = "Lower Keys",
      labelOptions = labelOptions(
                       noHide = T, direction = "right",
                         offset = c(20, 45),
                       textOnly = F)) %>%
  
  #Stations
  #addAwesomeMarkers(lng = ~ Lon, lat = ~ Lat, icon = ~ my_icons[Zone])
  addCircleMarkers(lng = ~Lon, lat = ~Lat,
                   stroke = FALSE,
                   radius = 4,
                   fillOpacity = 10,
                   color = ~pal.gen(Zone),
                   label = ~SiteID,
                   labelOptions = labelOptions(
                     noHide = F, direction = "bottom",
                     textOnly = TRUE,
                     style = list(
                  "color" = "white")))  %>%

  addLegend(position = "topright",
            pal = pal.gen,
            values = ~Zone, opacity = 1) %>%
  fitBounds(lng1=-81.20, lat=25.75, lng2=-80.5, lat2=24.04)
  
```

**Figure 1: Location of the permanent sampling stations along the Florida Reef Tract.** The black boxes delimitate the biogeographical regions. The color of the stations represents their position along the shelf.

## 2.3 Number of samples

### By zone and location

```{r, echo=FALSE}
Cases_Loc_Zone<-FLK.data %>% count(Sub_region,
                                  Zone,
                                  sort = F)

Cases_Loc_Zone<-as.data.frame(Cases_Loc_Zone %>%
                   pivot_wider(names_from = Zone,
                   values_from = n))
#write.csv(Cases_Loc_Zone, "FLK_results/0_SampleS_Region_zone.csv")

kable(as.data.frame(Cases_Loc_Zone, format = "html"), 
      longtable = TRUE) %>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

### By year and sub_region

```{r, echo=FALSE}
Cases_Reg_Year<-FLK.data %>% count(Year, Sub_region, sort = F)

Cases_Reg_Year<-as.data.frame(Cases_Reg_Year %>%
    pivot_wider(names_from = Year, values_from = n))
#write.csv(Cases_Reg_Year, "FLK_results/0_SampleS_Region_Year.csv")

kable(as.data.frame(Cases_Reg_Year, format = "html"),  caption = "Samples collected each year")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

### By climatological season and region

```{r, echo=FALSE}
Cases_Reg_season<-FLK.data %>% count(Season, Sub_region, sort = T)

Cases_Reg_season<-as.data.frame(Cases_Reg_season %>%
    pivot_wider(names_from = Season, values_from = n))
#write.csv(Cases_Reg_season, "FLK_results/0_SampleS_RegionSeason.csv")

kable(as.data.frame(Cases_Reg_season, format = "html"),
      caption = "Samples collected in each season")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

### By Month-year

```{r, echo=FALSE}
Cases_Month<-FLK.data %>% count(Months,
                                Year,
                                sort = F)

Cases_Month<-as.data.frame(Cases_Month %>%
    pivot_wider(names_from = Year, values_from = n))

# Organize table
 Cases_Month<-Cases_Month %>% 
     dplyr::select(sort(names(.)))

kable(as.data.frame(Cases_Month, format = "html"), caption="Samples collected by year-month")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
#write.csv(Cases_Month, "FLK_results/SampleS_Month_Year.csv")
```

### By Season-year

```{r, echo=FALSE}
Cases_Season<-FLK.data %>% count(Season,
                                Year,
                                sort = F)

Cases_Season<-as.data.frame(Cases_Season %>%
    pivot_wider(names_from = Year, values_from = n))

# Organize table
 Cases_Season<-Cases_Season %>% 
     dplyr::select(sort(names(.)))

kable(as.data.frame(Cases_Season, format = "html"), caption="Samples collected by year-month")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
#write.csv(Cases_Season, "FLK_results/0_SampleS_Season_Year.csv")
```

### By Month-region

```{r, echo=FALSE}

Cases_Month_Location<-FLK.data %>% count(Sub_region,
                                Zone,
                                Month2, sort = F)

Cases_Month_Location<-as.data.frame(Cases_Month_Location %>%
    pivot_wider(names_from = Month2, values_from = n))
#write.csv(Cases_Month_Location, "FLK_results/0_SampleS_Monthlocation.csv")

kable(as.data.frame(Cases_Month_Location, format = "html"),
      caption="Samples collected by month-location")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

### Per station during all sampling time

```{r, echo=FALSE}
Cases_Site_FLK<-FLK.data %>% count(Year, Sub_region, Zone, SiteID, sort = F)
#Cases_Site_FLK

Cases_Site_FLK<-as.data.frame(Cases_Site_FLK %>%
    pivot_wider(names_from = Year, values_from = n))
Cases_Site_FLK<-Cases_Site_FLK %>% 
     dplyr::select(sort(names(.)))
#write.csv(Cases_Site_FLK, "FLK_results/0_SampleSiteIDFLK.csv")

kable(as.data.frame(Cases_Site_FLK, format = "html"),
      caption = "Samples collected in SiteIDs")%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

## Remove extreme events?

```{r}
# Label and filter extreme events
  FLK.data$Extreme<-as.factor(FLK.data$Extreme)
  summary(FLK.data$Extreme)
  FLK.data_filtered<-FLK.data[FLK.data$Extreme=="Normal",]
  
```

# 3. TA and DIC salinity normalization

## Salinity standardizations

1.  Uses salinity Bottle first, if not available, uses salinity from CTD

```{r}
#MeanSalinity<-mean(FLK.data[FLK.data$Zone=="Oceanic",]$BestSalinity)
MeanSalinity<-mean(FLK.data$BestSalinity)
sdSalinity<-sd(FLK.data$BestSalinity)

Sal<-paste("Mean salinity = ", round(MeanSalinity, digits=3),
           "(", round(sdSalinity, digits=3), "sd)")
Sal
```

```{r}
# TA_Sal<- ggplot(FLK.data) + MyTheme+
#   geom_point(aes (BestSalinity, TA_umol_kg, fill=Season), 
#              alpha=0.5, shape=21, size=1)+
#   geom_smooth(aes(BestSalinity, TA_umol_kg), 
#               linetype=2, method = "lm", color="black")
# 
# ggExtra::ggMarginal(
#   p = TA_Sal,
#   type = 'boxplot',
#   margins = 'both',
#   size = 5,
#   colour = 'black',
#   fill = 'gray'
# )
# 
# TA_Sal + facet_wrap(~Zone)
# TA_Sal+ facet_grid(Zone~Season)
# #TA_Sal+ facet_grid(Zone~Precipitation)
# 
# DIC_Sal<- ggplot(FLK.data) + MyTheme+
#   geom_point(aes (BestSalinity, DIC_umol_kg, fill=Season), 
#              alpha=0.5, shape=21, size=1)+
#   geom_smooth(aes(BestSalinity, DIC_umol_kg), 
#               linetype=2, method = "lm", color="black")
#   
# ggExtra::ggMarginal(
#   p = DIC_Sal,
#   type = 'boxplot',
#   margins = 'both',
#   size = 5,
#   colour = 'black',
#   fill = 'gray'
# )
# 
# DIC_Sal + facet_wrap(~Zone)
# DIC_Sal+ facet_grid(Zone~Season)
```

2.  Calculate TA intercepts

**Note: Use Model II Linear regressions!**

"For Model II regressions, neither X nor Y is an INDEPENDENT variable but both are assumed to be DEPENDENT on some other parameter which is often unknown. Neither are "controlled", both are measured, and both include some error. We do not seek an equation of how Y varies in response to a change in X, but rather we look for how they both co-vary in time or space in response to some other variable or process."

-   Use ordinary least squares (OLS)?

## All data

```{r, echo=FALSE, fig.height=4, fig.width=8}
# TA_coef <- FLK.data %>% 
#                  group_by(Region) %>%
#                  do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
#                      data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info
TA_coef <- FLK.data_filtered %>%
                group_by(Region) %>%
                do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

# TA_coef <- FLK.data[FLK.data$Zone=="Oceanic",] %>%
#                 group_by(Region) %>%
#                 do({model = lmodel2(TA_umol_kg~BestSalinity, data=.)  # model
#                     data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info

TA_coe <- lmodel2(TA_umol_kg~BestSalinity,
            data=FLK.data_filtered)
TA_coe

par(mfrow=c(1,3))
  plot(TA_coe, "OLS")
  plot(TA_coe, "MA")
  plot(TA_coe, "SMA")
par(mfrow=c(1,1))
```

## Oceanic

```{r, echo=FALSE, fig.height=4, fig.width=8}
# TA_coef <- FLK.data %>% 
#                  group_by(Region) %>%
#                  do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
#                      data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info
TA_coef <- FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",] %>%
                group_by(Region) %>%
                do({model = lm(TA_umol_kg~BestSalinity, data=.)  # model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

# TA_coef <- FLK.data[FLK.data$Zone=="Oceanic",] %>%
#                 group_by(Region) %>%
#                 do({model = lmodel2(TA_umol_kg~BestSalinity, data=.)  # model
#                     data.frame(tidy(model), # get coefficient info
#                     glance(model))})        # get model info

TA_coe <- lmodel2(TA_umol_kg~BestSalinity,
            data=FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",])
TA_coe

par(mfrow=c(1,3))
  plot(TA_coe, "OLS")
  plot(TA_coe, "MA")
  plot(TA_coe, "SMA")
par(mfrow=c(1,1))
```

3.  Calculate DIC intercepts

## All data

```{r, echo=FALSE, fig.height=4, fig.width=8}
# 3.DIC normalization to intercept  

    # DIC_coef <- FLK.data %>%
    #               group_by(Region) %>%
    #               do({model = lm(DIC_umol_kg~BestSalinity, data=.)
    #               # create model
    #               data.frame(tidy(model), # get coefficient info
    #               glance(model))})        # get model info
    
 DIC_coef <- FLK.data_filtered %>%
                  group_by(Region) %>%
                  do({model = lm(DIC_umol_kg~BestSalinity, data=.)
                  # create model
                  data.frame(tidy(model), # get coefficient info
                  glance(model))})        # get model info

  DIC_coe <- lmodel2(DIC_umol_kg~BestSalinity,
                data=FLK.data_filtered)
  DIC_coe
  
  par(mfrow=c(1,3))
    plot(DIC_coe, "OLS")
    plot(DIC_coe, "MA")
    plot(DIC_coe, "SMA")
  par(mfrow=c(1,1))
```

## Oceanic

```{r, echo=FALSE, fig.height=4, fig.width=8}
# 3.DIC normalization to intercept  

    # DIC_coef <- FLK.data %>%
    #               group_by(Region) %>%
    #               do({model = lm(DIC_umol_kg~BestSalinity, data=.)
    #               # create model
    #               data.frame(tidy(model), # get coefficient info
    #               glance(model))})        # get model info
    
 DIC_coef <- FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",] %>%
                  group_by(Region) %>%
                  do({model = lm(DIC_umol_kg~BestSalinity, data=.)
                  # create model
                  data.frame(tidy(model), # get coefficient info
                  glance(model))})        # get model info

  DIC_coe <- lmodel2(DIC_umol_kg~BestSalinity,
                data=FLK.data_filtered[FLK.data_filtered$Zone=="Oceanic",])
  DIC_coe
  
  par(mfrow=c(1,3))
    plot(DIC_coe, "OLS")
    plot(DIC_coe, "MA")
    plot(DIC_coe, "SMA")
  par(mfrow=c(1,1))
```

4.  Add TA and DIC endmembers (S=0) to data frame

```{r}
# 4. Add endmember intercepts

  TA_SO<-subset(TA_coef, term=="(Intercept)")
  TA_SO<-as.data.frame(dplyr::select(TA_SO, c(Region, estimate)))
  names(TA_SO)[2] <- "TA_0"
  
  DIC_SO<-subset(DIC_coef, term=="(Intercept)")
  DIC_SO<-as.data.frame(dplyr::select(DIC_SO, c(Region, estimate)))
  names(DIC_SO)[2] <- "DIC_0"
    
  Intercepts<-join(TA_SO, DIC_SO, by="Region", type="full")
  FLK.data<-join(FLK.data, Intercepts, by="Region", type="left")
```

5.  Normalize with (1) Friss equation and (2) mean salinity

```{r}
  # 5. endmember and salinity (mean) normalization
  FLK.data$nTA<-((
    (FLK.data$TA_umol_kg-FLK.data$TA_0)/
    FLK.data$BestSalinity)*MeanSalinity)+FLK.data$TA_0
  
  FLK.data$nDIC<-((
    (FLK.data$DIC_umol_kg-FLK.data$DIC_0)/
    FLK.data$BestSalinity)*MeanSalinity)+FLK.data$DIC_0
  
  # 2. TA and DIC 35 normalization
    FLK.data$n35TA<-(FLK.data$TA_umol_kg/FLK.data$BestSalinity)*MeanSalinity
    FLK.data$n35DIC<-(FLK.data$DIC_umol_kg/FLK.data$BestSalinity)*MeanSalinity
    # FLK.data$n35TA<-(FLK.data$TA_umol_kg/FLK.data$BestSalinity)*35
    # FLK.data$n35DIC<-(FLK.data$DIC_umol_kg/FLK.data$BestSalinity)*35
  
#write.csv(FLK.data, "FLK_results/FLK.data_filtered_normalized.csv", row.names = F)
```

6.  TA parameters to nTA (S=0)

```{r}
kable(as.data.frame(TA_coef[,1:8], format = "markdown"), 
      caption = "Table 1: TA parameters for salinity normalization with endmember S=0",
      digits = 3)%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
#write.csv(TA_coef, "TA_coef.csv")

```

```{r}
# Plot 
Normalization_plot<- ggplot(FLK.data) +
  theme_bw() +  
  theme(legend.position="bottom",
          plot.background=element_blank(),
          panel.grid.major.y = element_blank(),
          panel.grid.major.x = element_blank(),
          panel.grid.minor.x = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.box.background = element_rect(),
          legend.title = element_blank(),
          panel.background =element_rect(fill = NA, 
                                         color = "black"))+
         scale_x_continuous(limits = c(31.5, 39),
                     expand = c(0.05, 0.05),
                     breaks = seq(30, 40, 2),
                     name=expression(paste("Salinity")))

```

```{r, echo=F, fig.height=4, fig.width=8.8}
# 5. Check normalization?

nTA_Sal_F<- Normalization_plot+
  scale_y_continuous(limits = c(2000, 2800),
                      expand = c(0.05, 0.05),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  geom_point(aes (BestSalinity, TA_umol_kg),
             alpha=0.5, shape=21, size=1, fill="black")+
  geom_smooth(aes(BestSalinity, TA_umol_kg),
              linetype=1, method = "lm", color="black")+
    
  geom_point(aes (BestSalinity, nTA),
             alpha=0.5, shape=24, size=1, fill="red")+
  geom_smooth(aes(BestSalinity, nTA),
              linetype=2, color="red", method = "lm")+
  theme(legend.position = "none")
#nTA_Sal_F+facet_wrap(~Reference)

nTA_Sal_F<- ggExtra::ggMarginal(
  p = nTA_Sal_F,
  type = 'histogram',
  margins = 'x',
  size = 5,
  colour = 'black',
  fill = 'gray'
  )

nTA_Sal_S<-Normalization_plot+
  scale_y_continuous(limits = c(2000, 2800),
                     expand = c(0.05, 0.05),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  geom_point(aes (BestSalinity, TA_umol_kg),
             alpha=0.5, shape=21, size=1, fill="black")+
  geom_smooth(aes(BestSalinity, TA_umol_kg),
              linetype=1, method = "lm", color="black")+
  
  geom_point(aes (BestSalinity, n35TA),
             alpha=0.5, shape=25, size=1, fill="red")+
  geom_smooth(aes(BestSalinity, n35TA), 
              linetype=2, color="red", method = "lm")+
  theme(legend.position = "none")
#nTA_Sal_S+facet_wrap(~Reference)

nTA_Sal_S<-ggExtra::ggMarginal(
  p = nTA_Sal_S,
  type = 'boxplot',
  margins = 'x',
  size = 5,
  colour = 'black',
  fill = 'gray'
)
```

7.  DIC parameters to nDIC (S=0)

```{r}
kable(as.data.frame(DIC_coef[,1:8], format = "markdown"), 
      caption = "Table 2: DIC parameters for salinity normalization with endmember S0",
      digits = 2) %>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)

#write.csv(DIC_coef, "DIC_coef.csv")
    
```

```{r, echo=F, fig.height=8.8, fig.width=8.8}
nDIC_Sal_F<- Normalization_plot+
  scale_y_continuous(limits = c(1700, 2400),
                     expand = c(0.05, 0.05),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
  geom_point(aes (BestSalinity, DIC_umol_kg),
             alpha=0.5, shape=21, size=1, fill="black")+
  geom_smooth(aes(BestSalinity, DIC_umol_kg),
              linetype=1, method = "lm", color="black")+
    
  geom_point(aes (BestSalinity, nDIC),
             alpha=0.5, shape=24, size=1, fill="red")+
  geom_smooth(aes(BestSalinity, nDIC),
              linetype=2, color="red", method = "lm")+
  theme(legend.position = "bottom")
#nDIC_Sal_F+facet_wrap(~Reference)

nDIC_Sal_S<- Normalization_plot+
  scale_y_continuous(limits = c(1700, 2400),
                     expand = c(0.05, 0.05),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  geom_point(aes (BestSalinity, DIC_umol_kg),
             alpha=0.5, shape=21, size=1,  fill="black")+
  geom_smooth(aes(BestSalinity, DIC_umol_kg),
              linetype=1, method = "lm", color="black")+
    
  geom_point(aes (BestSalinity, n35DIC),
             alpha=0.5, shape=25, size=1,  fill="red")+
  geom_smooth(aes(BestSalinity, n35DIC),
              linetype=2, color="red", method = "lm")
#nDIC_Sal_S+facet_wrap(~Reference)
```

```{r,echo=FALSE, fig.height=8, fig.width=8}
FLK_parameters<-ggarrange(nTA_Sal_S, nTA_Sal_F,
                          nDIC_Sal_S,nDIC_Sal_F,
          labels = c("A", "B", 
                     "C", "D"),
          ncol = 2, nrow = 2, heights = c(1, 0.85))
FLK_parameters

#ggsave(file="FLK_results/Fig_S1_Normalization.svg", plot=FLK_parameters, dpi = 300, width=5, height=5)
```

**Figure Supp 1:** Overview of linear regressions of total alkalinity (TA, µmol kg−1) and dissolved inorganic carbon (DIC, µmol kg−1) as a function of salinity + Friss normalized values.

-   Original data: Black line and circles
-   Friis normalization S0 end-member: purple line and pointing up triangles
-   Mean salinity normalization: purple line and pointing down triangles

### TA vs Friss salinity normalized TA

```{r, echo=FALSE, fig.height=4, fig.width=8}
nTA_TA<- ggplot(FLK.data, aes (TA_umol_kg, nTA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                    name="nTA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                      name="TA")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

nTA_TA_ext<-nTA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#nTA_TA_ext

nTA_TA_pre<-nTA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#nTA_TA_pre

nTA_TA_plots<-ggarrange(nTA_TA_ext, nTA_TA_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nTA_TA_plots
```

**Figure Supp X:** Linear regressions of Friss normalized total alkalinity (nTA, µmol kg−1) as a function of measured Total Alcalinity (TA, µmol kg−1)

### DIC vs Friss salinity normalized DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
nDIC_DIC<- ggplot(FLK.data, aes (DIC_umol_kg, nDIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                    name="nDIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                      name="DIC")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

nDIC_DIC_ext<-nDIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#nDIC_DIC_ext

nDIC_DIC_pre<-nDIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#nDIC_DIC_pre

nDIC_DIC_plots<-ggarrange(nDIC_DIC_ext, nDIC_DIC_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nDIC_DIC_plots
```

**Figure Supp X:** Linear regressions of Friss normalized Dissolved Inorganc Carbon (nDIC, µmol kg−1) as a function of measured Dissolved Inorganc Carbon (DIC, µmol kg−1)

### TA vs Salinity normalized TA

```{r, echo=FALSE, fig.height=4, fig.width=8}
n35TA_TA<- ggplot(FLK.data, aes (TA_umol_kg, n35TA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="n35TA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="TA")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

n35TA_TA_ext<-n35TA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#n35TA_TA_ext

n35TA_TA_pre<-n35TA_TA +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#n35TA_TA_pre

n35TA_TA_plots<-ggarrange(n35TA_TA_ext, n35TA_TA_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
n35TA_TA_plots
```

**Figure Supp X:** Linear regressions of mean salinity normalized total alkalinity (n35TA, µmol kg−1) as a function of measured Total Alcalinity (TA, µmol kg−1)

### DIC vs Salinity normalized DIC

```{r, echo=FALSE, fig.height=4, fig.width=8}
n35DIC_DIC<- ggplot(FLK.data, aes (DIC_umol_kg, n35DIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                     name="n35DIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="DIC")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

n35DIC_DIC_ext<-n35DIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Extreme, shape=Zone), alpha=0.4)
#n35DIC_DIC_ext

n35DIC_DIC_pre<-n35DIC_DIC +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)
#n35DIC_DIC_pre

nDIC_DIC_plots<-ggarrange(n35DIC_DIC_ext, n35DIC_DIC_pre,
          #labels = c("", ""),
          ncol = 2, nrow = 1)
nDIC_DIC_plots
```

**Figure Supp X:** Linear regressions of mean salinity normalized Dissolved Inorganc Carbon (n35DIC, µmol kg−1) as a function of measured Dissolved Inorganc Carbon (DIC, µmol kg−1)

### Differences vs Salinity

```{r, echo=FALSE, fig.height=4, fig.width=4}
TAdiff<- ggplot(FLK.data, aes (BestSalinity, TA_umol_kg-n35TA)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="TA - n35TA") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="Salinity")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

TAdiff_pre<-TAdiff +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)

TAdiff<-ggExtra::ggMarginal(
  p = TAdiff_pre,
  type = 'boxplot',
  margins = 'both',
  size = 5,
  colour = 'black',
  fill = 'gray'
)
```

```{r, echo=FALSE, fig.height=4, fig.width=4}
DICdiff<- ggplot(FLK.data, aes (BestSalinity, DIC_umol_kg-n35DIC)) + 
  
  scale_y_continuous(#limits = c(1700,2900),
                    name="DIC - n35DIC") +
  scale_x_continuous(# limits = c(1600, 2600),
                     name="Salinity")+
  geom_smooth(method = "lm", colour="black")+
  MyTheme

DICdiff_pre<-DICdiff +
  scale_shape_manual(values=c(21,21,24, 24))+
  geom_point(aes (fill=Precipitation, shape=Zone), alpha=0.4)

DICdiff_pre<-ggExtra::ggMarginal(
  p = DICdiff_pre,
  type = 'boxplot',
  margins = 'both',
  size = 5,
  colour = 'black',
  fill = 'gray'
)

```

```{r, echo=FALSE, fig.height=4, fig.width=8}
Difference_plots<-ggarrange(TAdiff, DICdiff_pre,
          #labels = c("A", "B"),
          ncol = 2, nrow = 1)
Difference_plots
```

**Figure Supp X:** Linear regressions of (A) TA-n35TA and (B) DIC-nDIC as a function of Salinity

# 4. Endmember comparissions

```{r}
FLK.data_filtered<-FLK.data[FLK.data$Extreme=="Normal",]
```

## 4.1 TA and DIC relation

```{r}
No_ocean.data<-FLK.data[FLK.data$Zone!="Oceanic",]

TA_DIC<- ggplot(No_ocean.data, aes (DIC_umol_kg, TA_umol_kg)) +

  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  scale_x_continuous(# limits = c(1600, 2600),
                     # expand = c(0, 0),
                     # breaks = seq(1500,2600,100),
                     expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  facet_grid(Sub_region~Zone)+ MyTheme+ 
  theme(legend.position = "bottom")+
  #Season_fill+ Season_colour+
  guides(fill=guide_legend(override.aes=list(shape=21)))

```

```{r}
TA_DIC_Zone <- ddply (FLK.data[FLK.data$Extreme=="Normal", ], .(Zone),summarise,
                TAmean = mean (TA_umol_kg, na.rm = T), 
                DICmean = mean (DIC_umol_kg, na.rm = T),
                nTAmean = mean (n35TA, na.rm = T), 
                nDICmean = mean (n35DIC, na.rm = T),
                TAsd = sd (TA_umol_kg, na.rm = T), 
                DICsd = sd (DIC_umol_kg, na.rm = T),
                nTAsd = sd (n35TA, na.rm = T), 
                nDIsd = sd (n35DIC, na.rm = T))

TA_DIC_Ocean<-TA_DIC_Zone[TA_DIC_Zone$Zone=="Oceanic", ]

kable(as.data.frame(TA_DIC_Zone, format = "markdown"),
      caption = "Mean TA/DIC by zone") %>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
```

**Note: Use Model II Linear regressions!**

"For Model II regressions, neither X nor Y is an INDEPENDENT variable but both are assumed to be DEPENDENT on some other parameter which is often unknown. Neither are "controlled", both are measured, and both include some error. We do not seek an equation of how Y varies in response to a change in X, but rather we look for how they both co-vary in time or space in response to some other variable or process."

### Zone and region

```{r}
# Individual LR for each Zone and Sub_region
    
TA_DIC_coef_zone_noExtremes <- No_ocean.data[No_ocean.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

TA_DIC_coef_zone_noExtremes<-subset(TA_DIC_coef_zone_noExtremes, term!="(Intercept)")
kable(as.data.frame(TA_DIC_coef_zone_noExtremes[,1:8], 
      format = "markdown"),
      caption = "TA vs DIC equations by zone and region without extreme events",
      digits = 2)%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)


#write.csv(TA_DIC_coef_zone_noExtremes, "FLK_results/Fig_2_TA_DIC_coef_slopes_Subregion.csv", row.names = FALSE)

# Annotations for plots
  coef_zone_noExtremes<-dplyr::select(TA_DIC_coef_zone_noExtremes, 
                               c("Zone", "Sub_region", "estimate", "r.squared"))
  coef_zone_noExtremes$estimate<-round(coef_zone_noExtremes$estimate, digits=2)
  coef_zone_noExtremes$r.squared<-round(coef_zone_noExtremes$r.squared, digits=2)
```

Type II Linear regression

```{r}
TA_DIC_coef_zone_noExtII <- No_ocean.data[No_ocean.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region) %>%
                    do({model = lmodel2(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info
#TA_DIC_coef_zone_noExtII

TA_DIC_coef_zone_noExtII<-subset(TA_DIC_coef_zone_noExtII, term!="Intercept")
kable(as.data.frame(TA_DIC_coef_zone_noExtII[,1:9], 
      format = "markdown"),
      caption = "TA vs DIC equations without extreme events using type II lm",
      digits = 2)%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)

# Annotations for plots
  TA_DIC_coef_zone_noExtII<-dplyr::select(TA_DIC_coef_zone_noExtII, 
                               c("Zone", "Sub_region","method", "estimate", "r.squared"))
  TA_DIC_coef_zone_noExtII$estimate<-round(TA_DIC_coef_zone_noExtII$estimate, digits=2)
  TA_DIC_coef_zone_noExtII$r.squared<-round(TA_DIC_coef_zone_noExtII$r.squared, digits=2)

```

## 4.2 By Precipitation - Removing Extreme events

```{r}
TA_DIC_Extreme_pre<-TA_DIC + 
  geom_abline(intercept = -1700, slope=2, color="grey")+
  geom_hline (yintercept = TA_DIC_Ocean$TAmean, color="grey")+
  scale_shape_manual(values=c(24, 25, 21))+
  geom_point(data=No_ocean.data, aes (DIC_umol_kg, TA_umol_kg,
                                 fill=Precipitation, shape=Extreme),
                            alpha=0.5, size=1)+
  geom_smooth(data=No_ocean.data[No_ocean.data$Extreme=="Normal", ], 
              aes(DIC_umol_kg, TA_umol_kg), 
              method = "lm", colour="black", se=F)+
  
   geom_smooth(data=No_ocean.data[No_ocean.data$Extreme=="Normal", ], 
              aes(DIC_umol_kg, TA_umol_kg, colour=Precipitation), 
              method = "lm", se=F, size=0.5)+
  
  geom_text(data = coef_zone_noExtremes, 
            aes(x = TA_DIC_Ocean$DICmean, y = 2070,
                label = paste("Slo =", estimate,  
                              " r.sq=", r.squared)),
            size=2.5)+
  
  # geom_abline(slope = 0, intercept =TA_DIC_Ocean$TAmean, 
  #           linetype=2, colour="gray")+
  # geom_vline(xintercept = TA_DIC_Ocean$DICmean,
  #          linetype=2, colour="gray")+
  geom_point(aes(x=TA_DIC_Ocean$DICmean, y=TA_DIC_Ocean$TAmean),
             size=3, alpha=1, shape=21, fill="black")
#TA_DIC_Extreme_pre

```

<!-- **Figure 2a:** Linear regressions of total alkalinity (TA; µmol kg−1) and dissolved inorganic carbon (DIC; µmol kg−1) -->

### Zone, region and transect

```{r, fig.height=8, fig.width=8.8}
TA_DIC_reef_pre<-TA_DIC_Extreme_pre + 
  facet_grid(Zone~Reference)
#TA_DIC_reef_pre
```

<!-- **Figure Sup:** Linear regressions of total alkalinity (TA; µmol kg−1) and dissolved inorganic carbon (DIC; µmol kg−1) by reef and zone -->

```{r}
# Individual LR for each reef
TA_DIC_coef_Reef_noExtremes <- No_ocean.data[No_ocean.data$Extreme=="Normal", ] %>% 
            group_by(Zone, Sub_region, Reference, Precipitation) %>%
            do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
            data.frame(tidy(model), # get coefficient info
            glance(model))})        # get model info

TA_DIC_coef_Reef_noExtremes<-subset(TA_DIC_coef_Reef_noExtremes, term!="(Intercept)")
kable(as.data.frame(TA_DIC_coef_Reef_noExtremes[,1:11],
                      format = "markdown"),
        caption = "TA vs DIC equations by reef without extreme events per trsansec",
        digits = 2)%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
#write.csv (TA_DIC_coef_Reef_noExtremes, "FLK_results/Fig_2_TA_DIC_slopes_Reefs.csv", row.names = FALSE)
  
  
TA_DIC_coef_Reef_noExtremes <- 
  No_ocean.data[No_ocean.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Region, Sub_region, Transect, Precipitation) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info


```

```{r, fig.height=8, fig.width=4}
Slopes_reef<-subset(TA_DIC_coef_Reef_noExtremes, term!="(Intercept)")

Slope_plot<-ggplot(data=Slopes_reef, aes (x =Zone, y =estimate)) +
  MyTheme+
  scale_shape_manual(values=c(22, 23, 25))+
  geom_boxplot(aes(fill=(Precipitation)), alpha=0.5,
               position=position_dodge(width=0.3))+
  geom_point(aes(fill = factor(Precipitation)), 
              position=position_dodge(width=0.3),
             shape = 21, size=0.5)+
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("TA vs DIC slope")))+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.1),
        legend.position = "bottom")+
  #guides(fill=FALSE)+
  facet_grid(Sub_region~Region)
  # Season_fill+ Season_colour+
  # theme(legend.title = element_blank())
#Slope_plot

```

<!-- **Figure 2b:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes -->

```{r,  echo=FALSE}
FLK_slopes<-ggarrange(TA_DIC_Extreme_pre, Slope_plot,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.3))
          #nrow = 2, heights = c(4, 1.3))
FLK_slopes

#ggsave(file="FLK_results/Fig_5_FLK_slopesb.svg", plot=FLK_slopes, dpi = 300, width=7, height=7)
  
```

**Figure S9:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes per season and reef

## 4.3 By Season - Removing Extreme events

```{r, fig.height=8, fig.width=8.8}

TA_DIC_season<-TA_DIC + 
  Season_colour+ Season_fill+
  geom_abline(intercept = -1700, slope=2, color="grey")+
  geom_hline (yintercept = TA_DIC_Ocean$TAmean, color="grey")+
  scale_shape_manual(values=c(24, 25, 21))+
  geom_point(data=No_ocean.data, aes (DIC_umol_kg, TA_umol_kg,
                                 fill=Season, shape=Extreme),
                            alpha=0.5, size=1)+
  geom_smooth(data=No_ocean.data[No_ocean.data$Extreme=="Normal", ], 
              aes(DIC_umol_kg, TA_umol_kg), 
              method = "lm", colour="black", se=F)+
  
   geom_smooth(data=No_ocean.data[No_ocean.data$Extreme=="Normal", ], 
              aes(DIC_umol_kg, TA_umol_kg, colour=Season), 
              method = "lm", se=F, size=0.5)+
  
  geom_text(data = coef_zone_noExtremes, 
            aes(x = TA_DIC_Ocean$DICmean, y = 2070,
                label = paste("Slo =", estimate,  
                              " r.sq=", r.squared)),
            size=2.5)+

  geom_point(aes(x=TA_DIC_Ocean$DICmean, y=TA_DIC_Ocean$TAmean),
             size=3, alpha=1, shape=21, fill="black")
#TA_DIC_season


```

<!-- **Figure Sup:** Linear regressions of total alkalinity (TA; µmol kg−1) and dissolved inorganic carbon (DIC; µmol kg−1) by reef and zone -->

```{r}
# Individual LR for each reef
TA_DIC_coef_Season_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Sub_region, Season) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info

TA_DIC_coef_Season_noExtremes<-subset(TA_DIC_coef_Season_noExtremes, term!="(Intercept)")
kable(as.data.frame(TA_DIC_coef_Season_noExtremes[,1:11],
                      format = "markdown"),
        caption = "TA vs DIC equations by season without extreme events",
        digits = 2)%>% 
kable_styling(bootstrap_options = c("striped", "condensed", full_width = F), font_size = 11)
#write.csv (TA_DIC_coef_Season_noExtremes, "FLK_results/Fig_5_TA_DIC_slopes_Reefs.csv", row.names = FALSE)
  
  
  TA_DIC_coef_Season_noExtremes <- FLK.data[FLK.data$Extreme=="Normal", ] %>% 
                    group_by(Zone, Region, Sub_region, Season, Transect) %>%
                    do({model = lm(TA_umol_kg~DIC_umol_kg, data=.)  
                    # create model
                    data.frame(tidy(model), # get coefficient info
                    glance(model))})        # get model info


```

```{r, fig.height=8, fig.width=4}
Slopes_season<-subset(TA_DIC_coef_Season_noExtremes, term!="(Intercept)")

Slope_plot<-ggplot(data=Slopes_season, aes (x =Zone, y =estimate)) +
  MyTheme+
  Zone_shapes4+
  geom_boxplot(aes(fill=Season), alpha=0.5,
               position=position_dodge(width=0.3))+
  geom_point(aes(fill = factor(Season)), 
              position=position_dodge(width=0.3),
             shape = 21, size=0.5)+
  scale_y_continuous(#limits = c(1700,2900),
                     #expand = c(0, 0),
                     #breaks = seq(1800, 2800, 100),
                     expression(paste("TA vs DIC slope")))+
  facet_grid(Sub_region~Region)+
  Season_fill+
  Season_colour+
  guides(fill=FALSE)+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.1),
        legend.position = "bottom")
#Slope_plot

```

<!-- **Figure 2b:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes -->

```{r,  echo=FALSE}
FLK_slopes<-ggarrange(TA_DIC_season, Slope_plot,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.3))
FLK_slopes

#ggsave(file="FLK_results/Fig_5_FLK_slopes.svg", plot=FLK_slopes, dpi = 300, width=8, height=8)
  
```

**Figure 6:** TA (µmol kg−1) vs DIC (µmol kg−1) slopes per season and reef

# 5 Seasonal plots

## Data for endmember comparisons

```{r}
# Reef
  WS.reef<-subset(FLK.data, FLK.data$Zone!="Oceanic")
  WS.reef$Date<-as.Date(WS.reef$Date, "%Y-%m-%d")
  
# Open
  WS.open<-subset(FLK.data_filtered,
                  FLK.data_filtered$Zone=="Oceanic")
  WS.open$Date<-as.Date(WS.open$Date, "%Y-%m-%d")
  #summary(WS.open)
```

```{r}
# Mean ocean values by month - year 
  mean_Open_MY<- ddply (WS.open, .(MY, Month),
                            summarise,
                  OTem_my = mean (Temperature_C, na.rm = T),  
                  OSal_my = mean (BestSalinity, na.rm = T), 
                  
                  OTA_my = mean (TA_umol_kg, na.rm = T),
                  OnTA_my = mean (n35TA, na.rm = T),
                  
                  ODIC_my = mean (DIC_umol_kg, na.rm = T),
                  OnDIC_my = mean (n35DIC, na.rm = T),
                  
                  OpCO2_O = mean (pCO2_uatm , na.rm = T),
                  OpH_O = mean (pH_calculated, na.rm = T),
                  OAra_O = mean (Aragonite_Sat_W , na.rm = T)
                  )

# Mean ocean values by month
  mean_OpM <- mean_Open_MY %>%
              group_by(Month) %>%
              summarise(
                  OTem_m = mean (OTem_my, na.rm = T), 
                  OSal_m = mean (OSal_my, na.rm = T), 
                  
                  OTA_m = mean (OTA_my, na.rm = T),
                  OnTA_m = mean (OnTA_my, na.rm = T),
                  
                  OnDIC_m = mean (OnDIC_my, na.rm = T),
                  ODIC_m = mean (ODIC_my, na.rm = T),
                  
                  OpCO2_m = mean (OpCO2_O , na.rm = T),
                  OpH_m = mean (OpH_O, na.rm = T),
                  OAra_m = mean (OAra_O, na.rm = T),
                  n = n()
                  )
   #mean_OpM
  
 # Mean ocean values by year    
  mean_Op<- mean_OpM %>%
            summarise(
                  OTem = mean (OTem_m, na.rm = T), 
                  OSal  = mean (OSal_m, na.rm = T), 
                  
                  OTA = mean (OTA_m, na.rm = T),
                  OnTA = mean (OnTA_m, na.rm = T),
                  
                  OnDIC = mean (OnDIC_m, na.rm = T),
                  ODIC = mean (ODIC_m, na.rm = T),
                  
                  OpCO2 = mean (OpCO2_m, na.rm = T),
                  OpH = mean (OpH_m, na.rm = T),
                  OAra = mean (OAra_m, na.rm = T),
                  n = n()
                  )
```

## 5.1 Month raw values

## - Months stats

```{r}
Month_Stats<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region),
                            summarise,
                       
                  Tem_mean = mean (Temperature_C, na.rm = T),
                  Tem_sd = sd (Temperature_C, na.rm = T),
                  #Tem_se = std.error (Temperature_C, na.rm = T),
                  
                  Sal_mean = mean (BestSalinity, na.rm = T),
                  Sal_sd = sd (BestSalinity, na.rm = T),
                  #Sal_se = std.error (BestSalinity, na.rm = T),
                       
                  TA_mean = mean (TA_umol_kg, na.rm = T),
                  TA_sd = sd (TA_umol_kg, na.rm = T),
                  #TA_se = std.error (TA_umol_kg, na.rm = T),
                  
                  nTA_mean = mean (n35TA, na.rm = T),
                  nTA_sd = sd (n35TA, na.rm = T),
                  
                  DIC_mean = mean (DIC_umol_kg, na.rm = T),
                  DIC_sd = sd (DIC_umol_kg, na.rm = T),
                  #DIC_se = std.error (DIC_umol_kg, na.rm = T),
                  
                  nDIC_mean = mean (n35DIC, na.rm = T),
                  nDIC_sd = sd (n35DIC, na.rm = T),
                  
                  pCO2_mean = mean (pCO2_uatm , na.rm = T),
                  pCO2_sd = sd (pCO2_uatm , na.rm = T),
                  #pCO2_se = std.error (pCO2_uatm, na.rm = T),
                  
                  pH_mean = mean (pH_calculated, na.rm = T),
                  pH_sd = sd (pH_calculated, na.rm = T),
                  #pH_se = std.error (pH_calculated, na.rm = T),
                  
                  Ara_mean = mean (Aragonite_Sat_W , na.rm = T),
                  Ara_sd = sd (Aragonite_Sat_W , na.rm = T),
                  #Ara_se = std.error (Aragonite_Sat_W, na.rm = T),
                  n = n())

Month_Stats_2d<-Month_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
Month_Stats_2d

#write.csv(Month_Stats, "FLK_results/Table_S7_Month_Stats.csv", row.names = F)

```

Temp

```{r}
Month_Temp<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (Temperature_C, na.rm = T),
                  sd = sd (Temperature_C, na.rm = T))

Month_Temp<-Month_Temp %>% 
 mutate_if(is.numeric, round, digits=2)
Month_Temp$Region<-NULL

Month_Temp<-reshape(Month_Temp, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")

```

Sal

```{r}
Month_Sal<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (BestSalinity, na.rm = T),
                  sd = sd (BestSalinity, na.rm = T))

Month_Sal<-Month_Sal %>% 
 mutate_if(is.numeric, round, digits=2)
Month_Sal$Region<-NULL

Month_Sal<-reshape(Month_Sal, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

TA

```{r}
Month_TA<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (TA_umol_kg, na.rm = T),
                  sd = sd (TA_umol_kg, na.rm = T))

Month_TA<-Month_TA %>% 
 mutate_if(is.numeric, round, digits=2)
Month_TA$Region<-NULL

Month_TA<-reshape(Month_TA, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

DIC

```{r}
Month_DIC<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (DIC_umol_kg, na.rm = T),
                  sd = sd (DIC_umol_kg, na.rm = T))

Month_DIC<-Month_DIC %>% 
 mutate_if(is.numeric, round, digits=2)
Month_DIC$Region<-NULL

Month_DIC<-reshape(Month_DIC, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

pCO2

```{r}
Month_pCO2<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (pCO2_uatm , na.rm = T),
                  sd = sd (pCO2_uatm , na.rm = T))

Month_pCO2<-Month_pCO2 %>% 
 mutate_if(is.numeric, round, digits=2)
Month_pCO2$Region<-NULL

Month_pCO2<-reshape(Month_pCO2, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

pH

```{r}
Month_pH<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (pH_calculated, na.rm = T),
                  sd = sd (pH_calculated, na.rm = T))

Month_pH<-Month_pH %>% 
 mutate_if(is.numeric, round, digits=2)
Month_pH$Region<-NULL

Month_pH<-reshape(Month_pH, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

Arag

```{r}
Month_Ara<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season, Month2, Region), summarise,
                     
                  mean = mean (Aragonite_Sat_W , na.rm = T),
                  sd = sd (Aragonite_Sat_W , na.rm = T))

Month_Ara<-Month_Ara %>% 
 mutate_if(is.numeric, round, digits=2)
Month_Ara$Region<-NULL

Month_Ara<-reshape(Month_Ara, idvar = c("Sub_region", 
                                          "Season", "Month2"),
                    timevar = "Zone", direction = "wide")
```

all

```{r}
Month_Stats3<-rbind(Month_Temp, Month_Sal, Month_TA, Month_DIC, 
      Month_pCO2, Month_pH, Month_Ara)

#write.csv(Month_Stats3, "FLK_results/Table_S7_Month_Stats_wide.csv", row.names = F)

```

Seasonal range

```{r}
Seasonal_range<-ddply (Month_Stats, .(Zone, Sub_region),
                            summarise,
                  Tem_meany = mean (Tem_mean, na.rm = T),
                  Tem_sdy = sd (Tem_mean, na.rm = T),
                  Tem_max = max (Tem_mean, na.rm = T),
                  Tem_min = min (Tem_mean, na.rm = T),
                  Tem_diff = (max (Tem_mean, na.rm = T) - min (Tem_mean, na.rm = T)),
                  
                 Sal_meany = mean (Sal_mean, na.rm = T),
                 Sal_sdy = sd (Sal_mean, na.rm = T),
                 Sal_max = max (Sal_mean, na.rm = T),
                  Sal_min = min (Sal_mean, na.rm = T),
                  Sal_diff = (max (Sal_mean, na.rm = T) - min (Sal_mean, na.rm = T)),
                  
                 TA_meany = mean (TA_mean, na.rm = T),
                 TA_sdy = sd (TA_mean, na.rm = T), 
                 TA_max = max (TA_mean, na.rm = T),
                  TA_min = min (TA_mean, na.rm = T),
                  TA_diff = (max (TA_mean, na.rm = T) - min (TA_mean, na.rm = T)),
                  
                 DIC_meany = mean (DIC_mean, na.rm = T),
                  DIC_sdy = sd (DIC_mean, na.rm = T), 
                 DIC_max = max (DIC_mean, na.rm = T),
                  DIC_min = min (DIC_mean, na.rm = T),
                  DIC_diff = (max (DIC_mean, na.rm = T) - min (DIC_mean, na.rm = T)),
                  
                 pCO2_meany = mean (pCO2_mean, na.rm = T),
                 pCO2_sdy = sd (pCO2_mean, na.rm = T), 
                  pCO2_max = max (pCO2_mean, na.rm = T),
                  pCO2_min = min (pCO2_mean, na.rm = T),
                  pCO2_dif = (max (pCO2_mean, na.rm = T) - min (pCO2_mean, na.rm = T)),
                  
                 pH_meany = mean (pH_mean, na.rm = T),
                  pH_sdy = sd (pH_mean, na.rm = T), 
                 pH_max = max (pH_mean, na.rm = T),
                  pH_min = min (pH_mean, na.rm = T),
                  pH_diff = (max (pH_mean, na.rm = T) - min (pH_mean, na.rm = T)),
                  
                 Arg_meany = mean (Ara_mean, na.rm = T),
                 Arg_sdy = sd (Ara_mean, na.rm = T),  
                 Ara_max = max (Ara_mean, na.rm = T),
                  Ara_min = min (Ara_mean, na.rm = T),
                  Ara_diff = (max (Ara_mean, na.rm = T) - min (Ara_mean, na.rm = T)),
                  
                  
                  nTA_max = max (nTA_mean, na.rm = T),
                  nTA_min = min (nTA_mean, na.rm = T),
                  nTA_diff = (max (nTA_mean, na.rm = T) - min (nTA_mean, na.rm = T)),
                  
                  nDIC_max = max (nDIC_mean, na.rm = T),
                  nDIC_min = min (nDIC_mean, na.rm = T),
                  nDIC_diff = (max (nDIC_mean, na.rm = T) - min (nDIC_mean, na.rm = T)),
                  
                  n = n())

Seasonal_range<-Seasonal_range %>% 
 mutate_if(is.numeric, round, digits=2)
Seasonal_range

#Seasonal_range$pH_max_diff<-Seasonal_range$pH_max-mean()

#write.csv(Seasonal_range, "FLK_results/Table_S8_Month_mean_range.csv", row.names = F)
```

## - Month Plots

```{r}
Month_ploth<- ggplot(FLK.data) +
        MyTheme +  
        facet_grid(Sub_region~Zone)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank() )

Year_ploth<- ggplot(Month_Stats) +
        MyTheme +  
        theme(axis.title.x = element_blank(), axis.text.x=element_text(angle = 10, vjust = 0.5))+
        Season_fill+
        Season_colour+
        facet_grid(Sub_region~Region)
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        #theme(axis.title.x = element_blank() )

Month_Season_plotTA_DIC<- ggplot(FLK.data_filtered[
          FLK.data_filtered$Zone!="Oceanic",]) +
        MyTheme +  
        facet_grid(~Zone)+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        scale_x_continuous(limits = c(1,12),
                     expand = c(0.05, 0.05),
                     breaks = seq(1, 12, 1),
                     name=expression(paste("Month of the year")))+
        theme(#strip.text = element_blank(),
              legend.position = "none",
              axis.title.x = element_blank()
              )

Month_Season_plot<- ggplot(FLK.data_filtered) +
        MyTheme +  
        facet_grid(~Zone)+
        Zone_shapes4+
        #Region_fill+
        #Region_colour+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        scale_x_continuous(limits = c(1,12),
                   expand = c(0.05, 0.05),
                   breaks = seq(1, 12, 1),
                   name=expression(paste("Month of the year")))+
        theme(axis.title.x = element_blank())#,
        #       legend.position = "none")

Year_plot_2<- ggplot(Month_Stats)+
#[Month_Stats$Zone!="Oceanic",]) +
        MyTheme +  
        facet_grid(~Zone)+
        Zone_shapes4+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        #Season_fill+
        #Season_colour+
        theme(#axis.title.x = element_blank()#,
              #axis.text.y=element_blank(),
              legend.position = "bottom"
              )

Year_plot_3<- ggplot(Month_Stats, aes(fill=Sub_region, shape=Zone))+
#[Month_Stats$Zone!="Oceanic",]) +
        MyTheme +  
        Zone_shapes4+
        facet_grid(~Region)+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(#axis.title.x = element_blank()#,
              #axis.text.y=element_blank(),
              legend.position = "right",
              axis.title.x = element_blank(),
              axis.text.x = element_text(angle = 20, vjust = 0.5)
              )
```

### Temperature

```{r, echo=FALSE, fig.height=8, fig.width=8}
Temperature_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
   scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 4),  
                       expand = c(0.05, 0.05)) +
 
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=Temperature_C))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=Temperature_C, 
                                 shape=Extreme, fill=Precipitation), 
             alpha=0.8, size=1)
#Temperature_month

Tem_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0.1, 0.1)) +
    geom_boxplot(aes (x=Zone, y=Tem_mean))+
    geom_point(aes (x=Zone, y=Tem_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#Tem_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
Temperature_my<-ggarrange(Temperature_month, Tem_Y,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Temperature_my

#ggsave(file="FLK_results/Sup_Plots/Fig_S2_Temp_M.svg", plot=Temperature_my, dpi = 300, width=8, height=7)
```

**Figure Supp 2:** Temperature variation by the region and shelf position by (A) month of the year and (B) season.

```{r}
Temp_exp<- Month_Season_plot+
  geom_abline(slope = 0, intercept = mean_Op$OTem, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Temperature"~(degree*C))),
                       breaks = seq(16, 40, 2),  
                       expand = c(0.05, 0.05)) +
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=Temperature_C, colour=Sub_region),
                span=0.6, alpha=0.2, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=Temperature_C, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.3))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=Temperature_C, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.3))
    
#Temp_exp
```

### Salinity

```{r, echo=FALSE, fig.height=8, fig.width=8}
Sal_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
   scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 2),  
                       expand = c(0.05, 0.05)) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=BestSalinity))+
  
    # annotate("point",
    #        x = c(1, 4, 7, 10),
    #        y = min(FLK.data$BestSalinity))+ 

    geom_point(data=FLK.data, aes (x=Month2, y=BestSalinity, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#Sal_month

Sal_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 1),  
                       expand = c(0.05, 0.05)) +
  
    geom_boxplot(aes (x=Zone, y=Sal_mean))+
    
    geom_point(aes (x=Zone, y=Sal_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#Sal_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
Sal_my<-ggarrange(Sal_month, Sal_Y,
        labels = c("A", "B"),
        ncol = 2, nrow = 1, widths = c(4, 1.5))
Sal_my

#ggsave(file="FLK_results/Sup_Plots/Fig_S3_Sal_M.svg", plot=Sal_my, dpi = 300, width=8, height=7)

```

**Figure Supp 3:** Salinity variation by the region and shelf position by (A) month of the year and (B) season.

```{r}
Sal_exp<- Month_Season_plot+
  geom_abline(slope = 0, intercept = mean_Op$OSal, color="grey")+
   scale_y_continuous(#limits = c(15,40),
                       name=(expression("Salinity")),
                       breaks = seq(15, 40, 1),  
                       expand = c(0.05, 0.05)) +
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=BestSalinity, colour=Sub_region),
                span=0.8, alpha=0.2, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=BestSalinity, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.3))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=BestSalinity, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.3))
    
#Sal_exp
```

### TA

```{r, echo=FALSE, fig.height=7, fig.width=8}
TA_month<- Month_ploth+
   geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=TA_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=TA_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#TA_month

TA_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Zone, y=TA_mean))+
    
    geom_point(aes (x=Zone, y=TA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#TA_Y
```

```{r, echo=FALSE, fig.height=7, fig.width=8}
TA_my<-ggarrange(TA_month, TA_Y,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
TA_my

#ggsave(file="FLK_results/Sup_Plots/Fig_SX4_TA_M.svg", plot=TA_my, dpi = 300, width=8, height=7)
```

**Figure Supp XX:** Total Alkalinity (TA) variation by the region and shelf position by (A) month of the year and (B) season.

### Figure 3A

```{r}
TA_exp<- Month_Season_plot+
   geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
   scale_y_continuous(#limits = c(2100,2500),
                     expand = c(0.05, 0.05),
                     breaks = seq(2100, 2500, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=TA_umol_kg, colour=Sub_region),
                span=0.8, alpha=0.2, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=TA_umol_kg, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.3))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=TA_umol_kg, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.3))
    
#


TA_Y2<- Year_plot_2+
   geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
   scale_y_continuous(#limits = c(2150,2550),
                     expand = c(0.05, 0.05),
                     breaks = seq(2200, 2500, 50),
                    name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
   stat_summary(aes (x=Sub_region, y=TA_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2)+
   stat_summary(aes (x=Sub_region, y=TA_mean, fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=2)
#TA_Y2

TA_Y3<- Year_plot_3+
   geom_abline(slope = 0, intercept = mean_Op$OTA, color="grey")+
   scale_y_continuous(limits = c(2130,2510),
                     expand = c(0.05, 0.05),
                     breaks = seq(2100, 2500, 100),
                     name=expression(paste("TA (", mu, "mol ", kg^-1, ")")))+
  
   geom_point(data=Seasonal_range, aes (x=Zone, y=TA_max,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
   geom_point(data=Seasonal_range, aes (x=Zone, y=TA_min,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
   # geom_segment(data=Seasonal_range, 
   #              aes(   x = Zone, y = TA_min, 
   #                  xend = Zone, yend = TA_max,
   #                  colour=Sub_region),
   #              #position = position_dodge(width = 0.6), 
   #              alpha=0.3)+
   stat_summary(aes (x=Zone, y=TA_mean, colour=Sub_region),
               fun.data = "mean_sdl", fun.args = list(mult = 1),
                geom = "errorbar",  width = 0.2,
                position = position_dodge(width = 0.6))+
   stat_summary(aes (x=Zone, y=TA_mean, fill=Sub_region, shape=Zone),
                fun = "mean", 
                geom = "point", size=2,
                position = position_dodge(width = 0.6))
#TA_Y3

```

```{r, echo=FALSE, fig.height=4, fig.width=8}
TA_my2<-ggarrange(#TA_exp, TA_Y2 + theme(axis.title.y = element_blank()),
          TA_exp + theme(legend.position = "none",
                         axis.text.x = element_blank()),
          TA_Y3 + theme(legend.position = "none",
                        axis.title.x = element_blank(),
                        axis.title.y = element_blank(),
                        axis.text.x = element_blank()),
          labels = c("A", ""),
          ncol = 2, nrow = 1, widths = c(4, 1.3))
          #ncol = 1, nrow = 2, heights = c(2, 1.5))
TA_my2
```

**Figure 3A:** Total Alkalinity (TA) variation by the region and shelf position. Left: monthly mean values, Right: Yearly mean values

### nTA

```{r, echo=FALSE, fig.height=8, fig.width=8}
nTA_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OnTA, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=n35TA))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=n35TA, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nTA_month

nTA_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OnTA, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nTA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Zone, y=nTA_mean))+
    
    geom_point(aes (x=Zone, y=nTA_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#nTA_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
nTA_my<-ggarrange(nTA_month, nTA_Y,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
nTA_my
```

### DIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_month<- Month_ploth+
    geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
    scale_y_continuous(limits = c(1700,2350),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=DIC_umol_kg))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=DIC_umol_kg, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#DIC_month

DIC_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
     scale_y_continuous(limits = c(1700,2350),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Zone, y=DIC_mean))+
    
    geom_point(aes (x=Zone, y=DIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#DIC_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_my<-ggarrange(DIC_month, DIC_Y,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
DIC_my

#ggsave(file="FLK_results/Sup_Plots/Fig_SX5_DIC_M.svg", plot=DIC_my, dpi = 300, width=8, height=7)
```

**Figure Supp XX:** Disolved Inorganic Carbon (DIC) variation by the region and shelf position by (A) month of the year and (B) season.

### Figure 3B

```{r}
DIC_exp<- Month_Season_plot+
   geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
   scale_y_continuous(#limits = c(1780,2270),
                     expand = c(0.05, 0.05),
                     breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
    geom_smooth(aes (x=as.numeric(Month2),
                    y=DIC_umol_kg, colour=Sub_region),
                    span=0.8, alpha=0.2, se=F)+
   
    stat_summary(aes (x=as.numeric(Month2),
                      y=DIC_umol_kg, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width=0.2,
                position=position_dodge(width=0.3))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=DIC_umol_kg, fill=Sub_region, shape=Zone),
                size=1,
                fun = "mean", geom = "point",
                position=position_dodge(width=0.3))
#DIC_exp

DIC_Y2<- Year_plot_2+
   geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
    
   stat_summary(aes (x=Sub_region, y=DIC_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)+
   stat_summary(aes (x=Sub_region, y=DIC_mean, fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point",
                size=2)
#DIC_Y2

DIC_Y3<- Year_plot_3+
   geom_abline(slope = 0, intercept = mean_Op$ODIC, color="grey")+
   scale_y_continuous(limits = c(1820,2230),
                     expand = c(0.00, 0.00),
                     breaks = seq(1800, 2800, 100),
                     name=expression(paste("DIC (", mu, "mol ", kg^-1, ")")))+
  
   geom_point(data=Seasonal_range, aes (x=Zone, y=DIC_max,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
   geom_point(data=Seasonal_range, aes (x=Zone, y=DIC_min,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
  # geom_segment(data=Seasonal_range, 
  #               aes(   x = Zone, y = DIC_min, 
  #                   xend = Zone, yend = DIC_max,
  #                   colour=Sub_region),
  #               #position = position_dodge(width = 0.6), 
  #               alpha=0.3)+
   stat_summary(aes (x=Zone, y=DIC_mean, colour=Sub_region),
               fun.data = "mean_sdl", fun.args = list(mult = 1),
                geom = "errorbar",  width = 0.2,
                position = position_dodge(width = 0.6))+
  stat_summary(aes (x=Zone, y=DIC_mean, fill=Sub_region, shape=Zone),
                fun = "mean", 
                geom = "point", size=2,
                position = position_dodge(width = 0.6))
#DIC_Y3

```

```{r, echo=FALSE, fig.height=4, fig.width=8}
# DIC_my2<-ggarrange(DIC_exp, DIC_Y2 + theme(axis.title.y = element_blank()),
#           labels = c("B", ""),
#           ncol = 2, nrow = 1, widths = c(4, 1.5))
# DIC_my2

DIC_my2<-ggarrange(#TA_exp, TA_Y2 + theme(axis.title.y = element_blank()),
          DIC_exp + theme(legend.position = "none",
                         axis.text.x = element_blank(),
                         strip.text.x = element_blank()),
          DIC_Y3 + theme(legend.position = "none",
                        axis.title.x = element_blank(),
                        axis.title.y = element_blank(),
                        axis.text.x = element_blank(),
                        strip.text.x = element_blank()),
          labels = c("B", ""),
          ncol = 2, nrow = 1, widths = c(4, 1.3))
          #ncol = 1, nrow = 2, heights = c(2, 1.5))
DIC_my2
```

**Figure 3B:** Dissolved Inorganic Carbon (DIC) by the region and shelf position. Left: monthly mean values, Right: Yearly mean values

### nDIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
nDIC_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=n35DIC))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=n35DIC, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#nDIC_month

nDIC_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OnDIC, color="grey")+
     scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste("nDIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(aes (x=Zone, y=nDIC_mean))+
    
    geom_point(aes (x=Zone, y=nDIC_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#nDIC_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
nDIC_my<-ggarrange(nDIC_month, nDIC_Y,
          #labels = c("DIC Friss regresion", "TA Friss regresion"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
nDIC_my
```

### pCO2

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_month<- Month_ploth+
     geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
   scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(200, 600, 100),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=pCO2_uatm))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=pCO2_uatm, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pCO2_month

pCO2_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(200, 600, 100),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Zone, y=pCO2_mean))+
    
    geom_point(aes (x=Zone, y=pCO2_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#pCO2_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_my<-ggarrange(pCO2_month, pCO2_Y,
         labels = c("A", "B"),
         ncol = 2, nrow = 1, widths = c(4, 1.5))
pCO2_my

#ggsave(file="FLK_results/Sup_Plots/Fig_S6_pCO2_M.svg", plot=DIC_my, dpi = 300, width=8, height=7)
```

**Figure Supp 6:** pCO2 variation by the region and shelf position by (A) month of the year and (B) season.

```{r}
pCO2_exp<- Month_Season_plot+
   geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
     scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(200, 600, 100),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=pCO2_uatm, colour=Sub_region),
                span=0.8, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=pCO2_uatm, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
     stat_summary(aes (x=as.numeric(Month2), 
                      y=pCO2_uatm, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))
#pCO2_exp

pCO2_Y2<- Year_plot_2+
  geom_abline(slope = 0, intercept = mean_Op$OpCO2, color="grey")+
  scale_y_continuous(#limits = c(1,5.5),
                       name=expression(paste(pCO[2], 
                                             " (", mu, " atm)")),
                       breaks = seq(200, 600, 50),
                       expand = c(0.05, 0.05)
                        ) +
    
   stat_summary(aes (x=Sub_region, y=pCO2_mean, fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=2)+
  stat_summary(aes (x=Sub_region, y=pCO2_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#pCO2_Y2

```

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_Y2b<-ggarrange(pCO2_exp + theme(legend.position = "none"),
                    pCO2_Y2,
          labels = c("A", "B"),
          ncol = 1, nrow = 2, heights = c(2, 1.5))
pCO2_Y2b
```

### pH

```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_month<- Month_ploth +
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (pH[calculated])),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=pH_calculated))+
    
    geom_point(data=FLK.data, aes (x=Month2, y=pH_calculated, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)+
  facet_grid(Sub_region~Zone)
#pH_month

pH_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (pH[calculated])),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Zone, y=pH_mean))+
    
    geom_point(aes (x=Zone, y=pH_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#pH_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_my<-ggarrange(pH_month, pH_Y,
        labels = c("A", "B"),
        ncol = 2, nrow = 1, widths = c(4, 1.5))
pH_my

#ggsave(file="FLK_results/Sup_Plots/Fig_S7_pH_M.svg", plot=pH_my, dpi = 300, width=8, height=7)
```

**Figure Supp 7:** pH variation by the region and shelf position by (A) month of the year and (B) season.

```{r}
pH_exp<- Month_Season_plot+
    geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(7.88,8.25),
                       name=(expression (pH)),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.02, 0)
                        ) +
    
    geom_smooth(aes (x=as.numeric(Month2),
                      y=pH_calculated, colour=Sub_region),
                span=0.8, se=F)+
    
    stat_summary(aes (x=as.numeric(Month2),
                      y=pH_calculated, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
     stat_summary(aes (x=as.numeric(Month2), 
                      y=pH_calculated, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))
#pH_exp

pH_Y2<- Year_plot_2+
  geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (pH[calculated])),
                       breaks = seq(0, 9, 0.05),
                       expand = c(0.05, 0.05)
                        ) +
    
   stat_summary(aes (x=Sub_region, y=pH_mean, fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=2)+
    stat_summary(aes (x=Sub_region, y=pH_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#pH_Y2

pH_Y3<- Year_plot_3+
   geom_abline(slope = 0, intercept = mean_Op$OpH, color="grey")+
   scale_y_continuous(limits = c(7.87,8.22),
                       name=(expression (pH)),
                       breaks = seq(0, 9, 0.1),
                       expand = c(0.02, 0)
                        )+
  
   geom_point(data=Seasonal_range, aes (x=Zone, y=pH_max,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1, 
              position = position_dodge(width = 0.6))+
   geom_point(data=Seasonal_range, aes (x=Zone, y=pH_min, 
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
   # geom_segment(data=Seasonal_range, 
   #              aes(   x = Zone, y = pH_min, 
   #                  xend = Zone, yend = pH_max,
   #                  colour=Sub_region),
   #              #position = position_dodge(width = 0.6), 
   #              alpha=0.3)+
   stat_summary(aes (x=Zone, y=pH_mean, colour=Sub_region),
               fun.data = "mean_sdl", fun.args = list(mult = 1),
                geom = "errorbar",  width = 0.2,
                position = position_dodge(width = 0.6))+
  stat_summary(aes (x=Zone, y=pH_mean, fill=Sub_region, shape=Zone),
                fun = "mean", 
                geom = "point", size=2,
                position = position_dodge(width = 0.6))
#pH_Y3

```

### Figure 3C

```{r, echo=FALSE, fig.height=5, fig.width=8}
# pH_Y2b<-ggarrange(pH_exp, pH_Y2 + theme(axis.title.y = element_blank()) ,
#            labels = c("A", "B"),
#           ncol = 1, nrow = 2, heights = c(2, 1.5))
# pH_Y2b


pH_my2<-ggarrange(#TA_exp, TA_Y2 + theme(axis.title.y = element_blank()),
          pH_exp + theme(legend.position = "none",
                         axis.text.x = element_blank(),
                         strip.text.x = element_blank()),
          pH_Y3 + theme(legend.position = "none",
                        axis.title.x = element_blank(),
                        #axis.title.y = element_blank(),
                        axis.text.x = element_blank(),
                        strip.text.x = element_blank()),
          labels = c("C", ""),
          ncol = 2, nrow = 1, widths = c(4, 1.4))
          #ncol = 1, nrow = 2, heights = c(2, 1.5))
pH_my2
```

### Omega

```{r, echo=FALSE, fig.height=8, fig.width=8}
Omega_month<- Month_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite saturation state "(~Omega[Ar]))),
                       breaks = seq(1, 5, 1),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=FLK.data[FLK.data$Extreme=="Normal", ], 
                 aes (x=Month2, y=Aragonite_Sat_W))+
    geom_point(data=FLK.data, aes (x=Month2, y=Aragonite_Sat_W, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.8, size=1)
#Omega_month

Omega_Y<- Year_ploth+
    geom_abline(slope = 0, intercept = mean_Op$OAra , color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression ("Aragonite saturation state "(~Omega[Ar]))),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(aes (x=Zone, y=Ara_mean))+
    
    geom_point(aes (x=Zone, y=Ara_mean, fill=Season), 
             shape=21, alpha=0.8, size=1.5)
#Omega_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
Ara_my<-ggarrange(Omega_month, Omega_Y,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
Ara_my

#ggsave(file="FLK_results/Sup_Plots/Fig_S8_Ar_M.svg", plot=Ara_my, dpi = 300, width=8, height=7)
```

**Figure Supp 8:** Omega variation by the region and shelf position by (A) month of the year and (B) season.

### Figure 3D

```{r}
Omega_exp<- Month_Season_plot+
    geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression("\n" ~Omega[Ar])),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=Aragonite_Sat_W, colour=Sub_region),
                span=0.8, alpha=0.2, se=F
                #method = lm, formula = y ~ splines::bs(x, 3),
                )+
      stat_summary(aes (x=as.numeric(Month2),
                      y=Aragonite_Sat_W, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.3))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=Aragonite_Sat_W, fill=Sub_region, shape=Zone),
                size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.3))

#Omega_exp

Om_Y2<- Year_plot_2+
  geom_abline(slope = 0, intercept = mean_Op$OAra, color="grey")+
  scale_y_continuous(#limits = c(1,5.5),
                       # name=(expression (
                       #   "Aragonite saturation state "(~Omega[Ar]))),
                      name=(expression (
                      ~Omega[Ar])),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
    
  stat_summary(aes (x=Sub_region, y=Ara_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)+
  stat_summary(aes (x=Sub_region, y=Ara_mean, fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=2)
#Om_Y2

Om_Y3<- Year_plot_3+
   geom_abline(slope = 0, intercept = mean_Op$OAra , color="grey")+
  scale_y_continuous(#limits = c(1,5.5),
                       # name=(expression (
                       #   "Aragonite saturation state "(~Omega[Ar]))),
                      name=(expression (
                      ~Omega[Ar])),
                       breaks = seq(1, 5, 0.5),
                       expand = c(0.1, 0.1)
                        ) +
  
   geom_point(data=Seasonal_range, aes (x=Zone, y=Ara_max,
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1, 
              position = position_dodge(width = 0.6))+
   geom_point(data=Seasonal_range, aes (x=Zone, y=Ara_min, 
                   shape=Zone, colour=Sub_region),
              alpha=0.8, size=1,
              position = position_dodge(width = 0.6))+
   # geom_segment(data=Seasonal_range, 
   #              aes(   x = Zone, y = Ara_min, 
   #                  xend = Zone, yend = Ara_max,
   #                  colour=Sub_region),
   #              #position = position_dodge(width = 0.6), 
   #              alpha=0.3)+
   stat_summary(aes (x=Zone, y=Ara_mean, colour=Sub_region),
               fun.data = "mean_sdl", fun.args = list(mult = 1),
                geom = "errorbar",  width = 0.2,
                position = position_dodge(width = 0.6))+
  stat_summary(aes (x=Zone, y=Ara_mean, fill=Sub_region, shape=Zone),
                fun = "mean", 
                geom = "point", size=2,
                position = position_dodge(width = 0.6))
#Om_Y3
```

```{r, echo=FALSE, fig.height=5, fig.width=8}
# Vertical
  # Om_Y2b<-ggarrange(Omega_exp, Om_Y2 + theme(axis.title.y = element_blank() ),
  #           labels = c("A", "B"),
  #           ncol = 2, nrow = 1, widths = c(4, 1.5))
  # Om_Y2b

# Horozontal
Om_Y2b<-ggarrange(#TA_exp, TA_Y2 + theme(axis.title.y = element_blank()),
          Omega_exp + theme(legend.position = "none",
                         axis.text.x = element_blank(),
                         strip.text.x = element_blank()),
          Om_Y3 + theme(legend.position = "none",
                        axis.title.x = element_blank(),
                        #axis.title.y = element_blank(),
                        axis.text.x = element_blank(),
                        strip.text.x = element_blank()),
          labels = c("D", ""),
          ncol = 2, nrow = 1, widths = c(4, 1.4))
Om_Y2b
```

**Figure 3C:** Aragonite saturation state (omega) by the region and shelf position. Left: monthly mean values, Right: Yearly mean values + SD, maximum monthly mean and minimum monthly mean.

# Fig.3: Seasonal monthly plot

## No summary

```{r, echo=FALSE, fig.height=8, fig.width=8}
Seasonality_my2<-ggarrange(
      ggarrange(TA_exp + theme(legend.position = "none"),
                DIC_exp + theme(legend.position = "none"),
                pH_exp + theme(legend.position = "none"),
                Omega_exp + theme(legend.position = "none", 
                                  panel.spacing = unit(0.8, "lines")),
          nrow = 4, labels = c("A", "B", "C", "D")))
Seasonality_my2
```

## with summary

```{r, echo=FALSE, fig.height=8, fig.width=8}
Seasonality_icrs<-ggarrange(
      ggarrange(TA_my2 + theme(legend.position = "none",
                               axis.text.x=element_blank()),
                DIC_my2 + theme(legend.position = "none",
                           strip.text.x = element_blank(),
                           axis.text.x=element_blank()),
                pH_my2 + theme(legend.position = "none",
                          strip.text.x = element_blank(),
                          axis.text.x=element_blank(),
                          panel.spacing = unit(0.8, "lines")),
                Om_Y2b+ theme(legend.position = "none",
                        strip.text.x = element_blank(),
                        panel.spacing = unit(0.8, "lines"),
                        axis.text.x=element_blank()),
            nrow = 4, heights = c(1, .9, .9, .9)))
Seasonality_icrs

#ggsave(file="FLK_results/Figures/Fig_3/Fig_3_Monthly_icrs.svg", plot=Seasonality_icrs, dpi = 300, width=8, height=6)
```

## Fig.3: Seasonal monthly plot supplemental

```{r, echo=FALSE, fig.height=8, fig.width=8}

# Seasonality_1<-ggarrange(TA_exp, DIC_exp, lagen,
#           labels = c("(A)", "(B)",
#           ncol = 3, nrow = 1))
#           
# Seasonality_2<-ggarrange(pCO2_exp, pH_exp, Omega_exp,
#           labels = c("(C)", "(D)", "(E)"),
#           ncol = 3, nrow = 1)

# Seasonality_my<-ggarrange(
#       ggarrange(TA_exp, DIC_exp,
#           ncol = 2, labels = c("A", "B")),
#           # First row with line plot
#       # Second row with box and dot plots
#       ggarrange(pCO2_exp, pH_exp, Omega_exp,
#           ncol = 3, labels = c("C", "D", "E")), 
#       nrow = 2)
# Seasonality_my

#FOR VERTCAL PLOTS AND HORZONLA GGARRANGE
# Seasonality_my2<-ggarrange(
#       ggarrange(TA_exp, DIC_exp, Omega_exp,
#           ncol = 3, labels = c("A", "B", "C")))
# Seasonality_my2

#FOR HORZONTAL PLOTS AND vERTICAL GGARRANGE


Seasonality_my_supplmentary<-ggarrange(
      ggarrange(Temp_exp + theme(legend.position = "none"),
                Sal_exp + theme(legend.position = "none"),
                pCO2_exp + theme(legend.position = "none"),
                #pH_exp + theme(legend.position = "none"),
          nrow = 3, labels = c("A", "B", "C")))
Seasonality_my_supplmentary


#ggsave(file="FLK_results/Figures/Fig_3/Fig_3_Monthly_mean.svg", plot=Seasonality_my2, dpi = 300, width=8, height=8)

#ggsave(file="FLK_results/Figures/Fig_3/Fig_3_Monthly_meanb.svg", plot=Seasonality_my3, dpi = 300, width=8, height=7.5)



```

**Figure 3: Monthly seasonal patterns in (A) Total Alkalinity (TA), (B) Dissolved Inorganic Carbon (DIC), and (C) aragonite saturation state (Ωar) in the Florida Reef Tract**. The colors represent the biogeographical regions and the vertical panels separate the locations by shelf zone. The points show the (monthly mean values ± 95 CI) and the lines the smoothed curves for the data (method = 'loess' and formula 'y \~ x', span=0.8). Gray horizontal lines in each panel demarcate the mean values of the parameters in the oceanic samples.

## 5.2 Season raw values

## - Season stats (all data)

-   do not use for further calculations since some months have more data than
-   can be used to compare the aggregated meas ussing MM

```{r}
Seasonal_Stats<- ddply (FLK.data_filtered, .(Zone, Sub_region, Season),
             summarise,

      Tem_mean = mean (Temperature_C, na.rm = T),
      Tem_sd = sd (Temperature_C, na.rm = T),
    
      Sal_mean = mean (BestSalinity, na.rm = T),
      Sal_sd = sd (BestSalinity, na.rm = T),
    
      TA_mean = mean (TA_umol_kg, na.rm = T),
      TA_sd = sd (TA_umol_kg, na.rm = T),
    
      nTA_mean = mean (n35TA, na.rm = T),
      nTA_sd = sd (n35TA, na.rm = T),
    
      nDIC_mean = mean (n35DIC, na.rm = T),
      nDIC_sd = sd (n35DIC, na.rm = T),
    
      DIC_mean = mean (DIC_umol_kg, na.rm = T),
      DIC_sd = sd (DIC_umol_kg, na.rm = T),
    
      pCO2_mean = mean (pCO2_uatm , na.rm = T),
      pCO2_sd = sd (pCO2_uatm , na.rm = T),
    
      pH_mean = mean (pH_calculated, na.rm = T),
      pH_sd = sd (pH_calculated, na.rm = T),
    
      Ara_mean = mean (Aragonite_Sat_W , na.rm = T),
      Ara_sd = sd (Aragonite_Sat_W , na.rm = T),
       n())

Seasonal_Stats<-Seasonal_Stats %>% 
 mutate_if(is.numeric, round, digits=2)
Seasonal_Stats
```

## - Season stats (monthly mean)

```{r}
Seasonal_Stats2<- ddply (Month_Stats, .(Zone, Sub_region, Season),
                         summarise,

                  Tem_M = mean (Tem_mean, na.rm = T),
                  #Tem_sd = sd (Tem_mean, na.rm = T),
                  Tem_se = std.error (Tem_mean, na.rm = T),

                  Sal_M = mean (Sal_mean, na.rm = T),
                  #Sal_sd = sd (Sal_mean, na.rm = T),
                  Sal_se = std.error (Sal_mean, na.rm = T),

                  TA_M = mean (TA_mean, na.rm = T),
                  #TA_sd = sd (TA_mean, na.rm = T),
                  TA_se = std.error (TA_mean, na.rm = T),
                  
                  DIC_M = mean (DIC_mean, na.rm = T),
                  #DIC_sd = sd (DIC_mean, na.rm = T),
                  DIC_se = std.error (DIC_mean, na.rm = T),
                  
                  #nTA_M = mean (nTA_mean, na.rm = T),
                  #nTA_sd = sd (nTA_mean, na.rm = T),
                  
                  #nDIC_M = mean (nDIC_mean, na.rm = T),
                  #nDIC_sd = sd (nDIC_mean, na.rm = T),

                  pCO2_M = mean (pCO2_mean , na.rm = T),
                  #pCO2_sd = sd (pCO2_mean , na.rm = T),
                  pCO2_se = std.error (pCO2_mean , na.rm = T),

                  pH_M = mean (pH_mean, na.rm = T),
                  #pH_sd = sd (pH_mean, na.rm = T),
                  pH_se = std.error (pH_mean, na.rm = T),

                  Ara_M = mean (Ara_mean , na.rm = T),
                  #Ara_sd = sd (Ara_mean , na.rm = T),
                  Ara_se = std.error (Ara_mean , na.rm = T),
                  n())

Seasonal_Stats2<-Seasonal_Stats2 %>% 
 mutate_if(is.numeric, round, digits=2)
Seasonal_Stats2

# write.csv(Seasonal_Stats2, "FLK_results/Table_S_Season_A.csv", row.names = F)

```

**Note:** SD is NA when calculating it based on monthly meand (n=3 per season)

## - Yearly stats (monthly mean)

```{r}
Yearly_Stats<- ddply (Month_Stats, .(Zone, Sub_region),
                         summarise,

                  Tem_Y = mean (Tem_mean, na.rm = T),
                  Tem_sd = sd (Tem_mean, na.rm = T),

                  Sal_Y = mean (Sal_mean, na.rm = T),
                  Sal_sd = sd (Sal_mean, na.rm = T),

                  TA_Y = mean (TA_mean, na.rm = T),
                  TA_sd = sd (TA_mean, na.rm = T),

                  nTA_Y = mean (nTA_mean, na.rm = T),
                  nTA_sd = sd (nTA_mean, na.rm = T),

                  nDIC_Y = mean (nDIC_mean, na.rm = T),
                  nDIC_sd = sd (nDIC_mean, na.rm = T),

                  DIC_Y = mean (DIC_mean, na.rm = T),
                  DIC_sd = sd (DIC_mean, na.rm = T),

                  pCO2_Y = mean (pCO2_mean , na.rm = T),
                  pCO2_sd = sd (pCO2_mean , na.rm = T),

                  pH_Y = mean (pH_mean, na.rm = T),
                  pH_sd = sd (pH_mean, na.rm = T),

                  Ara_Y = mean (Ara_mean , na.rm = T),
                  Ara_sd = sd (Ara_mean , na.rm = T),
                  n())

Yearly_Stats<-Yearly_Stats %>% 
 mutate_if(is.numeric, round, digits=2)
Yearly_Stats

# write.csv(Yearly_Stats, "FLK_results/Table_1_Year_A.csv", row.names = F)

```

**Note:** SD is NA when calculating it based on monthly meand (n=3 per season)

## 5.3 Delta months values

```{r}
# 1. Get the oceanic mean values per month-year 

  WS.reef<-join(WS.reef, mean_Open_MY, 
                 type = "left", by=c("MY", "Month"))

# 2. and subtract them from the reef data
  # Delta TA
  WS.reef$dTA_MY<-WS.reef$TA_umol_kg-WS.reef$OTA_my
  # Delta DIC
  WS.reef$dDIC_MY<-WS.reef$DIC_umol_kg-WS.reef$ODIC_my
  # Delta nTA
  WS.reef$dnTA_MY<-WS.reef$n35TA-WS.reef$OnTA_my
  # Delta nDIC
  WS.reef$dnDIC_MY<-WS.reef$n35DIC-WS.reef$OnDIC_my
  # Delta pCO2
  WS.reef$dpCO2_MY<-WS.reef$pCO2_uatm-WS.reef$OpCO2_O
  # Delta pH
  WS.reef$dpH_MY<-WS.reef$pH_calculated-WS.reef$OpH_O
   # Delta Omega
  WS.reef$dOme_MY<-WS.reef$Aragonite_Sat_W-WS.reef$OAra_O
  
 # head(WS.reef)
 #summary(WS.reef$Season, digits=2)
```

## - Delta month stats

```{r}
dMonth_Stats<- ddply (WS.reef, .(Zone, Sub_region, Month2, Season, Region),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  #dTA_se = std.error (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  #dDIC_se = std.error (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  #dpCO2_se = std.error (dpCO2_MY, na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = sd (dpH_MY, na.rm = T),
                  #dPH_se = std.error (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = sd (dOme_MY , na.rm = T)#,
                  #dAra_se = std.error (dOme_MY, na.rm = T),
                  )

dMonth_Stats<-dMonth_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dMonth_Stats

#write.csv(dMonth_Stats, "FLK_results/Table_S9_Month_StatsDeltas.csv", row.names = F)

Spring.data<-WS.reef[WS.reef$Season=="Spring", ]
Summer.data<-WS.reef[WS.reef$Season=="Summer", ]
Fall.data<-WS.reef[WS.reef$Season=="Fall", ]
Winter.data<-WS.reef[WS.reef$Season=="Winter", ]
```

Seasonal range

```{r}
Seasonal_range_d<-ddply (dMonth_Stats, .(Zone, Sub_region),
                            summarise,

                  
                  dTA_max = max (dTA_mean, na.rm = T),
                  dTA_min = min (dTA_mean, na.rm = T),
                  dTA_diff = (max (dTA_mean, na.rm = T) - min (dTA_mean, na.rm = T)),
                  
                  dDIC_max = max (dDIC_mean, na.rm = T),
                  dDIC_min = min (dDIC_mean, na.rm = T),
                  dDIC_diff = (max (dDIC_mean, na.rm = T) - min (dDIC_mean, na.rm = T)),
                  
                  dpCO2_max = max (dpCO2_mean, na.rm = T),
                  dpCO2_min = min (dpCO2_mean, na.rm = T),
                  dpCO2_dif = (max (dpCO2_mean, na.rm = T) - min (dpCO2_mean, na.rm = T)),
                  
                  dpH_max = max (dpH_mean, na.rm = T),
                  dpH_min = min (dpH_mean, na.rm = T),
                  dpH_diff = (max (dpH_mean, na.rm = T) - min (dpH_mean, na.rm = T)),
                  
                  dAra_max = max (dAra_mean, na.rm = T),
                  dAra_min = min (dAra_mean, na.rm = T),
                  dAra_diff = (max (dAra_mean, na.rm = T) - min (dAra_mean, na.rm = T)),
                  
                  n = n())

Seasonal_range_d<-Seasonal_range_d %>% 
 mutate_if(is.numeric, round, digits=3)
Seasonal_range_d

#write.csv(Seasonal_range_d, "FLK_results/Table_S8_Month_mean_range_d.csv", row.names = F)
```

## - Delta month plots

```{r}
Delta_plot<- ggplot(WS.reef) +
        MyTheme +  
        facet_grid(Sub_region~Zone)+
        scale_shape_manual(values=c(24, 25, 21))+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank())

DeltaYear_plot<- ggplot(dMonth_Stats) +
        MyTheme +  
        facet_grid(Sub_region~Region)+
        Season_fill+
        Season_colour+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              axis.text.x = element_text(angle = 10,
                                         vjust = 0.5))
        
Delta_plot_month<- ggplot(WS.reef) +
        MyTheme +  
        geom_abline(slope = 0, intercept = 0, color="grey")+
        facet_grid(~Zone)+
        guides(fill=guide_legend(override.aes=list(shape=21)))+
        scale_x_continuous(limits = c(1,12),
                     expand = c(0.05, 0.05),
                     breaks = seq(1, 12, 1),
                     name=expression(paste("Month of the year")))+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom")

DeltaYear_plot2<- ggplot(dMonth_Stats) +
        MyTheme +  
        #facet_grid(Zone~., scales = "free_y")+
        facet_grid(~Zone, scales="free" )+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))

DeltaYear_plot3<- ggplot(dMonth_Stats) +
        MyTheme +  
        Zone_shapes3+
        facet_grid(~Region)+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))

Frequency_plot<- ggplot(data = WS.reef) +
      geom_vline(aes(xintercept = 0), linetype = "dashed")+
      facet_grid(Zone~Sub_region, scales = "free_y")+ MyTheme

```

### dTA

```{r, echo=FALSE, fig.height=8, fig.width=8}
TA_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month2, y=dTA_MY))+
    
    geom_point(data=WS.reef, aes (x=Month2, y=dTA_MY, 
                                 fill=Precipitation,
                                 shape=Extreme), 
             alpha=0.8, size=1)
#TA_delta_m

TA_delta_Y<- DeltaYear_plot+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "TA (", mu, "mol ", kg^-1, ")")))+
    #geom_boxplot(data=dMonth_Stats, 
    #             aes (x=Sub_region, y=dTA_mean))+
    
    # geom_point( aes (x=Sub_region, y=dTA_mean, fill=Season),
    #             position=position_dodge(width=0.2),
    #             alpha=0.5, size=1, shape=21)+
    # 
    stat_summary(aes (x=Zone, y=dTA_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Zone, y=dTA_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.1,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Zone, y=dTA_mean, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=3, fill="black")+
    Zone_shapes4+
    
  stat_summary(aes (x=Zone, y=dTA_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.1)
  
#TA_delta_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dTA_my<-ggarrange(TA_delta_m, 
                  TA_delta_Y+ 
                    theme(axis.title.y = element_blank()),
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dTA_my
```

**Figure Supp 4:** Total Alkalinity (TA) variation by the region and shelf position by (A) month of the year and (B) season.

## Figure 4A

```{r}
DTA_exp<- Delta_plot_month+
   scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta,
                          "TA  (", mu, "mol ", ~kg^-1, ")")))+
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=dTA_MY, colour=Sub_region),
                span=0.8, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=dTA_MY, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=dTA_MY, fill=Sub_region),
                 shape=21, size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))

#DTA_exp

TA_delta_Y2<- DeltaYear_plot2+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.03, 0.03),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "TA  (", mu, "mol ", ~kg^-1, ")")))+
    stat_summary(aes (x=Season, y=dTA_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Season, y=dTA_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.8))
#TA_delta_Y2

dTA_Y3<- DeltaYear_plot3+
   scale_y_continuous(#limits = c(-210,70),
                     expand = c(0.03, 0.03),
                     #breaks = seq(0, 2500, 50),
                     name=expression(paste("")))+
    
   stat_summary(aes (x=Zone, y=dTA_mean,
                     fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=1.5, 
                position=position_dodge(width=0.5))+
  stat_summary(aes (x=Zone, y=dTA_mean, colour=Sub_region),
               fun.data = "mean_cl_boot", 
               geom = "errorbar",  width = 0.2,
               position=position_dodge(width=0.5))+
  facet_grid(~Region)
#dTA_Y3
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
# dTA_my2<-ggarrange(TA_exp,
#                    TA_delta_Y2,
#                    dTA_Y3,
#           labels = c("A", "B", "C"),
#           ncol = 1, nrow = 3, widths = c(2.5,2,1))
# dTA_my2

dTA_my3<-ggarrange(TA_delta_Y2 
                   + theme(legend.position = "none",
                           axis.text.x = element_blank()), 
                   dTA_Y3 + 
                     theme(legend.position = "none",
                           axis.text.x = element_blank()),
                          # axis.text.x = element_text(angle = 0,
                          #                vjust = 0.5)),
                    ncol = 2, nrow = 1, widths = c(1.5,0.5))
dTA_my3
```

**Figure 4A:** Seasonal delta Total Alkalinity (dTA) variation by region and shelf position. Mean values and 95 CI



### dDIC

```{r, echo=FALSE, fig.height=8, fig.width=8}
DIC_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month2, y=dDIC_MY))+
    
    geom_point(data=WS.reef, aes (x=Month2, y=dDIC_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#DIC_delta_m

DIC_delta_Y<- DeltaYear_plot+
    Zone_shapes3+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))+
  
    # geom_boxplot(data=dMonth_Stats, 
    #              aes (x=Sub_region, y=dDIC_mean))+
    # 
    # geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dDIC_mean, fill=Season), 
    #          alpha=0.8, size=1.5, shape=21)
    stat_summary(aes (x=Zone, y=dDIC_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Zone, y=dDIC_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Zone, y=dDIC_mean, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", size=3, fill="black")+
    stat_summary(aes (x=Zone, y=dDIC_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#DIC_delta_Y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dDIC_my<-ggarrange(DIC_delta_m, DIC_delta_Y,
          labels = c("A", "B"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dDIC_my
```

**Figure Supp 5:** Total Alkalinity (TA) variation by the region and shelf position by (A) month of the year and (B) season.

## Figure 4B

```{r}
dDIC_exp<- Delta_plot_month+
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     breaks = seq(-800, 800, 100),
                     name=expression(paste(Delta, "DIC  (", mu, "mol ", ~kg^-1, ")")))+
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=dDIC_MY, colour=Sub_region),
                span=0.8, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=dDIC_MY, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=dDIC_MY, fill=Sub_region),
                 shape=21, size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))

#dDIC_exp

DIC_delta_Y2<- DeltaYear_plot2+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "DIC  (", mu, "mol ", ~kg^-1, ")")))+
    stat_summary(aes (x=Season, y=dDIC_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Season, y=dDIC_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.8))
  
#DIC_delta_Y2

dDIC_Y3<- DeltaYear_plot3+
   scale_y_continuous(#limits = c(-185,130),
                     expand = c(0.01, 0.01),
                     #breaks = seq(0, 2500, 50),
                     name=expression(paste("")))+
    
   stat_summary(aes (x=Zone, y=dDIC_mean, 
                     fill=Sub_region, shape = Zone), 
                fun.data = "mean_cl_boot", geom = "point", 
                size=1.5,
                position=position_dodge(width=0.5))+
  stat_summary(aes (x=Zone, y=dDIC_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", 
               geom = "errorbar",   width = 0.2,
               position=position_dodge(width=0.5))
#dDIC_Y3
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
# dDIC_my2<-ggarrange(dDIC_exp + facet_grid(Zone~.),
#                     DIC_delta_Y2 + facet_grid(Zone~.) +
#                                   theme(axis.title.y = element_blank()),
#                     dDIC_Y3 + facet_grid(Zone~.) +
#                                   theme(axis.title.y = element_blank()),
#           labels = c("A", "B",  "C"),
#           ncol = 3, nrow = 1, widths = c(2.5, 2, 1))
# dDIC_my2

dDIC_my3<-ggarrange(DIC_delta_Y2 
                   + theme(legend.position = "none",
                           strip.text.x = element_blank(),
                          axis.text.x = element_blank()),
                   dDIC_Y3 + 
                     theme(legend.position = "none",
                          strip.text.x = element_blank(),
                          axis.text.x = element_blank()),
                    ncol = 2, nrow = 1, widths = c(1.5,0.5))
dDIC_my3

```

**Figure 4B:** Seasonal delta Dissolved Inorganic Carbon (dDIC) variation by region and shelf position.

### dDIC density

```{r}
dDIC_freq_All<- Frequency_plot+
  geom_density(aes (dDIC_MY), fill = "lightgray", alpha=0.5) +
  scale_x_continuous(breaks = seq(-300, 300, 100),
                     expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
#dDIC_freq_All

dDIC_freq_pre<- Frequency_plot+
  geom_density(aes (dDIC_MY, fill = Precipitation),
               alpha = 0.4) +
  scale_x_continuous(breaks = seq(-300, 300, 100),
                    expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
#dDIC_freq_pre

# dDIC_freq_sea<- Frequency_plot+
#   geom_density(aes (dDIC_MY, fill = Season), alpha = 0.4) +
#   scale_x_continuous(breaks = seq(-300, 300, 100),
#                      expression(paste(Delta, "DIC (", mu, "mol ", kg^-1, ")")))
# dDIC_freq_sea

```


### dpCO2

```{r, echo=FALSE, fig.height=8, fig.width=8}
pCO2_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dpCO2_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dpCO2_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pCO2_delta_m

pCO2_delta_y<- DeltaYear_plot+
    Zone_shapes3+
    scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
  
    # geom_boxplot(data=dMonth_Stats, 
    #              aes (x=Sub_region, y=dpCO2_mean))+
    # 
    # geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dpCO2_mean, fill=Season), 
    #          alpha=0.8, size=1.5, shape=21)
    stat_summary(aes (x=Zone, y=dpCO2_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Zone, y=dpCO2_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Zone, y=dpCO2_mean, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", size=3,  fill="black")+
    stat_summary(aes (x=Zone, y=dpCO2_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#pCO2_delta_y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dpCO2_my<-ggarrange(pCO2_delta_m, pCO2_delta_y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dpCO2_my
```

```{r}
pdCO2_exp<- Delta_plot_month+
   scale_y_continuous(#limits = c(1700,2900),
                     expand = c(0.05, 0.05),
                     #breaks = seq(1800, 2800, 100),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=dpCO2_MY, colour=Sub_region),
                span=0.8, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=dpCO2_MY, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=dpCO2_MY, fill=Sub_region),
                 shape=21, size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))
#pdCO2_exp

pCO2_delta_Y2<- DeltaYear_plot2+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.1, 0.1),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta ~ pCO[2] , " (", mu, "atm)")))+
    stat_summary(aes (x=Season, y=dpCO2_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Season, y=dpCO2_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.8))
#pCO2_delta_Y2

dPCO2_Y3<- DeltaYear_plot2+
   scale_y_continuous(#limits = c(2150,2550),
                     expand = c(0.01, 0.01),
                     #breaks = seq(0, 2500, 50),
                     name=expression(paste("")))+
    
   stat_summary(aes (x=Sub_region, y=dpCO2_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "point", 
                size=1.5, shape=21)+
    stat_summary(aes (x=Sub_region, y=dpCO2_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", 
               geom = "errorbar",  width = 0.2)
#dPCO2_Y3
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dpCO2_my2<-ggarrange(pdCO2_exp, pCO2_delta_Y2, dPCO2_Y3,
          labels = c("A", "B", "C"),
          ncol = 1, nrow = 3, widths = c(2,2,1))
dpCO2_my2
```

### dpH

```{r, echo=FALSE, fig.height=8, fig.width=8}
pH_delta_m<- Delta_plot+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta~pH[calculated]))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dpH_MY))+
    
    geom_point(data=WS.reef, aes (x=Month, y=dpH_MY, 
                                 fill=Precipitation, shape=Extreme), 
             alpha=0.8, size=1)
#pH_delta_m

pH_delta_y<- DeltaYear_plot+
  Zone_shapes3+
  scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta~pH[calculated]))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +
    # geom_boxplot(data=dMonth_Stats, 
    #              aes (x=Sub_region, y=dpH_mean))+
    # 
    # geom_point(data=dMonth_Stats, aes (x=Sub_region, y=dpH_mean, fill=Season), 
    #          alpha=0.8, size=1.5, shape=21)
    stat_summary(aes (x=Zone, y=dpH_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Zone, y=dpH_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Zone, y=dpH_mean, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", size=3, fill="black")+
    stat_summary(aes (x=Zone, y=dpH_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#pH_delta_y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dpH_my<-ggarrange(pH_delta_m, 
                  pH_delta_y +
                    theme(axis.title.y = element_blank()),
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dpH_my
```

## Figure 4C

```{r, echo=FALSE, fig.height=4, fig.width=8}
DpH_exp<- Delta_plot_month+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression  
                             (paste(Delta~pH[calculated]))),
                       breaks = seq(-5, 5, 0.1),
                       expand = c(0.05, 0.05)
                        ) +  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=dpH_MY, colour=Sub_region),
                span=0.8, se=F)+
    stat_summary(aes (x=as.numeric(Month2),
                      y=dpH_MY, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=dpH_MY, fill=Sub_region),
                 shape=21, size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))
#DpH_exp

pH_delta_Y2<- DeltaYear_plot2+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.01, 0.01),
                     breaks = seq(-1, 1, 0.1),
                     name=(expression  
                             (paste(Delta~pH[calculated]))))+
    stat_summary(aes (x=Season, y=dpH_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Season, y=dpH_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.8))
#pH_delta_Y2

dpH_Y3<- DeltaYear_plot3+
   scale_y_continuous(#limits = c(-0.11,0.145),
                     expand = c(0.01, 0.01),
                     breaks = seq(-1, 1, 0.05),
                     name=expression(paste("")))+
    
   stat_summary(aes (x=Zone, y=dpH_mean, 
                     fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=1.5, position=position_dodge(width=0.5))+
    stat_summary(aes (x=Zone, y=dpH_mean,
                      colour=Sub_region),
                fun.data = "mean_cl_boot", 
               geom = "errorbar",   width = 0.2,
               position=position_dodge(width=0.5))
#dpH_Y3
```

```{r, echo=FALSE}
# dpH_my2<-ggarrange(DpH_exp, 
#                    pH_delta_Y2, 
#                    dpH_Y3,
#           labels = c("A", "B", "C"),
#           ncol = 3, nrow = 1, widths = c(3,2,1))
# dpH_my2

dpH_my3<-ggarrange(pH_delta_Y2 
                   + theme(legend.position = "none",
                           strip.text.x = element_blank(),
                           axis.text.x = element_blank()), 
                   dpH_Y3 + 
                     theme(legend.position = "none",
                          strip.text.x = element_blank(),
                          axis.text.x = element_blank()),
                    ncol = 2, nrow = 1, widths = c(1.5,0.55))
dpH_my3
```

### dOmega

```{r, echo=FALSE, fig.height=8, fig.width=8}
Omega_delta_m<- Delta_plot+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " Aragonite saturation state "
                                               ~(Omega[Ar])))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_boxplot(data=WS.reef[WS.reef$Extreme=="Normal", ], 
                 aes (x=Month, y=dOme_MY))+
    geom_point(data=WS.reef, aes (x=Month, y=dOme_MY, 
                fill=Precipitation, shape=Extreme), 
                alpha=0.8, size=1)
#Omega_delta_m

Omega_delta_y<- DeltaYear_plot+
    Zone_shapes3+
    scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta, " Aragonite saturation state "
                                              ~(Omega[Ar])))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
   stat_summary(aes (x=Zone, y=dAra_mean, fill=Season),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Zone, y=dAra_mean, colour=Season),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2,
                position=position_dodge(width=0.8))+
    
    stat_summary(aes (x=Zone, y=dAra_mean, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", size=3, fill="black")+
    stat_summary(aes (x=Zone, y=dAra_mean),
                fun.data = "mean_cl_boot", geom = "errorbar",  width = 0.2)
#Omega_delta_y
```

```{r, echo=FALSE, fig.height=8, fig.width=8}
dAra_my<-ggarrange(Omega_delta_m, Omega_delta_y,
          #labels = c("dTA by month", "dTA by Year"),
          ncol = 2, nrow = 1, widths = c(4, 1.5))
dAra_my
```

## Figure 4D

```{r}
DOmega_exp<- Delta_plot_month+
   scale_y_continuous(#limits = c(1,5.5),
                       name=(expression (paste(Delta ,
                          ~Omega[Ar]))),
                       breaks = seq(-3, 3, 0.5),
                       expand = c(0.05, 0.05)
                        ) +
  
    geom_smooth(aes (x=as.numeric(Month2),
                      y=dOme_MY, colour=Sub_region),
                span=0.8, se=F)+
      stat_summary(aes (x=as.numeric(Month2),
                      y=dOme_MY, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.2))+
    stat_summary(aes (x=as.numeric(Month2), 
                      y=dOme_MY, fill=Sub_region),
                 shape=21, size=1,
                fun.data = "mean_cl_boot", geom = "point",
                position=position_dodge(width=0.2))+
  facet_grid(Zone~.)

#DOmega_exp

om_delta_Y2<- DeltaYear_plot2+
    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.05, 0.05),
                     #breaks = seq(-800, 800, 50),
                      name=(expression (paste(Delta ,
                          ~Omega[Ar]))))+
    stat_summary(aes (x=Season, y=dAra_mean, fill=Sub_region),
                fun.data = "mean_cl_boot", geom = "bar",
                position=position_dodge(width=0.8))+
    stat_summary(aes (x=Season, y=dAra_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", geom = "errorbar", 
                width = 0.2,
                position=position_dodge(width=0.8))+
  theme(panel.spacing = unit(0.8, "lines"))
#om_delta_Y2

dOm_Y3<- DeltaYear_plot3+
   scale_y_continuous(#limits = c(-0.9, 1),
                     expand = c(0.02, 0.02),
                     breaks = seq(-5, 5, 0.5),
                     name=(expression (paste(Delta ,
                          ~Omega[Ar]))))+
    
   stat_summary(aes (x=Zone, y=dAra_mean, 
                     fill=Sub_region, shape=Zone),
                fun.data = "mean_cl_boot", geom = "point", 
                size=1.5, position=position_dodge(width=0.5))+
    stat_summary(aes (x=Zone, y=dAra_mean, colour=Sub_region),
                fun.data = "mean_cl_boot", 
                geom = "errorbar",   width = 0.2,
               position=position_dodge(width=0.5))
#dOm_Y3
```

```{r, echo=FALSE, fig.height=4, fig.width=8}
# dOm_my2<-ggarrange(DOmega_exp + facet_grid(Zone~.),
#                    om_delta_Y2 + facet_grid(Zone~.) +
#                                  theme(axis.title.y = element_blank()),
#                    dOm_Y3 + facet_grid(Zone~.) +
#                                   theme(axis.title.y = element_blank()),
#           labels = c("A", "B", "C"),
#           ncol = 3, nrow = 1, widths = c(2.5,2,1))
# dOm_my2

dOm_my3<-ggarrange(om_delta_Y2 
                   + theme(legend.position = "none",
                           strip.text.x = element_blank()), 
                   dOm_Y3 + 
                     theme(legend.position = "none",
                            strip.text.x = element_blank(),
                            axis.title.y = element_blank(),
                            axis.text.x = element_text(angle = 0,
                                         vjust = 0.5)),
                   
                    ncol = 2, nrow = 1, widths = c(1.5,0.5))
dOm_my3

```

# - Figure 4: Seasonal Δ and yearly sums

```{r}
Seasonality_deltas<-ggarrange(
          TA_delta_Y2 +theme(legend.position = "none",
                              axis.text.x=element_blank()),
          DIC_delta_Y2+theme(legend.position = "none",
                              strip.text.x = element_blank(),
                              axis.text.x=element_blank()), 
          pH_delta_Y2+theme(legend.position = "none",
                              strip.text.x = element_blank(),
                              axis.text.x=element_blank()), 
          om_delta_Y2+ theme(panel.spacing = unit(0.8, "lines"),
                              strip.text.x = element_blank()),
          #TA_DIC_sum,
          nrow = 4, 
          #labels = c("A", "B", " C"),
          heights =c(1, 0.9, 0.9, 1.2))
          #widths = c(1, 1, 0.9))
Seasonality_deltas

Seasonality_deltas3<-ggarrange(
          dTA_my3,
          dDIC_my3,
          dpH_my3,
          dOm_my3,
          nrow = 4, 
          #labels = c("A", "B", " C"),
          heights =c(1, 0.9, 0.9, 1))
Seasonality_deltas3


#ggsave(file="FLK_results/Figures/Fig_4/Fig_4_delta_season.svg", plot=Seasonality_deltas, dpi = 300, width=6, height=6)

#ggsave(file="FLK_results/Figures/Fig_4/Fig_4_delta_ICRS.svg", plot=Seasonality_deltas, dpi = 300, width=8, height=6)

#ggsave(file="FLK_results/Figures/Fig_4/Fig_4_delta_Summary.svg", plot=Seasonality_deltas3, dpi = 300, width=8, height=8)
```

**Figure 4: Seasonal inshore-ocean gradients in the Florida Keys. (A) Seasonal ΔTA. (B) Seasonal ΔDIC. (C) Seasonal ΩAr.** The bars represent the mean Δ values per season, region, and shelf position (± 95 CI).

## 5.4 Delta season values

## - Delta season stats (all data)

```{r}
  dSeason_Stats<- ddply (WS.reef, .(Zone, Sub_region, Season),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  
                  #dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  #dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  #dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  #dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T),
                  n())

dSeason_Stats<-dSeason_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dSeason_Stats

```

## - Delta season stats (monthly mean)

```{r}
dSeasonal_Stats2<- ddply (dMonth_Stats,
                          .(Zone, Season, Sub_region),
                         summarise,

                  dTA_M = mean (dTA_mean, na.rm = T),
                  dTA_sd = sd (dTA_mean, na.rm = T),
                  dTA_se = std.error (dTA_mean, na.rm = T),
                  
                  dDIC_M = mean (dDIC_mean, na.rm = T),
                  dDIC_sd = sd (dDIC_mean, na.rm = T),
                  dDIC_se = std.error (dDIC_mean, na.rm = T),
                  
                  #dnTA_M = mean (dnTA_mean, na.rm = T),
                  #dnTA_sd = sd (dnTA_mean, na.rm = T),
                  
                  #dnDIC_M = mean (dnDIC_mean, na.rm = T),
                  #dnDIC_sd = sd (dnDIC_mean, na.rm = T),

                  dpCO2_M = mean (dpCO2_mean , na.rm = T),
                  dpCO2_sd = sd (dpCO2_mean , na.rm = T),
                  dpCO2_se = std.error (dpCO2_mean , na.rm = T),

                  dpH_M = mean (dpH_mean, na.rm = T),
                  dpH_sd = sd (dpH_mean, na.rm = T),
                  dpH_se = std.error (dpH_mean, na.rm = T),

                  dAra_M = mean (dAra_mean , na.rm = T),
                  dAra_sd = sd (dAra_mean , na.rm = T),
                  dAra_se = std.error (dAra_mean , na.rm = T),
                  n())

dSeasonal_Stats2<-dSeasonal_Stats2 %>% 
 mutate_if(is.numeric, round, digits=3)
dSeasonal_Stats2

#write.csv(dSeasonal_Stats2, "FLK_results/Table_2_SeasonDelta_B.csv", row.names = F)

```

**Note:** SD is NA when calculating it based on monthly meand (n=3 per season)

## - Delta yearly stats (monthly mean)

```{r}
dYearly_Stats<- ddply (dMonth_Stats, .(Zone, Sub_region),
                         summarise,

                  dTA_M = mean (dTA_mean, na.rm = T),
                  dTA_sd = sd (dTA_mean, na.rm = T),
                  #dTA_se = std.error (dTA_mean, na.rm = T),
                  
                  dDIC_M = mean (dDIC_mean, na.rm = T),
                  dDIC_sd = sd (dDIC_mean, na.rm = T),
                  #dDIC_se = std.error (dDIC_mean, na.rm = T),
                  
                  dnTA_M = mean (dnTA_mean, na.rm = T),
                  dnTA_sd = sd (dnTA_mean, na.rm = T),
                  
                  dnDIC_M = mean (dnDIC_mean, na.rm = T),
                  dnDIC_sd = sd (dnDIC_mean, na.rm = T),

                  dpCO2_M = mean (dpCO2_mean , na.rm = T),
                  dpCO2_sd = sd (dpCO2_mean , na.rm = T),
                  #dpCO2_se = std.error (dpCO2_mean , na.rm = T),

                  dpH_M = mean (dpH_mean, na.rm = T),
                  dpH_sd = sd (dpH_mean, na.rm = T),
                  #dpH_se = std.error (dpH_mean, na.rm = T),

                  dAra_M = mean (dAra_mean , na.rm = T),
                  dAra_sd = sd (dAra_mean , na.rm = T),
                  #dAra_se = std.error (dAra_mean , na.rm = T),
                  n())

dYearly_Stats<-dYearly_Stats %>% 
 mutate_if(is.numeric, round, digits=3)
dYearly_Stats

#write.csv(dYearly_Stats, "FLK_results/Table_1b_delta_year.csv", row.names = F)

```

## - Yearly summ (monthly mean)

```{r}
dYear_Add<- ddply (dMonth_Stats, .(Zone, Sub_region),
           summarise,
  su_dTA_Y = sum (dTA_mean, na.rm = T),
  #m_TA_Y = mean (dTA_mean, na.rm = T),
  #sd_TA_Y = sd (dTA_mean, na.rm = T),
  
  su_dDIC_Y = sum (dDIC_mean, na.rm = T),
  #m_dDIC_Y = mean (dDIC_mean, na.rm = T),
  #sd_dDIC_Y = sd (dDIC_mean, na.rm = T),
  

  su_dpCO2_Y = sum (dpCO2_mean, na.rm = T),
  #m_pCO2_Y = mean (dpCO2_mean, na.rm = T),
  #sd_pCO2_Y = sd (dpCO2_mean, na.rm = T),
  
  su_dpH_Y = sum (dpH_mean, na.rm = T),
  #m_pH_Y = mean (dpH_mean, na.rm = T),
  #sd_pH_Y = sd (dpH_mean, na.rm = T),
  
  su_dAra_Y = sum (dAra_mean, na.rm = T),
  #m_Ara_Y = mean (dAra_mean, na.rm = T),
  #sd_Ara_Y = sd (dAra_mean, na.rm = T),
  n())

dYear_Add<-dYear_Add %>% 
 mutate_if(is.numeric, round, digits=2)
dYear_Add

#write.csv(dYear_Add, "FLK_results/Table_1_year_byMM.csv", row.names = F)


```

## - Yearly summ (indiviual years)

```{r}
dYear_Add2<- ddply (WS.reef, .(Zone, Sub_region, MY, Region, Year),
                            summarise,
                  dTA_mean = mean (dTA_MY, na.rm = T),
                  dTA_sd = sd (dTA_MY, na.rm = T),
                  #dTA_se = std.error (dTA_MY, na.rm = T),
                  
                  dnTA_mean = mean (dnTA_MY, na.rm = T),
                  dnTA_sd = sd (dnTA_MY, na.rm = T),
                 
                  dDIC_mean = mean (dDIC_MY, na.rm = T),
                  dDIC_sd = mean (dDIC_MY, na.rm = T),
                  #dDIC_se = std.error (dDIC_MY, na.rm = T),
                  
                  dnDIC_mean = mean (dnDIC_MY, na.rm = T),
                  dnDIC_sd = sd (dnDIC_MY, na.rm = T),
                  
                  dpCO2_mean = mean (dpCO2_MY , na.rm = T),
                  dpCO2_sd = sd (dpCO2_MY , na.rm = T),
                  #dpCO2_se = std.error (dpCO2_MY, na.rm = T),
                  
                  dpH_mean = mean (dpH_MY, na.rm = T),
                  dpH_sd = mean (dpH_MY, na.rm = T),
                  #dPH_se = std.error (dpH_MY, na.rm = T),
                  
                  dAra_mean = mean (dOme_MY , na.rm = T),
                  dAra_sd = mean (dOme_MY , na.rm = T),
                  #dAra_se = std.error (dOme_MY, na.rm = T),
                  n())

dYear_Add2<-dYear_Add2 %>% 
 mutate_if(is.numeric, round, digits=3)
dYear_Add2

dYear_Add2<-dYear_Add2[dYear_Add2$Year>2014, ]
dYear_Add2<-dYear_Add2[dYear_Add2$Year<2022, ]

dYear_Add3<- ddply (dYear_Add2, .(Zone, Sub_region, Year),
           summarise,
  su_dTA_Y = sum (dTA_mean, na.rm = T),
  #m_TA_Y = mean (dTA_mean, na.rm = T),
  #sd_TA_Y = sd (dTA_mean, na.rm = T),
  
  su_dDIC_Y = sum (dDIC_mean, na.rm = T),
  #m_dDIC_Y = mean (dDIC_mean, na.rm = T),
  #sd_dDIC_Y = sd (dDIC_mean, na.rm = T),
  

  su_dpCO2_Y = sum (dpCO2_mean, na.rm = T),
  #m_pCO2_Y = mean (dpCO2_mean, na.rm = T),
  #sd_pCO2_Y = sd (dpCO2_mean, na.rm = T),
  
  su_dpH_Y = sum (dpH_mean, na.rm = T),
  #m_pH_Y = mean (dpH_mean, na.rm = T),
  #sd_pH_Y = sd (dpH_mean, na.rm = T),
  
  su_dAra_Y = sum (dAra_mean, na.rm = T),
  #m_Ara_Y = mean (dAra_mean, na.rm = T),
  #sd_Ara_Y = sd (dAra_mean, na.rm = T),
  n())

dYear_Add3<-dYear_Add3 %>% 
 mutate_if(is.numeric, round, digits=2)
dYear_Add3
```

## 5.5 Seasoal models

```{r}
season.data<-WS.reef[WS.reef$Extreme=="Normal", ]
season.data<-droplevels(season.data)
season.data$Zone<-factor(season.data$Zone, levels = c("Offshore", "Mid channel", "Inshore"))
#summary(season.data)

inshore.season.data<-season.data[season.data$Zone=="Inshore", ]
midchanel.season.data<-season.data[season.data$Zone=="Mid channel", ]
ofshore.season.data<-season.data[season.data$Zone=="Offshore", ]
```

### LMER - TA month

```{r, fig.height=6, fig.width=6}
  hist(FLK.data_filtered$TA_umol_kg)
  shapiro.test(FLK.data_filtered$TA_umol_kg) # Normality rejected
# 
#   dTA_seson<-lmer(dTA_MY~  Zone + Sub_region + Season +
#                            Zone:Sub_region + Zone:Season + Sub_region:Season+   
#                            (1|SiteID), data=season.data)
  
  TA_month_0<-lmer(TA_umol_kg~  Zone * Sub_region * Month +
                           (1|SiteID), data=FLK.data_filtered)
  #anova(TA_month_0)
  
  TA_month<-lmer(TA_umol_kg~  Zone + Sub_region + Month +
                              Zone:Sub_region + Zone:Month + Sub_region:Month +
                              (1|SiteID), data=season.data)
  
  #summary(dTA_seson)    
  av.TA_month<-(anova(TA_month))
  av.TA_month
  ranova(TA_month)
  #step(TA_month)
  
  plot(TA_month)
  par(mfrow=c(1,2))
  qqnorm(resid(TA_month))
  acf(resid(TA_month), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  
  #summ(TA_month, scale = TRUE)
  #plot_summs(TA_month)
  
  TA_mo.emmc<-emmeans(TA_month, ~Zone*Month, by="Sub_region")
    TA_mon.emmc<-multcomp::cld(TA_mo.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    #TA_mon.emmc<-TA_mon.emmc[order(TA_mon.emmc$Zone, TA_mon.emmc$Month), ]
  TA_mon.emmc
  
```

### LMER - TA season

```{r, fig.height=6, fig.width=6}
  hist(season.data$TA_umol_kg)
  shapiro.test(season.data$TA_umol_kg) # Normality rejected
# 
#   dTA_seson<-lmer(dTA_MY~  Zone + Sub_region + Season +
#                            Zone:Sub_region + Zone:Season + Sub_region:Season+   
#                            (1|SiteID), data=season.data)
  
  TA_season_0<-lmer(TA_umol_kg~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  anova(TA_season_0)
  
  TA_season<-lmer(TA_umol_kg~  Zone + Sub_region + Season +
                              Zone:Sub_region + Zone:Season + Sub_region:Season +
                              (1|SiteID), data=season.data)
  anova(TA_season_0, TA_season)
  
  #summary(av.TA_season)    
  av.TA_season<-(anova(TA_season))
  av.TA_season
  ranova(TA_season)
  #step(TA_season)
  
  plot(TA_season)
  par(mfrow=c(1,2))
  qqnorm(resid(TA_season))
  acf(resid(TA_season), main="acf(resid(TA Season))")
  par(mfrow=c(1,1))
  
  #summ(av.TA_season, scale = TRUE)
  #plot_summs(TA_season)
  
  TA_se.emmc<-emmeans(TA_season, ~Zone*Season, by="Sub_region")
    TA_seas.emmc<-multcomp::cld(TA_se.emmc)
    TA_seas.emmc
    
  TA_se.emmc2<-emmeans(TA_season, ~Sub_region*Season, by="Zone")
    TA_seas.emmc2<-multcomp::cld(TA_se.emmc2)
    TA_seas.emmc2
  
```

### LMER - all dTA - MODEL 13

```{r, fig.height=6, fig.width=6}
  hist(season.data$dTA_MY)
  shapiro.test(season.data$dTA_MY) # Normality rejected
# 
#   dTA_seson<-lmer(dTA_MY~  Zone + Sub_region + Season +
#                            Zone:Sub_region + Zone:Season + Sub_region:Season+   
#                            (1|SiteID), data=season.data)
  
  dTA_seson<-lmer(dTA_MY~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dTA_seson)    
  av.dTA_seson<-(anova(dTA_seson))
  av.dTA_seson
  ranova(dTA_seson)
  #step(dTA_seson)
  
  plot(dTA_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(dTA_seson))
  acf(resid(dTA_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  
  #summ(dTA_seson, scale = TRUE)
  #plot_summs(dTA_seson)
  
```

```{r}
 dTA_ses.emmc<-emmeans(dTA_seson, ~Season*Sub_region, by="Zone")
    dTA_ses.emmc<-multcomp::cld(dTA_ses.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dTA_ses.emmc<-dTA_ses.emmc[order(dTA_ses.emmc$Zone, 
                                     dTA_ses.emmc$Season, 
                                     dTA_ses.emmc$Sub_region), ]
  dTA_ses.emmc

  dTA_ses.emmc[,-c(3)] %>% kable("html", digits=2, row.names = F,
                                 caption = "Seasonal dTA") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 16) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 17, 32) %>%
      pack_rows(., "Inshore", 33, 48)
  
  dTA_year.emmc<-emmeans(dTA_seson, ~Sub_region*Zone)
    dTA_year.emmc<-multcomp::cld(dTA_year.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dTA_year.emmc<-dTA_year.emmc[order(dTA_year.emmc$Zone, 
                                      dTA_year.emmc$Sub_region), ]
  #dTA_year.emmc
  
  dTA_year.emmc[,-c(2)] %>% kable("html", digits=2, row.names = F,
                                  caption = "Year dTA") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 4) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 5, 8) %>%
      pack_rows(., "Inshore", 9, 12)
  
```

# Figure 4A: Model

```{r, fig.height=4.0, fig.width=8}
dTA_ses_2.emmc<-as.data.frame(dTA_ses.emmc)
dTA_ye_3.emmc<-as.data.frame(dTA_year.emmc)
dTA_ye_3.emmc$Season<-"Mean"

dTA_all_4<-rbind(dTA_ses_2.emmc, dTA_ye_3.emmc)
dTA_all_4$Zone<-factor(dTA_all_4$Zone, 
                          levels=c("Inshore" , "Mid channel", "Offshore"))


DeltaYearTA<- ggplot(dTA_all_4, aes(x=Season, y=emmean, fill=Sub_region)) +
        MyTheme +  
        #facet_grid(Zone~., scales = "free_y")+
        facet_grid(~Zone, scales="free" )+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))+

    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.03, 0.03),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "TA  (", mu, "mol ", ~kg^-1, ")")))+
    geom_bar(position = "dodge", color="black", 
           stat = "summary",
           fun = "mean")+
  geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2,
                 position=position_dodge(.9)) 
DeltaYearTA

```

### LMER - dTA Inshore

```{r, fig.height=6, fig.width=6}
# Inshore dTA
  hist(inshore.season.data$dTA_MY)
  shapiro.test(inshore.season.data$dTA_MY) # Normality rejected

  dTA_seson_in<-lmer(dTA_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dTA_seson_in)    
  av.dTA_seson_in<-anova(dTA_seson_in)
  av.dTA_seson_in
  ranova(dTA_seson_in)
  #step(dTA_seson_in)
  
  plot(dTA_seson_in)
  par(mfrow=c(1,2))
  qqnorm(resid(dTA_seson_in))
  acf(resid(dTA_seson_in), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #summ(dTA_seson_in, scale = TRUE)
  #plot_summs(dTA_seson_in)
  
  dTA_ses_in.emmc<-emmeans(dTA_seson_in, ~ Sub_region*Season)
    dTA_ses_in.emmc<-multcomp::cld(dTA_ses_in.emmc)
    #dTA_ses_in.emmc<-as.data.frame(dTA_ses_in.emmc[complete.cases(dTA_ses_in.emmc),])
    dTA_ses_in.emmc<-dTA_ses_in.emmc[order(dTA_ses_in.emmc$Season,
                                           dTA_ses_in.emmc$Sub_region), ]
  dTA_ses_in.emmc
```

### LMER - DIC season

```{r, fig.height=6, fig.width=6}
  hist(season.data$DIC_umol_kg)
  shapiro.test(season.data$DIC_umol_kg) # Normality rejected

  
  DIC_season_0<-lmer(DIC_umol_kg~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  

  #summary(DIC_season_0)    
  av.DIC_season<-(anova(DIC_season_0))
  av.DIC_season
  ranova(DIC_season_0)
  #step(DIC_season_0)
  
  plot(DIC_season_0)
  par(mfrow=c(1,2))
  qqnorm(resid(DIC_season_0))
  acf(resid(DIC_season_0), main="acf(resid(DIC Season))")
  par(mfrow=c(1,1))
  
  #summ(av.TA_season, scale = TRUE)
  #plot_summs(av.DIC_season)
  
  DIC_se.emmc<-emmeans(DIC_season_0, ~Zone*Season, by="Sub_region")
    DIC_seas.emmc<-multcomp::cld(DIC_se.emmc)
    DIC_seas.emmc
    
  DIC_se.emmc2<-emmeans(DIC_season_0, ~Sub_region*Season, by="Zone")
    DIC_seas.emmc2<-multcomp::cld(TA_se.emmc2)
    DIC_seas.emmc2
  
```

### LMER - all dDIC - MODEL 14

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$dDIC_MY)
  shapiro.test(season.data$dDIC_MY) # Normality rejected

  # dDIC_seson<-lmer(dDIC_MY~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  
  dDIC_seson<-lmer(dDIC_MY~ Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dDIC_seson)    
  av.dDIC_seson<-anova(dDIC_seson)
  av.dDIC_seson
  ranova(dDIC_seson)
  step(dDIC_seson)
  
  plot(dDIC_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(dDIC_seson))
  acf(resid(dDIC_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #summ(dDIC_seson, scale = TRUE)
  #plot_summs(dDIC_seson)
  
 dDIC_ses.emmc<-emmeans(dDIC_seson, ~Season*Sub_region, by="Zone")
    dDIC_ses.emmc<-multcomp::cld(dDIC_ses.emmc)
    #dDIC_ses.emmc<-as.data.frame(dDIC_ses.emmc[complete.cases(dDIC_ses.emmc),])
    dDIC_ses.emmc<-dDIC_ses.emmc[order(dDIC_ses.emmc$Zone, 
                                     dDIC_ses.emmc$Season, 
                                     dDIC_ses.emmc$Sub_region), ]
  #dDIC_ses.emmc

  dDIC_ses.emmc[,-c(3)] %>% kable("html", digits=2, row.names = F,
                                 caption = "Seasonal dDIC") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 16) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 17, 32) %>%
      pack_rows(., "Inshore", 33, 48)
  
  dDIC_year.emmc<-emmeans(dDIC_seson, ~Sub_region*Zone)
    dDIC_year.emmc<-multcomp::cld(dDIC_year.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dDIC_year.emmc<-dDIC_year.emmc[order(dDIC_year.emmc$Zone, 
                                      dDIC_year.emmc$Sub_region), ]
  #dDIC_year.emmc
  
  dDIC_year.emmc[,-c(2)] %>% kable("html", digits=2, row.names = F,
                                  caption = "Year dDIC") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 4) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 5, 8) %>%
      pack_rows(., "Inshore", 9, 12)

```

# Figure 4B: Model

```{r,  fig.height=4.0, fig.width=8 }
dDIC_ses_2.emmc<-as.data.frame(dDIC_ses.emmc)
dDIC_ye_3.emmc<-as.data.frame(dDIC_year.emmc)
dDIC_ye_3.emmc$Season<-"Mean"

dDIC_all_4<-rbind(dDIC_ses_2.emmc, dDIC_ye_3.emmc)
dDIC_all_4$Zone<-factor(dDIC_all_4$Zone, 
                          levels=c("Inshore" , "Mid channel", "Offshore"))


DeltaYearDIC<- ggplot(dDIC_all_4, aes(x=Season, y=emmean, fill=Sub_region)) +
        MyTheme +  
        #facet_grid(Zone~., scales = "free_y")+
        facet_grid(~Zone, scales="free" )+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))+

    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.03, 0.03),
                     #breaks = seq(-800, 800, 50),
                     name=expression(paste(Delta, "DIC  (", mu, "mol ", ~kg^-1, ")")))+
    geom_bar(position = "dodge", color="black", 
           stat = "summary",
           fun = "mean")+
  geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2,
                 position=position_dodge(.9)) 
DeltaYearDIC
```

### LMER - dDIC Inshore

```{r, fig.height=6, fig.width=6}
# Inshore dDIC
  hist(inshore.season.data$dDIC_MY)
  shapiro.test(inshore.season.data$dDIC_MY) # Normality rejected

  dDIC_seson_in<-lmer(dDIC_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dDIC_seson_in)    
  av.dDIC_seson_in<-anova(dDIC_seson_in)
  av.dDIC_seson_in
  ranova(dDIC_seson_in)
  #step(dDIC_seson_in)
  
  plot(dDIC_seson_in)
  par(mfrow=c(1,1))
  qqnorm(resid(dDIC_seson_in))
  acf(resid(dDIC_seson_in), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #summ(dDIC_seson_in, scale = TRUE)
  #plot_summs(dDIC_seson_in)
  
  dDIC_ses_in.emmc<-emmeans(dDIC_seson_in, ~ Sub_region*Season)
    dDIC_ses_in.emmc<-multcomp::cld(dDIC_ses_in.emmc)
    #dDIC_ses_in.emmc<-as.data.frame(dDIC_ses_in.emmc[complete.cases(dDIC_ses_in.emmc),])
    dDIC_ses_in.emmc<-dDIC_ses_in.emmc[order(dDIC_ses_in.emmc$Season,
                                           dDIC_ses_in.emmc$Sub_region), ]
  dDIC_ses_in.emmc
```

### LMER - all dpCO2

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$dpCO2_MY)
  shapiro.test(season.data$dpCO2_MY) # Normality rejected

  # dpCO2_seson<-lmer(dpCO2_MY~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  dpCO2_seson<-lmer(dpCO2_MY~ Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dpCO2_seson)    
  av.dPCO2_seson<-anova(dpCO2_seson)
  av.dPCO2_seson
  ranova(dpCO2_seson)
  step(dpCO2_seson)
  
  plot(dpCO2_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(dpCO2_seson))
  acf(resid(dpCO2_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #plot_summs(dpCO2_seson)  
  
  dpCO2_ses.emmc<-emmeans(dpCO2_seson, ~Zone*Sub_region*Season)
    dpCO2_ses.emmc<-multcomp::cld(dpCO2_ses.emmc)
    #dpCO2_ses.emmc<-as.data.frame(dpCO2_ses.emmc[complete.cases(dpCO2_ses.emmc),])
    dpCO2_ses.emmc<-dpCO2_ses.emmc[order(dpCO2_ses.emmc$Zone, dpCO2_ses.emmc$Season), ]
  dpCO2_ses.emmc
  #summ(dpCO2_seson, scale = TRUE)
```

### LMER - dPCO2 Inshore

```{r, fig.height=6, fig.width=6}
# Inshore dDIC
  hist(inshore.season.data$dpCO2_MY)
  shapiro.test(inshore.season.data$dpCO2_MY) # Normality rejected

  dpCO2_seson_in<-lmer(dpCO2_MY~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
  #summary(dpCO2_seson_in)    
  av.dPCO2_seson_in<-anova(dpCO2_seson_in)
  av.dPCO2_seson_in
  ranova(dpCO2_seson_in)
  #step(dpCO2_seson_in)
  
  plot(dpCO2_seson_in)
  par(mfrow=c(1,2))
  qqnorm(resid(dpCO2_seson_in))
  acf(resid(dpCO2_seson_in), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #summ(dpCO2_seson_in, scale = TRUE)
  #plot_summs(dpCO2_seson_in)
  
  dpCO2_ses_in.emmc<-emmeans(dpCO2_seson_in, ~ Sub_region*Season)
    dpCO2_ses_in.emmc<-multcomp::cld(dpCO2_ses_in.emmc)
    #dpCO2_ses_in.emmc<-as.data.frame(dpCO2_ses_in.emmc[complete.cases(dpCO2_ses_in.emmc),])
    dpCO2_ses_in.emmc<-dpCO2_ses_in.emmc[order(dpCO2_ses_in.emmc$Season,
                                           dpCO2_ses_in.emmc$Sub_region), ]
  dpCO2_ses_in.emmc
```

### LMER - all Omega

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$Aragonite_Sat_W)
  shapiro.test(season.data$Aragonite_Sat_W) # Normality rejected

  # Omega_seson<-lmer(Aragonite_Sat_W~  Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  Omega_seson<-lmer(Aragonite_Sat_W~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(Omega_seson)    
  av.Ome_seson<-anova(Omega_seson)
  av.Ome_seson
  ranova(Omega_seson)
  #step(Omega_seson)
  
  plot(Omega_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(Omega_seson))
  acf(resid(Omega_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #plot_summs(Omega_seson)  
    
  # Ara_ses.emmc<-emmeans(Omega_seson, ~Zone*Sub_region*Season)
  #   Ara_ses.emmc<-multcomp::cld(Ara_ses.emmc)
  #   Ara_ses.emmc<-as.data.frame(Ara_ses.emmc[complete.cases(Ara_ses.emmc),])
  #   Ara_ses.emmc<-Ara_ses.emmc[order(Ara_ses.emmc$Zone, Ara_ses.emmc$Season), ]
  # Ara_ses.emmc
  
  Ara_ses.emmc<-emmeans(Omega_seson, ~Zone*Season, by="Sub_region")
    Ara_ses.emmc<-multcomp::cld(Ara_ses.emmc)
    Ara_ses.emmc
    
  Ara_ses.emmc2<-emmeans(Omega_seson, ~Sub_region*Season, by="Zone")
    Ara_ses.emmc2<-multcomp::cld(Ara_ses.emmc2)
    Ara_ses.emmc2
```

### LMER - all dOmega - MODEL 16

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$dOme_MY)
  shapiro.test(season.data$dOme_MY) # Normality rejected

  # Omega_seson<-lmer(Aragonite_Sat_W~  Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  dOmega_seson<-lmer(dOme_MY~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dOmega_seson)    
  av.dOme_seson<-anova(dOmega_seson)
  av.dOme_seson
  ranova(dOmega_seson)
  #step(dOmega_seson)
  
  plot(dOmega_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(dOmega_seson))
  acf(resid(dOmega_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #plot_summs(dOmega_seson)  
    
dAra_ses.emmc<-emmeans(dOmega_seson, ~Zone*Season, by="Sub_region")
    dAra_ses.emmc<-multcomp::cld(dAra_ses.emmc)
    dAra_ses.emmc
    
dAra_ses.emmc1<-emmeans(dOmega_seson, ~Sub_region*Season, by="Zone")
    dAra_ses.emmc1<-multcomp::cld(dAra_ses.emmc1)
    dAra_ses.emmc1
    
dAra_ses.emmc2<-emmeans(dOmega_seson, ~Season*Sub_region, by="Zone")
    dAra_ses.emmc2<-multcomp::cld(dAra_ses.emmc2)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dAra_ses.emmc2<-dAra_ses.emmc2[order(dAra_ses.emmc2$Zone, 
                                     dAra_ses.emmc2$Season, 
                                     dAra_ses.emmc2$Sub_region), ]

dAra_ses.emmc2[,-c(3)] %>% kable("html", digits=2, row.names = F,
                                 caption = "Seasonal d Omega") %>%
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 16) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 17, 32) %>%
      pack_rows(., "Inshore", 33, 48)

dOm_year.emmc<-emmeans(dOmega_seson, ~Sub_region*Zone)
    dOm_year.emmc<-multcomp::cld(dOm_year.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dOm_year.emmc<-dOm_year.emmc[order(dOm_year.emmc$Zone, 
                                      dOm_year.emmc$Sub_region), ]
  #dDIC_year.emmc
  
  dOm_year.emmc[,-c(2)] %>% kable("html", digits=2, row.names = F,
                                  caption = "Year d Omega") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 4) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 5, 8) %>%
      pack_rows(., "Inshore", 9, 12)
```

# Figure 4D: Model

```{r,  fig.height=4.0, fig.width=8}
dAra_ses_2.emmc<-as.data.frame(dAra_ses.emmc2)
dAra_ye_3.emmc<-as.data.frame(dOm_year.emmc)
dAra_ye_3.emmc$Season<-"Mean"

dAra_all_4<-rbind(dAra_ses_2.emmc, dAra_ye_3.emmc)
dAra_all_4$Zone<-factor(dDIC_all_4$Zone, 
                          levels=c("Inshore" , "Mid channel", "Offshore"))


DeltaYearAra<- ggplot(dAra_all_4, aes(x=Season, y=emmean, fill=Sub_region)) +
        MyTheme +  
        #facet_grid(Zone~., scales = "free_y")+
        facet_grid(~Zone, scales="free" )+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))+

    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.03, 0.03),
                     breaks = seq(-6, 6, 0.3),
                     name=(expression (paste(Delta ,
                          ~Omega[Ar]))))+
    geom_bar(position = "dodge", color="black", 
           stat = "summary",
           fun = "mean")+
  geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2,
                 position=position_dodge(.9)) 

DeltaYearAra

```

### LMER - Omega Inshore

```{r, fig.height=6, fig.width=6}
# Inshore dDIC
  hist(inshore.season.data$Aragonite_Sat_W)
  shapiro.test(inshore.season.data$Aragonite_Sat_W) # Normality rejected

  Omega_seson_in<-lmer(Aragonite_Sat_W~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
      #summary(Omega_seson_in)    
      av.Ome_seson_in<-anova(Omega_seson_in)
      av.Ome_seson_in
      ranova(Omega_seson_in)
      #step(Omega_seson_in)
      
      plot(Omega_seson_in)
      par(mfrow=c(1,2))
      qqnorm(resid(Omega_seson_in))
      acf(resid(Omega_seson_in), main="acf(resid(dTA Season))")
      par(mfrow=c(1,1))
      #summ(dDIC_seson_in, scale = TRUE)
  #plot_summs(Omega_seson_in)
  
  omega_ses_in.emmc<-emmeans(Omega_seson_in, ~ Sub_region*Season)
    omega_ses_in.emmc<-multcomp::cld(omega_ses_in.emmc)
    #omega_ses_in.emmc<-as.data.frame(omega_ses_in.emmc[complete.cases(omega_ses_in.emmc),])
    omega_ses_in.emmc<-omega_ses_in.emmc[order(omega_ses_in.emmc$Season,
                                           omega_ses_in.emmc$Sub_region), ]
  omega_ses_in.emmc
```

### LMER - all pH

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$pH_calculated)
  shapiro.test(season.data$pH_calculated) # Normality rejected

  # pH_seson<-lmer(pH_calculated~ Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  pH_seson<-lmer(pH_calculated~ Zone * Sub_region * Season *
                           (1|SiteID), data=season.data)
  
        #summary(pH_seson)    
        av.pH_seson<-anova(pH_seson)
        av.pH_seson
        ranova(pH_seson)
        #step(pH_seson)
        
        plot(pH_seson)
        par(mfrow=c(1,2))
        qqnorm(resid(pH_seson))
        acf(resid(pH_seson), main="acf(resid(dTA Season))")
        par(mfrow=c(1,1))
  #summ(pH_seson, scale = TRUE)
  #plot_summs(pH_seson)  
  
  pH_ses.emmc<-emmeans(pH_seson, ~Zone*Sub_region*Season)
    pH_ses.emmc<-multcomp::cld(pH_ses.emmc)
    pH_ses.emmc<-as.data.frame(pH_ses.emmc[complete.cases(pH_ses.emmc),])
    pH_ses.emmc<-pH_ses.emmc[order(pH_ses.emmc$Zone, pH_ses.emmc$Season), ]
  pH_ses.emmc
  
  pH_ses.emmc<-emmeans(pH_seson, ~Zone, by = "Sub_region")
    pH_ses.emmc<-multcomp::cld(pH_ses.emmc)
    pH_ses.emmc<-as.data.frame(pH_ses.emmc[complete.cases(pH_ses.emmc),])
    #pH_ses.emmc<-pH_ses.emmc[order(pH_ses.emmc$Zone, pH_ses.emmc$Season), ]
  pH_ses.emmc
  
  pH_ses.emmc<-emmeans(pH_seson, ~Zone)
    pH_ses.emmc<-multcomp::cld(pH_ses.emmc)
    pH_ses.emmc<-as.data.frame(pH_ses.emmc[complete.cases(pH_ses.emmc),])
    #pH_ses.emmc<-pH_ses.emmc[order(pH_ses.emmc$Zone, pH_ses.emmc$Season), ]
  pH_ses.emmc

```

### LMER - all dpH - MODEL 15

```{r, fig.height=6, fig.width=6}
# Inshore Omega
  hist(season.data$dpH_MY)
  shapiro.test(season.data$dpH_MY) # Normality rejected

  # Omega_seson<-lmer(Aragonite_Sat_W~  Zone + Sub_region + Season +
  #                          Zone:Sub_region + Zone:Season + Sub_region:Season+   
  #                          (1|SiteID), data=season.data)
  dpH_seson<-lmer(dpH_MY~  Zone * Sub_region * Season +
                           (1|SiteID), data=season.data)
  
  #summary(dpH_seson)    
  av.dpH_seson<-anova(dpH_seson)
  av.dpH_seson
  ranova(dpH_seson)
  #step(dpH_seson)
  
  plot(dpH_seson)
  par(mfrow=c(1,2))
  qqnorm(resid(dpH_seson))
  acf(resid(dpH_seson), main="acf(resid(dTA Season))")
  par(mfrow=c(1,1))
  #plot_summs(dpH_seson)  
    
dpH_ses.emmc<-emmeans(dpH_seson, ~Zone*Season, by="Sub_region")
    dpH_ses.emmc<-multcomp::cld(dpH_ses.emmc)
    dpH_ses.emmc
    
dpH_ses.emmc<-emmeans(dpH_seson, ~Sub_region)
    dpH_ses.emmc<-multcomp::cld(dpH_ses.emmc)
    dpH_ses.emmc
    
dpH_ses.emmc2<-emmeans(dpH_seson, ~Season*Sub_region, by="Zone")
    dpH_ses.emmc2<-multcomp::cld(dpH_ses.emmc2)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dpH_ses.emmc2<-dpH_ses.emmc2[order(dpH_ses.emmc2$Zone, 
                                     dpH_ses.emmc2$Season, 
                                     dpH_ses.emmc2$Sub_region), ]
  #dpH_ses.emmc2

  dpH_ses.emmc2[,-c(3)] %>% kable("html", digits=2, row.names = F,
                                   caption = "Seasonal d pH") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 16) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 17, 32) %>%
      pack_rows(., "Inshore", 33, 48)
  
  
  dpH_year.emmc<-emmeans(dpH_seson, ~Sub_region*Zone)
    dpH_year.emmc<-multcomp::cld(dpH_year.emmc)
    #dTA_ses.emmc<-as.data.frame(dTA_ses.emmc[complete.cases(dTA_ses.emmc),])
    dpH_year.emmc<-dpH_year.emmc[order(dpH_year.emmc$Zone, 
                                      dpH_year.emmc$Sub_region), ]
  #dDIC_year.emmc
  
  dpH_year.emmc[,-c(2)] %>% kable("html", digits=2, row.names = F,
                                  caption = "Year d pH") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Offshore", 1, 4) %>% # groups rows with zone label
      pack_rows(., "Mid-Channel", 5, 8) %>%
      pack_rows(., "Inshore", 9, 12)
```

# Figure 4C: Model

```{r,  fig.height=4.0, fig.width=8}
dpH_ses_2.emmc<-as.data.frame(dpH_ses.emmc2)
dpH_ye_3.emmc<-as.data.frame(dpH_year.emmc)
dpH_ye_3.emmc$Season<-"Mean"

dpH_all_4<-rbind(dpH_ses_2.emmc, dpH_ye_3.emmc)
dpH_all_4$Zone<-factor(dDIC_all_4$Zone, 
                          levels=c("Inshore" , "Mid channel", "Offshore"))


DeltaYearpH<- ggplot(dpH_all_4, aes(x=Season, y=emmean, fill=Sub_region)) +
        MyTheme +  
        #facet_grid(Zone~., scales = "free_y")+
        facet_grid(~Zone, scales="free" )+
        geom_hline(yintercept = 0, color="gray")+
        theme(axis.title.x = element_blank(),
              legend.position = "bottom",
              axis.text.x = element_text(angle = 0))+

    scale_y_continuous(#limits = c(-350,340),
                     expand = c(0.01, 0.01),
                     breaks = seq(-6, 6, 0.05),
                     name=(expression (paste(Delta ,
                          ~pH[]))))+
    geom_bar(position = "dodge", color="black", 
           stat = "summary",
           fun = "mean")+
  geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2,
                 position=position_dodge(.9)) 

DeltaYearpH

```

### LMER - pH Inshore

```{r, fig.height=6, fig.width=6}
# Inshore pH
  hist(inshore.season.data$pH_calculated)
  shapiro.test(inshore.season.data$pH_calculated) # Normality rejected

  pH_seson_in<-lmer(pH_calculated~  Sub_region * Season +
                           (1|SiteID), data=inshore.season.data)
  
    #summary(pH_seson_in)    
    av.pH_seson_in<-anova(pH_seson_in)
    av.pH_seson_in
    ranova(pH_seson_in)
    #step(pH_seson_in)
    
    plot(pH_seson_in)
    par(mfrow=c(1,2))
    qqnorm(resid(pH_seson_in))
    acf(resid(pH_seson_in), main="acf(resid(dTA Season))")
    par(mfrow=c(1,1))
    #summ(pH_seson_in, scale = TRUE)
    #plot_summs(pH_seson_in)
  
  pH_ses_in.emmc<-emmeans(pH_seson_in, ~ Sub_region*Season)
    pH_ses_in.emmc<-multcomp::cld(pH_ses_in.emmc)
    #pH_ses_in.emmc<-as.data.frame(pH_ses_in.emmc[complete.cases(pH_ses_in.emmc),])
    pH_ses_in.emmc<-pH_ses_in.emmc[order(pH_ses_in.emmc$Season,
                                           pH_ses_in.emmc$Sub_region), ]
  pH_ses_in.emmc
```

## Summary all data

```{r}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.dTA_seson <- data.frame(av.dTA_seson)
    av.dDIC_seson <- data.frame(av.dDIC_seson) 
    av.dPCO2_seson <- data.frame(av.dPCO2_seson)
    av.dOme_seson <- data.frame(av.dOme_seson) 
    av.dpH_seson <- data.frame(av.dpH_seson) 
    
    # Putting all into one dataframe/table
    anova_results_all <- data.frame(cbind
                    (c("Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season",
                       
                       "Zone", "Sub_region", "Season", "Zone:Sub_region", "Zone:Season",
                       "Sub_region:Season", "Zone:Sub_region:Season"), 
                                      rbind(av.dTA_seson, av.dDIC_seson, av.dPCO2_seson,
                                            av.dOme_seson, av.dpH_seson ))) 
    colnames(anova_results_all) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_results_all) <- NULL
    
    # create HTML table using kableExtra
    anova_results_all %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "d TA", 1, 7) %>% # groups rows with label
      pack_rows(., "d DIC", 8, 14)  %>% # groups rows with label
      pack_rows(., "d pCO2", 15, 21) %>% # groups rows with label
      pack_rows(., "d Omega", 22, 28)  %>% # groups rows with label
      pack_rows(., "d pH", 29, 35)  
    
    
    
#export_summs(dTA_seson, dDIC_seson, dpCO2_seson,  scale = TRUE)
      
      Seasonal_models<-list("d TA" = dTA_seson, 
                         "d DIC" = dDIC_seson, 
                         "d pCO2" = dpCO2_seson, 
                         "Omega" = Omega_seson,
                         "pH" = pH_seson)
      
      modelsummary(Seasonal_models, stars = TRUE, 
                   #statistic = c('std.error', 'p.value', 'conf.int'),
                   title = 'Seasonal and spatial models'#,
                   #coef_map=factor_order
                   )
      #modelsummary(Omega_models, estimate = "p.value")
      
```

## Summary all inshore

```{r}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.dTA_seson_in <- data.frame(av.dTA_seson_in)
    av.dDIC_seson_in <- data.frame(av.dDIC_seson_in) 
    av.dPCO2_seson_in <- data.frame(av.dPCO2_seson_in)
    av.Ome_seson_in <- data.frame(av.Ome_seson_in) 
    av.pH_seson_in <- data.frame(av.pH_seson_in) 
    
    # Putting all into one dataframe/table
    anova_results_In <- data.frame(cbind
                    (c("Sub_region", "Season", "Sub_region:Season", 
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season",
                       
                       "Sub_region", "Season", "Sub_region:Season"), 
                                      rbind(av.dTA_seson_in, av.dDIC_seson_in,
                                            av.dPCO2_seson_in,
                                            av.Ome_seson_in, av.pH_seson_in))) 
    colnames(anova_results_In) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_results_In) <- NULL
    
    # create HTML table using kableExtra
    anova_results_In %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "d TA inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "d DIC inshore", 4, 6)  %>% # groups rows with label
      pack_rows(., "d pCO2 inshore", 7, 9) %>% # groups rows with label
      pack_rows(., "Omega inshore", 10, 12)  %>% # groups rows with label
      pack_rows(., "pH inshore", 13, 15)  
    
    
#export_summs(dTA_seson, dDIC_seson, dpCO2_seson,  scale = TRUE)
    Seasonal_models_in<-list("d TA" = dTA_seson_in, 
                       "d DIC" = dDIC_seson_in, 
                       "d pCO2" = dpCO2_seson_in, 
                       "Omega" = Omega_seson_in,
                       "pH" = pH_seson_in)
    
    modelsummary(Seasonal_models_in, stars = TRUE, 
                 #statistic = c('std.error', 'p.value', 'conf.int'),
                 title = 'Seasonal and spatial models for inshore reefs'#,
                 #coef_map=factor_order
                 )
    #modelsummary(Omega_models, estimate = "p.value")
```

# Figure 4: Models

```{r}

Figure_4<-ggarrange(DeltaYearTA+ theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 legend.position = "none"),
                  DeltaYearDIC+ theme(legend.position = "none",
                                 axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 strip.text.x = element_blank()),
                  DeltaYearpH + theme(legend.position = "none",
                                 axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 strip.text.x = element_blank()),
                  DeltaYearAra+ theme(legend.position = "bottom",
                                 strip.text.x = element_blank(),
                                 panel.spacing = unit(0.8, "lines")),
          labels = c("A", "B", "C", "D"),
          ncol = 1, nrow = 4, heights = c(1, 0.9, 0.9, 1.2))
Figure_4

#ggsave(file="FLK_results/Figures/Fig_4/Figure_4.svg", plot=Figure_4, dpi = 300, width=8, height=7)

```

# 6 LMER long trend MODELS

-   The F statistic in a regression model is used to test whether there is a linear model of the data - overall , or equivalently that your model is no better than a model with just the intercept.

-   The t statistic for a coefficient in a linear model tests the H0 that the true coefficient is 0.

\*The t-statistic is telling you about each coefficient individually. You can have a model with a low overall linear fit, but one individual coefficient may be relatively contributing a lot to explanation the variation in the DV that is explained on the assumption that there is a linear model.

Data and plots prep

```{r}
Trends.data<-FLK.data_filtered[FLK.data_filtered$Year>2014, ]
#summary(Trends.data)

Reef.Trends.data<-WS.reef[WS.reef$Year>2014, ]
Reef.Trends.data<-Reef.Trends.data[Reef.Trends.data$Extreme=="Normal", ]
#summary(Reef.Trends.data$Extreme)

Trends.ocean<-Trends.data[Trends.data$Zone=="Oceanic", ]

Trends.offshore<-Reef.Trends.data[Reef.Trends.data$Zone=="Offshore", ]
Trends.midchanel<-Reef.Trends.data[Reef.Trends.data$Zone=="Mid channel", ]
Trends.inshore<-Reef.Trends.data[Reef.Trends.data$Zone=="Inshore", ]

Long_plot<- ggplot(Trends.data) +
        MyTheme +  
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank())+
        scale_x_date(date_breaks = "2 years",
                     date_labels = "%Y",
                     expand = c(0.02, 0.02))

Long_plot2<- ggplot() +
        MyTheme +  
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank(),
                axis.text.x = element_text(angle = 0, vjust = 0.5))+
        scale_x_date(date_breaks = "2 years",
                     date_labels = "%Y",
                     expand = c(0.02, 0.02))
xs <- as.Date(as.character("2018-11-20"))

factor_order <- c('Year'    = 'Year',
                  '(Intercept)' = 'Intercept',
                  'Sub_regionUK'    = 'Upper Keys',
                  'Sub_regionMK'    = 'Middle Keys',
                  'Sub_regionLK'    = 'Lower Keys')
        
```

# Omega-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$Aragonite_Sat_W)
shapiro.test(Trends.data$Aragonite_Sat_W) # Normality rejected
  
Omeaga_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       #name=(expression("Aragonite saturation state" ~(Omega[Ar]))),
                       name=(expression(~Omega[Ar])),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=Aragonite_Sat_W, fill=Sub_region), 
             alpha=0.8, size=0.8, shape=21)

Omeaga_all+
    geom_smooth(aes (x=Date, y=Aragonite_Sat_W), method = "lm",
              color="black") + scale_fill_hue(l=100)

Trends_c<-Omeaga_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=Aragonite_Sat_W, 
                   colour=Sub_region), 
              method = "lm", alpha=0.3)
Trends_c

Trends_c2<-Omeaga_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=Aragonite_Sat_W), method = "lm",
              alpha=0.3, colour="black")
Trends_c2


```

```{r, echo=TRUE}
## Model with all data
Omega_all_o<-lmer(Aragonite_Sat_W~Year * Zone * Sub_region + (1|Month)+           
                                    (1|SiteID), data=Trends.data)
  step(Omega_all_o)
    
    
Omega_all_1<-lmer(Aragonite_Sat_W ~ Year + Zone + Sub_region + (1 | Month) +
                      Year:Zone + Zone:Sub_region, data=Trends.data)

Omega_all_3<-lmer(Aragonite_Sat_W ~ Year + Zone + (1 | Month) + (1|Sub_region)+
                       Year:Zone, data=Trends.data)
    

anova(Omega_all_1, Omega_all_3)

    summary(Omega_all_1)
    anova(Omega_all_1)
    #ranova(Omega_all_1)

# Obtain slopes
    
    ranef(Omega_all_1)
    fixef(Omega_all_1)

    coef(Omega_all_1)$Month
    coef(Omega_all_1)$Zone
    
    
  m.lst <- lstrends(Omega_all_1, "Zone", var="Year")
  m.lst
  pairs(m.lst)
```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore Omega
  hist(Trends.inshore$Aragonite_Sat_W)
  shapiro.test(Trends.inshore$Aragonite_Sat_W) # Normality rejected

  Omega_in_0<-lmer(Aragonite_Sat_W~Year * Sub_region + (1|Month)+
                                    #(1|Zone)+             
                                    (1|SiteID), data=Trends.inshore)
  
  Omega_in_1<-lmer(Aragonite_Sat_W~Year * Sub_region * Season +
                                    #(1|Zone)+             
                                    (1|SiteID), data=Trends.inshore)
  
  #summary(Omega_in_0)
  #summary(Omega_in_1)    
  #anova(Omega_in_0, Omega_in_1)
  #step(Omega_in_1)
  
  anova(Omega_in_0)
  ranova(Omega_in_0)
  step(Omega_in_0)
  
  Omega_in<-lmer(Aragonite_Sat_W ~ Sub_region + (1 | Month),
                 data=Trends.inshore)
  anova(Omega_in)
  summary(Omega_in)
  
  plot(Omega_in)
  qqnorm(resid(Omega_in))
  acf(resid(Omega_in), main="acf(resid(Omega Inshore))")
  
  Arg_in.emmc<-emmeans(Omega_in, ~Sub_region)
    Arg_in.emmc<-multcomp::cld(Arg_in.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_in.emmc<-Arg_in.emmc[order(Arg_in.emmc$Sub_region),]
    Arg_in.emmc
    
  #write.csv(Arg_in.emmc, "FLK_results/Model_9_LTpH_POST.csv")
    round(Arg_in.emmc$emmean, digits = 2)
  #anova(Omega_in)
  #ranova(Omega_in)

```

```{r}
# Create a new data frame for independent variables  
  In_Newdata<-expand.grid(Zone=unique(Trends.inshore$Zone),
                          Sub_region=unique(Trends.inshore$Sub_region),
                          Year=seq((min(Trends.inshore$Year)-0), (max(Trends.inshore$Year)+1)))
  In_Omega_Pred <- predict(Omega_in, newdata=In_Newdata, re.form=NA, level=0, asList = FALSE)
  
  In_Omega_Pred <-cbind(In_Newdata, In_Omega_Pred)
  In_Omega_Pred$Date<-as.Date(as.character(In_Omega_Pred$Year), format = "%Y")
  
  
# Plot raw data point and fitted model 
  
  In_Omega_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(#limits = c(0,6),
                       #name=(expression("Aragonite saturation state" ~(Omega[Ar]))),
                       name=(expression(~Omega[Ar])),
                       limits = c(2.3, 5.2),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.inshore, 
                               aes(y=Aragonite_Sat_W, x=Date, 
                                  #fill = Sub_region), 
                                  colour = Sub_region), 
                               alpha=0.5, size=0.5, shape=21)+
      geom_line(data=In_Omega_Pred, aes(y = In_Omega_Pred,
                                      x=Date, colour = Sub_region), linetype=2, size=1) 
  In_Omega_Modeled

```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$Aragonite_Sat_W)
shapiro.test(Trends.midchanel$Aragonite_Sat_W)# Normality rejected

Omega_mc_0<-lmer(Aragonite_Sat_W~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)

# Omega_mc_1<-lmer(Aragonite_Sat_W~Year * Sub_region * Season +
#                                     #(1|Zone)+             
#                                     (1|SiteID), data=Trends.midchanel)

#summary(Omega_mc_0)    
#summary(Omega_mc_1)  

anova(Omega_mc_0)
#anova(Omega_mc_1)
#anova(Omega_mc_0, Omega_mc_1)
#ranova(Omega_mc_0)
step(Omega_mc_0)


Omega_mc<-lmer(Aragonite_Sat_W ~ Year + Sub_region + (1 | Month),
               data = Trends.midchanel)
  summary(Omega_mc) 
  anova(Omega_mc) 
  plot(Omega_mc)
  qqnorm(resid(Omega_mc))
  acf(resid(Omega_mc), main="acf(resid(Omega mid Channel))")  
  
  Arg_md.emmc<-emmeans(Omega_mc, ~Sub_region+Year)
    Arg_md.emmc<-multcomp::cld(Arg_md.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_md.emmc<-Arg_md.emmc[order(Arg_md.emmc$Sub_region),]
    Arg_md.emmc
  #write.csv(Arg_md.emmc, "FLK_results/Model_10_LTpH_POST.csv")
```

```{r}
# Create a new data frame for independent variables  
  Mc_Newdata<-expand.grid(Zone=unique(Trends.midchanel$Zone),
                                Sub_region=unique(Trends.midchanel$Sub_region),
                          Year=seq((min(Trends.midchanel$Year)-0), (max(Trends.midchanel$Year)+1)))
  Mc_Omega_Pred <- predict(Omega_mc, newdata=Mc_Newdata, re.form=NA, level=0, asList = FALSE)
  
  Mc_Omega_Pred <-cbind(Mc_Newdata, Mc_Omega_Pred)
  Mc_Omega_Pred$Date<-as.Date(as.character(Mc_Omega_Pred$Year), format = "%Y")
  
  
# Model summary for labels
  slope<-round(
      summary(Omega_mc)$coefficients["Year", "Estimate"], digits = 3)
  ys <- max(Trends.midchanel$Aragonite_Sat_W, na.rm =T)+ 0.3

# Plot raw data point and fitted model 
  plot_label <- sprintf("\"\" ~ Omega[Ar] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
  Mc_Omega_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(#limits = c(15,40),
                       #name=(expression("Aragonite saturation state" ~(Omega[Ar]))),
                       name=(expression(~Omega[Ar])),
                       limits = c(2.3, 5.2),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.02, 0.02)) +
    
      geom_jitter(data=Trends.midchanel, 
                               aes(y=Aragonite_Sat_W, x=Date, 
                                  #fill = Sub_region), 
                                  colour = Sub_region), 
                               alpha=0.5, size=0.5, shape=23)+
      geom_line(data=Mc_Omega_Pred, aes(y = Mc_Omega_Pred,
                                      x=Date, colour = Sub_region), linetype=1, size=1)+
      # geom_text(data = slope, aes(x = xs, y = ys,
      #                       label = (paste("~Omega[Ar]", "=", 
      #                                     slope, "Year ^-1"))), size=10)
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
               #label = expression("~Omega[Ar] == -0.015** ~Year ^-1"), 
               label =paste0(as.character(plot_label, plot_label2, sep = " ")),
               size=4)
  Mc_Omega_Modeled
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$Aragonite_Sat_W)
shapiro.test(Trends.offshore$Aragonite_Sat_W)# Normality rejected

Omega_of_0<-lmer(Aragonite_Sat_W~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
#summary(Omega_of_0)    
anova(Omega_of_0)
ranova(Omega_of_0)
step(Omega_of_0)

Omega_of<-lmer(Aragonite_Sat_W ~ Year + Sub_region + (1 | Month), 
               data =Trends.offshore)
  summary(Omega_of)
  anova(Omega_of) 
  plot(Omega_of)
  qqnorm(resid(Omega_of))
  acf(resid(Omega_of), main="acf(resid(Omega offshore))")  
  
  Arg_of.emmc<-emmeans(Omega_of, ~Sub_region+Year)
    Arg_of.emmc<-multcomp::cld(Arg_of.emmc)
    #Arg_in.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    Arg_of.emmc<-Arg_of.emmc[order(Arg_of.emmc$Sub_region),]
    Arg_of.emmc
#write.csv(Arg_of.emmc, "FLK_results/Model_11_LTpH_POST.csv")
```

```{r}
# Create a new data frame for independent variables  
  Of_Newdata<-expand.grid(one=unique(Trends.offshore$Zone),
                                Sub_region=unique(Trends.offshore$Sub_region),
                          Year=seq((min(Trends.offshore$Year)-0), (max(Trends.offshore$Year)+1)))
  Of_Omega_Pred <- predict(Omega_of, newdata=Of_Newdata, re.form=NA, level=0, asList = FALSE)
  
  Of_Omega_Pred <-cbind(Of_Newdata, Of_Omega_Pred)
  Of_Omega_Pred$Date<-as.Date(as.character(Of_Omega_Pred$Year), format = "%Y")
  
# Model summary for labels
  slope<-round(summary(Omega_of)$coefficients["Year", "Estimate"], digits = 3)
  ys <- max(Trends.offshore$Aragonite_Sat_W, na.rm =T)
  plot_label <- sprintf("\"\" ~ Omega[Ar] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  Of_Omega_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(#limits = c(15,40),
                       #name=(expression("Aragonite saturation state" ~(Omega[Ar]))),
                      name=(expression(~Omega[Ar])),
                       limits = c(3, 4.5),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.offshore, 
                               aes(y=Aragonite_Sat_W, x=Date, 
                                  #fill = Sub_region), 
                                  colour = Sub_region), 
                               alpha=0.5, size=0.5, shape=24)+
      geom_line(data=Of_Omega_Pred, aes(y = Of_Omega_Pred,
                                      x=Date, colour = Sub_region), linetype=1, size=1)+
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
               #label = expression("~Omega[Ar] == -0.015** ~Year ^-1"), 
               label =paste0(as.character(plot_label, plot_label2, sep = " ")),
               size=4)
  Of_Omega_Modeled
  
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$Aragonite_Sat_W)
shapiro.test(Trends.ocean$Aragonite_Sat_W)# Normality NOT rejected

Omega_oc_0<-lmer(Aragonite_Sat_W ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)

Omega_oc_1<-lmer(Aragonite_Sat_W ~ Year * Sub_region * Season++ (1|SiteID),
               data=Trends.ocean)
  #summary(Omega_oc_0)
  #summary(Omega_oc_1)    
  #anova(Omega_oc_1) 
  anova(Omega_oc_0)
  ranova(Omega_oc_0)
  step(Omega_oc_0)

Omega_oc<-lmer(Aragonite_Sat_W ~ Year + (1 | Month), data = Trends.ocean)
  summary(Omega_oc)
  anova(Omega_oc)
  plot(Omega_oc)
  qqnorm(resid(Omega_oc))
  acf(resid(Omega_oc), main="acf(resid(Omega open))")
  
  Arg_oc.emmc<-emmeans(Omega_oc, ~Year)
    #Arg_oc.emmc<-multcomp::cld(Arg_oc.emmc)
    #Arg_oc.emmc<-as.data.frame(Arg_in.emmc[complete.cases(Arg_in.emmc),])
    #Arg_oc.emmc<-Arg_oc.emmc[order(Arg_oc.emmc$Sub_region),]
    #Arg_oc.emmc

```

```{r}
# Create a new data frame for independent variables  
  Oc_Newdata<-expand.grid(one=unique(Trends.ocean$Zone),
                                Sub_region=unique(Trends.ocean$Sub_region),
                          Year=seq((min(Trends.ocean$Year)-0), (max(Trends.ocean$Year)+1)))
  Oc_Omega_Pred <- predict(Omega_oc, newdata=Oc_Newdata, re.form=NA, level=0, asList = FALSE)
  
  Oc_Omega_Pred <-cbind(Oc_Newdata, Oc_Omega_Pred)
  Oc_Omega_Pred$Date<-as.Date(as.character(Oc_Omega_Pred$Year), format = "%Y")
  
# Model summary for labels
  slope<-round(summary(Omega_oc)$coefficients["Year", "Estimate"], digits = 3)
  #xs <- as.Date(as.character("2018-11-20"))
  #ys <- max(Trends.inshore$Aragonite_Sat_W, na.rm =T)
  ys <- max(Trends.offshore$Aragonite_Sat_W, na.rm =T)
  plot_label <- sprintf("\"\" ~ Omega[Ar] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  
  Oc_Omega_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(#limits = c(15,40),
                       #name=(expression("Aragonite saturation state" ~(Omega[Ar]))),
                      name=(expression(~Omega[Ar])),
                       limits = c(3, 4.5),
                       breaks = seq(0, 10, 0.5),  
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.ocean, 
                               aes(y=Aragonite_Sat_W, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region), 
                               alpha=0.5, size=0.5, shape=25)+
      geom_line(data=Oc_Omega_Pred, aes(y = Oc_Omega_Pred,
                                      x=Date), linetype=1, size=1, colour = "black") +
    
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
               #label = expression("~Omega[Ar] == -0.015** ~Year ^-1"), 
               label =paste0(as.character(plot_label, plot_label2, sep = " ")),
               size=4)
  Oc_Omega_Modeled
```

## Models summary

Complete models

```{r , all fixed factors summary - Omega}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.Omega_in_0 <- data.frame (anova(Omega_in_0))
    av.Omega_mc_0 <- data.frame (anova(Omega_mc_0) )
    av.Omega_of_0 <- data.frame (anova(Omega_of_0))
    av.Omega_oc_0 <- data.frame (anova(Omega_oc_0))
    
    # Putting all into one dataframe/table
    anova_Omega_0 <- data.frame(cbind
                    (c("Year", "Sub_region", "Year:Sub_region", 
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region"), 
                                      rbind(av.Omega_in_0, av.Omega_mc_0,
                                            av.Omega_of_0, av.Omega_oc_0))) 
    colnames(anova_Omega_0) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_Omega_0) <- NULL
    
    # create HTML table using kableExtra
    anova_Omega_0 %>% kable("html", digits=2, 
        caption="Initial omega models fixed factors: Year*Region") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Omega inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "Omega mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "Omega offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "Omega ocean", 10, 12)  
```

```{r}

# R-ANOVAs    
    rav.Omega_in_0 <- data.frame (ranova(Omega_in_0))
    rav.Omega_mc_0 <- data.frame (ranova(Omega_mc_0) )
    rav.Omega_of_0 <- data.frame (ranova(Omega_of_0))
    rav.Omega_oc_0 <- data.frame (ranova(Omega_oc_0))
    
    # Putting all into one dataframe/table
    ranova_Omega_0 <- data.frame(cbind
                    (c("<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)"), 
                      rbind(rav.Omega_in_0, rav.Omega_mc_0,
                            rav.Omega_of_0, rav.Omega_oc_0))) 
    colnames(ranova_Omega_0) <- c("", "npar", "logLik", "AIC" , "LRT",
                                     "DF", "Pr(>Chi Sq)")
    row.names(ranova_Omega_0) <- NULL
    
    # create HTML table using kableExtra
    ranova_Omega_0 %>% kable("html", digits=2,
         caption="Initial omega models random factors: Month+Station") %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Omega inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "Omega mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "Omega offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "Omega ocean", 10, 12)  

```

```{r}
Omega_models_0<-list("Inshore" = Omega_in_0, 
                   "Mid channel" = Omega_mc_0, 
                   "Offshore" = Omega_of_0, 
                   "Ocean" = Omega_oc_0)
modelsummary(Omega_models_0, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'Initial Omega model outputs (all factors)',
             coef_map=factor_order)
#modelsummary(Omega_models, estimate = "p.value")
```

Models with non-significant factors removed

```{r omegad dropped models}
Omega_models<-list("Inshore" = Omega_in, 
                   "Mid channel" = Omega_mc, 
                   "Offshore" = Omega_of, 
                   "Ocean" = Omega_oc)
modelsummary(Omega_models, stars = TRUE, 
            #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'Final Omega model outputs (dropped factors)',
             coef_map=factor_order)

modelsummary(Omega_models, output = "FLK_results/Figures/Fig_2/Trend_Omega.docx")
#modelsummary(Omega_models, estimate = "p.value")



```

```{r omega model plot}
Trends_Omega<-ggarrange(In_Omega_Modeled+ theme(
                                          #axis.text.x=element_blank(),
                                          legend.position = "none"),
                  Mc_Omega_Modeled+ theme(legend.position = "none",
                                           #axis.text.x=element_blank(),
                                           axis.title.y=element_blank()),
                                
                  Of_Omega_Modeled + theme(legend.position = "none",
                                           #axis.text.x=element_blank(),
                                           axis.title.y=element_blank()),
                                
                  Oc_Omega_Modeled + theme(legend.position = "none",
                                           #axis.text.x=element_blank(),
                                           axis.title.y=element_blank()),
                                           
          labels = c("C"),
          ncol = 4, nrow = 1, widths =c(1.1, 1, 1, 1))
Trends_Omega
```

# pCO2-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$pCO2_uatm)
shapiro.test(Trends.data$pCO2_uatm)# Normality rejected

pCO2_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=expression(paste(pCO[2], " (", mu, " atm)")),
                       breaks = seq(0, 800, 100),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=pCO2_uatm, fill=Sub_region), 
             alpha=0.8, size=0.8, shape=21)

pCO2_all+geom_smooth(aes (x=Date, y=pCO2_uatm), 
                     method = "lm", color="black")

pCO2_all+facet_grid(~Zone)+geom_smooth(aes (x=Date, y=pCO2_uatm), 
                     method = "lm", color="black")

Trends_a<-pCO2_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pCO2_uatm, colour=Sub_region),
              method = "lm", alpha=0.3)
Trends_a

Trends_a2<-pCO2_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pCO2_uatm),
              method = "lm", alpha=0.3, colour="black")
Trends_a2

```

```{r, echo=TRUE}
## Model with all data
pCO2_all_o<-lmer(pCO2_uatm~Year * Zone * Sub_region + (1|Month)+           
                                    (1|SiteID), data=Trends.data)
    step(Omega_all_o)
    
    
pCO2_all_o_1<-lmer(pCO2_uatm ~ Year + Zone + Sub_region + (1 | Month) +
                      Year:Zone + Zone:Sub_region, data=Trends.data)

pCO2_all_o_3<-lmer(pCO2_uatm ~ Year + Zone + (1 | Month) + (1|Sub_region)+
                       Year:Zone, data=Trends.data)
    

anova(pCO2_all_o, pCO2_all_o_1, pCO2_all_o_3)

    summary(pCO2_all_o_1)
    anova(pCO2_all_o_1)
    ranova(pCO2_all_o_1)

# Obtain slopes
    
    ranef(pCO2_all_o_1)
    fixef(pCO2_all_o_1)

    coef(pCO2_all_o_1)$Month
    coef(pCO2_all_o_1)$Zone
    
    
  m.lst <- lstrends(pCO2_all_o_1, "Zone", var="Year")
  m.lst
  pairs(m.lst)

```

## Inshore

```{r, fig.height=4, fig.width=4}

# Inshore pCO2
  hist(Trends.inshore$pCO2_uatm)
  shapiro.test(Trends.inshore$pCO2_uatm)# Normality NOT? rejected

  pCO2_in_0<-lmer(pCO2_uatm~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.inshore)
  #summary(pCO2_in_0)    
  anova(pCO2_in_0)
  ranova(pCO2_in_0)
  step(pCO2_in_0)

pCO2_in<-lmer(pCO2_uatm ~ (1|Month)+(1|SiteID), data=Trends.inshore)
  summary(pCO2_in)
  anova(pCO2_in)
  plot(pCO2_in)
  qqnorm(resid(pCO2_in))
  acf(resid(pCO2_in), main="acf(resid(pCO2 Inshore))")  
  
  #pCO2_in.emmc<-emmeans(pCO2_in, ~Month)
      #pCO2_in.emmc<-multcomp::cld(pCO2_in.emmc)
      #pCO2_in.emmc<-pCO2_in.emmc[order(pCO2_in.emmc$Sub_region),]
      #pCO2_in.emmc
```

```{r}
# Predict values  
  In_pCO2_Pred <- predict(pCO2_in, newdata=In_Newdata, re.form=NA, level=0, asList = FALSE)
  
  In_pCO2_Pred <-cbind(In_Newdata, In_pCO2_Pred)
  In_pCO2_Pred$Date<-as.Date(as.character(In_pCO2_Pred$Year), format = "%Y")
  
# # Model summary
#   slope<-round(
#       summary(pCO2_in)$coefficients["Year", "Estimate"], digits = 3)
#   xs <- as.Date(as.character("2018-11-20"))
#   ys <- max(Trends.midchanel$pCO2_uatm, na.rm =T)
# 
# # Plot raw data point and fitted model 
#   plot_label <- sprintf("\"\" ~ pCO[2] == %0.3f", slope)
#   plot_label2 <- expression("Year^-1")
  
  
# Plot raw data point and fitted model 
  
  In_pCO2_Modeled<-Long_plot2+ facet_grid(~Zone)+
     scale_y_continuous(name=expression(paste(pCO[2], ~" (", mu, " atm)")),
                        limits = c(200,800),
                        breaks = seq(0, 800, 100),  
                        expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.inshore, 
                               aes(y=pCO2_uatm, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region),  
                                  alpha=0.5, size=0.5, shape=21)+
      geom_line(data=In_pCO2_Pred, aes(y = In_pCO2_Pred,
                                      x=Date), linetype=2, size=1, colour = "black")

  In_pCO2_Modeled
  
```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$pCO2_uatm)
shapiro.test(Trends.midchanel$pCO2_uatm)# Normality NOT rejected

pCO2_mc_0<-lmer(pCO2_uatm~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(pCO2_mc_0)    
  anova(pCO2_mc_0)
  ranova(pCO2_mc_0)
  step(pCO2_mc_0)
  

pCO2_mc<-lmer(pCO2_uatm ~ Year + Sub_region + (1 | Month), 
              data = Trends.midchanel)
  summary(pCO2_mc) 
   anova(pCO2_mc)
   plot(pCO2_mc)
  qqnorm(resid(pCO2_mc))
  acf(resid(pCO2_mc), main="acf(resid(pCO2 Mid Channel))")  
  
  pCO2_mc.emmc<-emmeans(pCO2_mc, ~Sub_region+Year)
        pCO2_mc.emmc<-multcomp::cld(pCO2_mc.emmc)
        pCO2_mc.emmc<-pCO2_mc.emmc[order(
          pCO2_mc.emmc$Sub_region),]
  pCO2_mc.emmc
  
  #write.csv(pCO2_mc.emmc, "FLK_results/Model_2_LTpCO2_POST.csv")
```

```{r}
# Predict values  
  Mc_pCO2_Pred <- predict(pCO2_mc, newdata=Mc_Newdata, re.form=NA, level=0, asList = FALSE)
  
  Mc_pCO2_Pred <-cbind(Mc_Newdata, Mc_pCO2_Pred)
  Mc_pCO2_Pred$Date<-as.Date(as.character(Mc_pCO2_Pred$Year), format = "%Y")
  
 # Model summary
  slope<-round(
      summary(pCO2_mc)$coefficients["Year", "Estimate"], digits = 3)
  #ys <- max(Trends.inshore$pCO2_uatm, na.rm =T)
  ys <- max(Trends.midchanel$pCO2_uatm, na.rm =T)+50

# Plot raw data point and fitted model 
  plot_label <- sprintf("\"\" ~ pCO[2] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
  
# Plot raw data point and fitted model 
  
  Mc_pCO2_Modeled<-Long_plot2+ facet_grid(~Zone)+
     scale_y_continuous(name=expression(paste(pCO[2], ~" (", mu, " atm)")),
                       limits = c(200,800),
                        breaks = seq(0, 800, 100),  
                        expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.midchanel, 
                               aes(y=pCO2_uatm, x=Date, #fill = Sub_region), 
                                  colour = Sub_region),  
                               alpha=0.5, size=0.5, shape=23)+
      geom_line(data=Mc_pCO2_Pred, aes(y = Mc_pCO2_Pred,
                                      x=Date, colour = Sub_region),
                linetype=1, size=1) +
     annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
               #label = expression("~Omega[Ar] == -0.015** ~Year ^-1"), 
               label =paste0(as.character(plot_label, plot_label2, sep = " ")),
               size=4)
  Mc_pCO2_Modeled
  
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$pCO2_uatm)
shapiro.test(Trends.offshore$pCO2_uatm)# Normality rejected

pCO2_of_0<-lmer(pCO2_uatm~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(pCO2_of_0)    
  anova(pCO2_of_0)
  ranova(pCO2_of_0)
  step(pCO2_of_0)

pCO2_of<-lmer(pCO2_uatm ~ Year + Sub_region + (1 | Month),
              data =Trends.offshore)
  summary(pCO2_of)
  anova(pCO2_of)
  plot(pCO2_of)
  qqnorm(resid(pCO2_of))
  acf(resid(Omega_in), main="acf(resid(pCO2 Offshore))")  
  
  pCO2_of.emmc<-emmeans(pCO2_of, ~Sub_region)
        pCO2_of.emmc<-multcomp::cld(pCO2_of.emmc)
        pCO2_of.emmc<-pCO2_of.emmc[order(pCO2_of.emmc$Sub_region),]
  pCO2_of.emmc
  
  #write.csv(pCO2_of.emmc, "FLK_results/Model_3_LTpCO2_POST.csv")
```

```{r}
# Predict values  
  Of_pCO2_Pred <- predict(pCO2_of, newdata=Of_Newdata, re.form=NA, level=0, asList = FALSE)
  
  Of_pCO2_Pred <-cbind(Of_Newdata, Of_pCO2_Pred)
  Of_pCO2_Pred$Date<-as.Date(as.character(Of_pCO2_Pred$Year), format = "%Y")
  
# Model summary for slope labels 
  slope<-round(
      summary(pCO2_of)$coefficients["Year", "Estimate"], digits = 3)
  #xs <- as.Date(as.character("2018-11-20"))
  ys <- max(Trends.offshore$pCO2_uatm, na.rm =T) -15
  plot_label <- sprintf("\"\" ~ pCO[2] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  Of_pCO2_Modeled<-Long_plot2+ facet_grid(~Zone)+
     scale_y_continuous(name=expression(paste(pCO[2], ~" (", mu, " atm)")),
                       limits = c(300,605),
                        breaks = seq(0, 800, 100),  
                        expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.offshore, 
                               aes(y=pCO2_uatm, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region),  
                                alpha=0.5, size=0.5, shape=24)+
      geom_line(data=Of_pCO2_Pred, aes(y = Of_pCO2_Pred,
                                      x=Date, colour = Sub_region),
                linetype=1, size=1) +
     annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
               #label = expression("~Omega[Ar] == -0.015** ~Year ^-1"), 
               label =paste0(as.character(plot_label, plot_label2, sep = " ")),
               size=4)
  Of_pCO2_Modeled
  
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$pCO2_uatm)
shapiro.test(Trends.ocean$pCO2_uatm)# Normality rejected

pCO2_oc_0<-lmer(pCO2_uatm ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(pCO2_oc_0)    
  anova(pCO2_oc_0)
  ranova(pCO2_oc_0)
  step(pCO2_oc_0)

pCO2_oc<-lmer(pCO2_uatm ~ Year + (1 | Month), 
              data = Trends.ocean)
  summary(pCO2_oc) 
  anova(pCO2_oc) 
  plot(pCO2_oc)
  qqnorm(resid(pCO2_oc))
  acf(resid(pCO2_oc), main="acf(resid(pCO2 open))")
  
  pCO2_oc.emmc<-emmeans(pCO2_oc, ~Year)
        pCO2_oc.emmc<-multcomp::cld(pCO2_oc.emmc)
        #pCO2_oc.emmc<-pCO2_oc.emmc[order(pCO2_oc.emmc$Sub_region),]
  pCO2_oc.emmc
```

```{r}
# Predict values  
  Oc_pCO2_Pred <- predict(pCO2_oc, newdata=Oc_Newdata, 
                          re.form=NA, level=0, asList = FALSE)
  Oc_pCO2_Pred <-cbind(Oc_Newdata, Oc_pCO2_Pred)
  Oc_pCO2_Pred$Date<-as.Date(as.character(Oc_pCO2_Pred$Year), format = "%Y")
  
# Model summary for slope labels 
  slope<-round(
      summary(pCO2_oc)$coefficients["Year", "Estimate"], digits = 3)
  #xs <- as.Date(as.character("2018-11-20"))
  ys <- max(Trends.offshore$pCO2_uatm, na.rm =T)-15
  plot_label <- sprintf("\"\" ~ pCO[2] == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  Oc_pCO2_Modeled<-Long_plot2+ facet_grid(~Zone)+
     scale_y_continuous(name=expression(paste(pCO[2], ~" (", mu, " atm)")),
                       limits = c(300,605),
                        breaks = seq(0, 800, 100),  
                        expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.ocean, 
                               aes(y=pCO2_uatm, x=Date, #fill = Sub_region), 
                                  colour = Sub_region),  
                                alpha=0.5, size=0.5, shape=25)+
      geom_line(data=Oc_pCO2_Pred, aes(y = Oc_pCO2_Pred, x=Date), 
                          colour = "black", linetype=1, size=1) +
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
              label =paste0(as.character(plot_label, plot_label2, sep = " ")),
              size=4)
  Oc_pCO2_Modeled
  
```

## Models summary

Complete models

```{r, all fixed factors summary - pCO2}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    
    av.pCO2_in_0 <- data.frame (anova(pCO2_in_0))
    av.pCO2_mc_0 <- data.frame (anova(pCO2_mc_0) )
    av.pCO2_of_0 <- data.frame (anova(pCO2_of_0))
    av.pCO2_oc_0 <- data.frame (anova(pCO2_oc_0))
    
    # Putting all into one dataframe/table
    anova_pH <- data.frame(cbind
                    (c("Year", "Sub_region", "Year:Sub_region", 
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region"), 
                      rbind(av.pCO2_in_0, av.pCO2_mc_0,
                      av.pCO2_of_0, av.pCO2_oc_0))) 
    colnames(anova_pH) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_pH) <- NULL
    
    # create HTML table using kableExtra
    anova_pH %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "pCO2 inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "pCO2 mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "pCO2 offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "pCO2 ocean", 10, 12)  
```

```{r, all random factors summary - pCO2}

# R-ANOVAs    
    rav.pCO2_in_0 <- data.frame (ranova(pCO2_in_0))
    rav.pCO2_mc_0 <- data.frame (ranova(pCO2_mc_0) )
    rav.pCO2_of_0 <- data.frame (ranova(pCO2_of_0))
    rav.pCO2_oc_0 <- data.frame (ranova(pCO2_oc_0))
    
    # Putting all into one dataframe/table
    ranova_pCO2 <- data.frame(cbind
                    (c("<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)"), 
                      rbind(rav.pCO2_in_0, rav.pCO2_mc_0,
                            rav.pCO2_of_0, rav.pCO2_oc_0))) 
    colnames(ranova_pCO2) <- c("", "npar", "logLik", "AIC" , "LRT",
                                     "DF", "Pr(>Chi Sq)")
    row.names(ranova_pCO2) <- NULL
    
    # create HTML table using kableExtra
    ranova_pCO2 %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "Omega inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "Omega mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "Omega offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "Omega ocean", 10, 12)  

```

```{r}
pCO2_models_0<-list("Inshore" = pCO2_in_0, 
                   "Mid channel" = pCO2_mc_0, 
                   "Offshore" = pCO2_of_0, 
                   "Ocean" = pCO2_oc_0)
modelsummary(pCO2_models_0, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pCO model outputs (all factors)',
             coef_map=factor_order)
#modelsummary(Omega_models, estimate = "p.value")
```

Factors removed models

```{r, droped fixed factors summary - pCO2 }
pCO2_models<-list("Inshore" = pCO2_in, 
                   "Mid channel" = pCO2_mc, 
                   "Offshore" = pCO2_of, 
                   "Ocean" = pCO2_oc)
modelsummary(pCO2_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pCO2 models outputs (dropped factors)',
             coef_map=factor_order)
#modelsummary(pCO2_models, estimate = "p.value")

```

```{r pCO2 model plot}
Trends_pCO2<-ggarrange(In_pCO2_Modeled+ theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 legend.position = "none"),
                  Mc_pCO2_Modeled + theme(legend.position = "none",
                                 axis.title.y=element_blank(),
                                 axis.text.x=element_blank()),
                                
                  Of_pCO2_Modeled + theme(legend.position = "none",
                                           axis.title.y=element_blank(),
                                           axis.text.x=element_blank()),
                                
                  Oc_pCO2_Modeled + theme(legend.position = "none",
                                           axis.title.y=element_blank(),
                                           axis.text.x=element_blank()),
                  
          labels = c("A"),
          ncol = 4, nrow = 1, widths =c(1.1, 1, 1, 1))
Trends_pCO2
```

# pH-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$pH_calculated)
shapiro.test(Trends.data$pH_calculated)# Normality rejected

pH_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                       name=(expression(pH[calculated])),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=pH_calculated, fill=Sub_region), 
             alpha=0.8, size=0.8, shape=21)

pH_all+ geom_smooth(aes (x=Date, y=pH_calculated),
                    method = "lm", color="black")

pH_all + facet_grid(~Zone)+ geom_smooth(aes (x=Date, y=pH_calculated),method = "lm", color="black")

Trends_b<-pH_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pH_calculated, colour=Sub_region), method = "lm", alpha=0.3)
Trends_b

Trends_b2<-pH_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=pH_calculated), method = "lm",
              alpha=0.3, colour="black")
Trends_b2

```

```{r}
## Model with all data
pH_all_o<-lmer(pH_calculated ~ Year * Zone * Sub_region + (1|Month)+           
                                    (1|SiteID), data=Trends.data)
    step(pH_all_o)
    
    
pH_all_o_1<-lmer(pH_calculated ~ Year + Zone + Sub_region + (1 | Month) +
                      Year:Zone + Zone:Sub_region, data=Trends.data)

pH_all_o_3<-lmer(pH_calculated ~ Year + Zone + (1 | Month) + (1|Sub_region)+
                       Year:Zone, data=Trends.data)
    

anova(pH_all_o, pH_all_o_1, pH_all_o_3)

    summary(pH_all_o_1)
    anova(pH_all_o_1)
    ranova(pH_all_o_1)
    
  
    ranef(pH_all_o_1)
    fixef(pH_all_o_1)

    coef(pH_all_o_1)$Month
    coef(pH_all_o_1)$Zone
    
    
  m.lst <- lstrends(pH_all_o_1, "Zone", var="Year")
  m.lst
  pairs(m.lst)
  
  
  # Create a new data frame for independent variables  
  Newdata<-expand.grid(Zone=unique(Trends.data$Zone),
                          Sub_region=unique(Trends.data$Sub_region),
                          Year=seq((min(Trends.data$Year)-0), (max(Trends.data$Year)+1)))
  
  # Predict values  
  pH_Pred <- predict(pH_all_o_1, newdata=Newdata, 
                        re.form=NA, level=0, asList = FALSE)
  pH_Pred <-cbind(Newdata, pH_Pred)
  pH_Pred$Date<-as.Date(as.character(pH_Pred$Year), format = "%Y")
  

pH_Modeled<-Long_plot2+ facet_grid(~Zone)+
     scale_y_continuous(name=(expression(pH[calculated])),
                       limits=c(7.80, 8.28),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.data, 
                               aes(y=pH_calculated, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region),  
                                alpha=0.5, size=0.5,shape=21)+
      geom_line(data=pH_Pred, aes(y = pH_Pred, x=Date,  colour = Sub_region),
                                linetype=2, size=1) #+
      #annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
      #        label =paste0(as.character(plot_label, plot_label2, sep = " ")),
      #        size=4)
  pH_Modeled
```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore pH
hist(Trends.inshore$pH_calculated)
shapiro.test(Trends.inshore$pH_calculated)# Normality rejected

pH_in_0<-lmer(pH_calculated~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.inshore)
  #summary(pH_in_0)    
  anova(pH_in_0)
  ranova(pH_in_0)
  step(pH_in_0)

pH_in<-lmer(pH_calculated ~ Sub_region + (1 | Month) + (1 | SiteID),
            data=Trends.inshore)
  summary(pH_in)    
  anova(pH_in)
  plot(pH_in)
  qqnorm(resid(pH_in))
  acf(resid(pH_in), main="acf(resid(pH Inshore))")  
  
  pH_in.emmc<-emmeans(pH_in, ~Sub_region)
        pH_in.emmc<-multcomp::cld(pH_in.emmc)
        pH_in.emmc<-pH_in.emmc[order(pH_in.emmc$Sub_region),]
  pH_in.emmc
  
#write.csv(pH_in.emmc, "FLK_results/Model_5_LTpH_POST.csv")
```

```{r}
# Predict values  
  In_pH_Pred <- predict(pH_in, newdata=In_Newdata, 
                        re.form=NA, level=0, asList = FALSE)
    In_pH_Pred <-cbind(In_Newdata, In_pH_Pred)
  In_pH_Pred$Date<-as.Date(as.character(In_pH_Pred$Year), format = "%Y")
  
# Model summary for slope labels 
  # slope<-round(
  #     summary(pH_in)$coefficients["Year", "Estimate"], digits = 3)
  # xs <- as.Date(as.character("2018-11-20"))
  # ys <- max(Trends.inshore$pH_calculated, na.rm =T)
  # plot_label <- sprintf("\"\" ~ pH == %0.3f", slope)
  # plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  In_pH_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(name=(expression(pH[calculated])),
                       limits=c(7.80, 8.28),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.inshore, 
                               aes(y=pH_calculated, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region),  
                                alpha=0.5, size=0.5,shape=21)+
      geom_line(data=In_pH_Pred, aes(y = In_pH_Pred, x=Date,  colour = Sub_region),
                                linetype=2, size=1) #+
      #annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
      #        label =paste0(as.character(plot_label, plot_label2, sep = " ")),
      #        size=4)
  In_pH_Modeled
  
```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$pH_calculated)
shapiro.test(Trends.midchanel$pH_calculated)# Normality rejected

pH_mc_0<-lmer(pH_calculated~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.midchanel)
  #summary(pH_mc_0)    
  anova(pH_mc_0)
  ranova(pH_mc_0)
  step(pH_mc_0)

pH_mc<-lmer(pH_calculated ~ Year + Sub_region + (1 | Month),
            data = Trends.midchanel)
  summary(pH_mc)
  anova(pH_mc)
  plot(pH_mc)
  qqnorm(resid(pH_mc))
  acf(resid(pH_mc), main="acf(resid(pH Mid Channel))")  
  pH_mc.emmc<-emmeans(pH_mc, ~Sub_region)
        pH_mc.emmc<-multcomp::cld(pH_mc.emmc)
        pH_mc.emmc<-pH_mc.emmc[order(pH_mc.emmc$Sub_region),]
  pH_mc.emmc
  
  #write.csv(pH_mc.emmc, "FLK_results/Model_6_LTpH_POST.csv")
```

```{r}
# Predict values  
  Mc_pH_Pred <- predict(pH_mc, newdata=Mc_Newdata, 
                        re.form=NA, level=0, asList = FALSE)
  Mc_pH_Pred <-cbind(Mc_Newdata, Mc_pH_Pred)
  Mc_pH_Pred$Date<-as.Date(as.character(Mc_pH_Pred$Year), format = "%Y")
  
# Model summary for slope labels 
  slope<-round(
      summary(pH_mc)$coefficients["Year", "Estimate"], digits = 3)
  #xs <- as.Date(as.character("2018-11-20"))
  #ys <- max(Trends.inshore$pH_calculated, na.rm =T)
  ys <- max(Trends.midchanel$pH_calculated, na.rm =T)+0.03
  plot_label <- sprintf("\"\" ~ pH == %0.3f", slope)
  plot_label2 <- expression("Year^-1")
  
# Plot raw data point and fitted model 
  Mc_pH_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(name=(expression(pH[calculated])),
                       breaks = seq(0, 10, 0.1),  
                       limits=c(7.80, 8.28),
                       expand = c(0.02, 0.02)) +
    
      geom_point(data=Trends.midchanel, 
                               aes(y=pH_calculated, x=Date, 
                                   #fill = Sub_region), 
                                colour = Sub_region),  
                                alpha=0.5, size=0.5, shape=23)+
      geom_line(data=Mc_pH_Pred, aes(y = Mc_pH_Pred, x=Date,  colour = Sub_region),
                                linetype=1, size=1) +
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
           label =paste0(as.character(plot_label, plot_label2, sep = " ")),
           size=4)
  Mc_pH_Modeled
  
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$pH_calculated)
shapiro.test(Trends.offshore$pH_calculated)# Normality rejected

pH_of_0<-lmer(pH_calculated~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(pH_of_0)    
  anova(pH_of_0)
  ranova(pH_of_0)
  step(pH_of_0)

pH_of<-lmer(pH_calculated ~ Year + Sub_region + (1 | Month), 
            data =Trends.offshore)
  summary(pH_of)    
   anova(pH_of)
   plot(pH_of)
  qqnorm(resid(pH_of))
  acf(resid(pH_of), main="acf(resid(pH Offshore))")
  
  pH_of.emmc<-emmeans(pH_of, ~Sub_region)
        pH_of.emmc<-multcomp::cld(pH_of.emmc)
        pH_of.emmc<-pH_of.emmc[order(pH_of.emmc$Sub_region),]
  pH_of.emmc

 #write.csv(pH_of.emmc, "FLK_results/Model_7_LTpH_POST.csv")
```

```{r}
# Predict values  
  Of_pH_Pred <- predict(pH_of, newdata=Of_Newdata, 
                        re.form=NA, level=0, asList = FALSE)
  Of_pH_Pred <-cbind(Of_Newdata, Of_pH_Pred)
  Of_pH_Pred$Date<-as.Date(as.character(Of_pH_Pred$Year), format = "%Y")

# Model summary for slope labels 
  slope<-round(
      summary(pH_of)$coefficients["Year", "Estimate"], digits = 3)
  #ys <- max(Trends.inshore$pH_calculated, na.rm =T)
  ys <- max(Trends.offshore$pH_calculated, na.rm =T)+0.08
  plot_label <- sprintf("\"\" ~ pH == %0.3f", slope)
  plot_label2 <- expression("Year^-1")  
  
# Plot raw data point and fitted model 
  Of_pH_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(name=(expression(pH[calculated])),
                      limits=c(7.88, 8.2),
                      # limits=c(7.80, 8.28),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0, 0.01)) +
    
      geom_point(data=Trends.offshore, 
                               aes(y=pH_calculated, x=Date, 
                                   #fill = Sub_region), 
                                  colour = Sub_region),  
                               alpha=0.5, size=0.5, shape=24)+
      geom_line(data=Of_pH_Pred, aes(y = Of_pH_Pred, x=Date,  colour = Sub_region),
                                linetype=1, size=1) +
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
           label =paste0(as.character(plot_label, plot_label2, sep = " ")),
           size=4)
  Of_pH_Modeled
  
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$pH_calculated)
shapiro.test(Trends.ocean$pH_calculated)# Normality rejected

pH_oc_0<-lmer(pH_calculated ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(pH_oc_0)    
  anova(pH_oc_0)
  ranova(pH_oc_0)
  step(pH_oc_0)

pH_oc<-lmer(pH_calculated ~ Year + (1 | Month),
               data=Trends.ocean)
  summary(pH_oc)    
  anova(pH_oc) 
  plot(pH_oc)
  qqnorm(resid(pH_oc))
  acf(resid(pH_oc), main="acf(resid(pH ocean))")
  pH_oc.emmc<-emmeans(pH_oc, ~Year)
        pH_oc.emmc<-multcomp::cld(pH_oc.emmc)
        #pH_oc.emmc<-pH_oc.emmc[order(pH_oc.emmc$Sub_region),]
  pH_oc.emmc
```

```{r}
# Predict values  
  Oc_pH_Pred <- predict(pH_oc, newdata=Oc_Newdata,
                        re.form=NA, level=0, asList = FALSE)
  Oc_pH_Pred <-cbind(Oc_Newdata, Oc_pH_Pred)
  Oc_pH_Pred$Date<-as.Date(as.character(Oc_pH_Pred$Year), format = "%Y")

# Model summary for slope labels 
  slope<-round(
      summary(pH_oc)$coefficients["Year", "Estimate"], digits = 3)
  #ys <- max(Trends.inshore$pH_calculated, na.rm =T)
  ys <- max(Trends.offshore$pH_calculated, na.rm =T)+0.08
  plot_label <- sprintf("\"\" ~ pH == %0.3f", slope)
  plot_label2 <- expression("Year^-1")  
  
# Plot raw data point and fitted model 
  Oc_pH_Modeled<-Long_plot2+ #facet_grid(~Zone)+
     scale_y_continuous(name=(expression(pH[calculated])),
                      limits=c(7.88, 8.2),
                      # limits=c(7.80, 8.28),
                       breaks = seq(0, 10, 0.1),  
                       expand = c(0, 0.01)) +
    
      geom_point(data=Trends.ocean, 
                               aes(y=pH_calculated, x=Date, #fill = Sub_region), 
                                  colour = Sub_region),  
                                alpha=0.5, size=0.5, shape=25)+
      geom_line(data=Oc_pH_Pred, aes(y = Oc_pH_Pred, x=Date),
                                linetype=1, size=1, colour = "black") +
      annotate(geom="text", x = as.Date(xs), y = ys, parse=TRUE,
           label =paste0(as.character(plot_label, plot_label2, sep = " ")),
           size=4)
  Oc_pH_Modeled
  
```

## Models summary

Complete models

```{r, , all fixed factors summary - pH}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.pH_in_0 <- data.frame (anova(pH_in_0))
    av.pH_mc_0 <- data.frame (anova(pH_mc_0) )
    av.pH_of_0 <- data.frame (anova(pH_of_0))
    av.pH_oc_0 <- data.frame (anova(pH_oc_0))
    
    # Putting all into one dataframe/table
    anova_pH <- data.frame(cbind
                    (c("Year", "Sub_region", "Year:Sub_region", 
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region"), 
                         rbind(av.pH_in_0, av.pH_mc_0,
                         av.pH_of_0, av.pH_oc_0))) 
    colnames(anova_pH) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_pH) <- NULL
  
  # create HTML table using kableExtra
  anova_pH %>% kable("html", digits=2) %>% 
  kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "pH inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "pH mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "pH offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "pH ocean", 10, 12)  
```

```{r}

# R-ANOVAs    
    rav.pH_in_0 <- data.frame (ranova(pH_in_0))
    rav.pH_mc_0 <- data.frame (ranova(pH_mc_0) )
    rav.pH_of_0 <- data.frame (ranova(pH_of_0))
    rav.pH_oc_0 <- data.frame (ranova(pH_oc_0))
    
    # Putting all into one dataframe/table
    ranova_pH <- data.frame(cbind
                    (c("<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)",
                       "<none>", "(1 | Month)", "(1 | SiteID)"), 
                      rbind(rav.pH_in_0, rav.pH_mc_0,
                            rav.pH_of_0, rav.pH_oc_0))) 
    colnames(ranova_pH) <- c("", "npar", "logLik", "AIC" , "LRT",
                                     "DF", "Pr(>Chi Sq)")
    row.names(ranova_pH) <- NULL
    
    # create HTML table using kableExtra
    ranova_pH %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "pH inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "pH mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "pH offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "pH ocean", 10, 12)  

```

```{r}
pH_models_0<-list("Inshore" = pH_in_0, 
                   "Mid channel" = pH_mc_0, 
                   "Offshore" = pH_of_0, 
                   "Ocean" = pH_oc_0)
modelsummary(pH_models_0, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pH model outputs (all factors)',
             coef_map=factor_order)
#modelsummary(pH_models, estimate = "p.value")
```

Factors removed models

```{r}
pH_models<-list("Inshore" = pH_in, 
                   "Mid channel" = pH_mc, 
                   "Offshore" = pH_of, 
                   "Ocean" = pH_oc)
modelsummary(pH_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'pH model outputs (factors dropped)',
             coef_map=factor_order)

#modelsummary(pH_models, estimate = "p.value")

```

```{r, pH model plot}
Trends_pH<-ggarrange(In_pH_Modeled+ theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 legend.position = "none"),
                  Mc_pH_Modeled + theme(legend.position = "none",
                                 axis.text.x=element_blank(),
                                  axis.title.y=element_blank()),
                                
                  Of_pH_Modeled + theme(legend.position = "none",
                                        axis.text.x=element_blank(),
                                        axis.title.y=element_blank()),
                                
                  Oc_pH_Modeled + theme(legend.position = "none",
                                        axis.text.x=element_blank(),
                                        axis.title.y=element_blank()),
                  
          labels = c("B"),
          ncol = 4, nrow = 1, widths =c(1.1, 1, 1, 1))
Trends_pH
```

# TA-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$TA_umol_kg)
shapiro.test(Trends.data$TA_umol_kg)# Normality rejected

TA_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste("TA (", mu, "mol ", kg^-1, ")")),
                      breaks = seq(0, 3000, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=TA_umol_kg, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

TA_all+
  geom_smooth(aes (x=Date, y=TA_umol_kg),
              method = "lm", color="black")
TA_all + facet_grid(~Zone) +
    geom_smooth(aes (x=Date, y=TA_umol_kg),
              method = "lm", color="black")

TA_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=TA_umol_kg, colour=Sub_region),
              method = "lm", alpha=0.3)

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore TA
hist(Trends.inshore$TA_umol_kg)
shapiro.test(Trends.inshore$TA_umol_kg)# Normality rejected

TA_in_0<-lmer(TA_umol_kg~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.inshore)
  #summary(TA_in_0)    
  anova(TA_in_0)
  ranova(TA_in_0)
  step(TA_in_0)

TA_in<-lmer(TA_umol_kg ~ Sub_region + (1 | Month), 
            data=Trends.inshore)
  summary(TA_in)    
  plot(TA_in)
  qqnorm(resid(TA_in))
  acf(resid(TA_in), main="acf(resid(TA Inshore))") 

  TA_in.emmc<-emmeans(TA_in, ~Sub_region)
        TA_in.emmc<-multcomp::cld(TA_in.emmc)
        TA_in.emmc<-TA_in.emmc[order(TA_in.emmc$Sub_region),]
  TA_in.emmc
```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$TA_umol_kg)
shapiro.test(Trends.midchanel$TA_umol_kg)# Normality rejected

TA_mc_0<-lmer(TA_umol_kg~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
            data=Trends.midchanel)
  #summary(TA_mc_0)    
  anova(TA_mc_0)
  ranova(TA_mc_0)
  step(TA_mc_0)

TA_mc<-lmer(TA_umol_kg ~ (1 | Month) + (1|SiteID), 
            data = Trends.midchanel)
  summary(TA_mc) 
  plot(TA_mc)
  qqnorm(resid(TA_mc))
  acf(resid(TA_mc), main="acf(resid(TA Mid Channel))") 
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$TA_umol_kg)
shapiro.test(Trends.offshore$TA_umol_kg)# Normality rejected

TA_of_0<-lmer(TA_umol_kg~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(TA_of_0)    
  anova(TA_of_0)
  ranova(TA_of_0)
  step(TA_of_0)

TA_of<-lmer(TA_umol_kg ~ Year + Sub_region + (1 | Month), 
            data =Trends.offshore)
  summary(TA_of)    
  plot(TA_of)
  qqnorm(resid(TA_of))
  acf(resid(TA_of), main="acf(resid(TA Offshore))") 
  
  TA_of.emmc<-emmeans(TA_of, ~Sub_region)
        TA_of.emmc<-multcomp::cld(TA_of.emmc)
        TA_of.emmc<-TA_of.emmc[order(TA_of.emmc$Sub_region),]
  TA_of.emmc

```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$TA_umol_kg)
shapiro.test(Trends.ocean$TA_umol_kg)# Normality NOT rejected

TA_oc_0<-lmer(TA_umol_kg ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(TA_oc_0)    
  anova(TA_oc_0)
  ranova(TA_oc_0)
  step(TA_oc_0)

TA_oc<-lmer(TA_umol_kg ~ (1 | Month), 
            data = Trends.ocean)
  summary(TA_oc)    
  plot(TA_oc)
  qqnorm(resid(TA_oc))
  acf(resid(TA_oc), main="acf(resid(TA_Ocean))")
  
  # TA_oc.emmc<-emmeans(TA_oc, ~Sub_region)
  #       TA_oc.emmc<-multcomp::cld(TA_oc.emmc)
  #       TA_oc.emmc<-TA_oc.emmc[order(TA_oc.emmc$Sub_region),]
  # TA_oc.emmc
```

## Models summary

Complete models

```{r}
# ANOVAs
    # Convert ANOVA results into dataframes allows for easier name manipulation
    av.TA_in_0 <- data.frame (anova(TA_in_0))
    av.TA_mc_0 <- data.frame (anova(TA_mc_0) )
    av.TA_of_0 <- data.frame (anova(TA_of_0))
    av.TA_oc_0 <- data.frame (anova(TA_oc_0))
    
    # Putting all into one dataframe/table
    anova_TA_0 <- data.frame(cbind
                    (c("Year", "Sub_region", "Year:Sub_region", 
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region",
                       "Year", "Sub_region", "Year:Sub_region"), 
                                      rbind(av.TA_in_0, av.TA_mc_0,
                                            av.TA_of_0, av.TA_oc_0))) 
    colnames(anova_TA_0) <- c("", "Sum Sq", "Mean Sq", "N Df" , "D Df",
                                     "F value", "Pr(>F)")
    row.names(anova_TA_0) <- NULL
    
    # create HTML table using kableExtra
    anova_TA_0 %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "TA inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "TA mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "TA offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "TA ocean", 10, 12)  
```

```{r}

# R-ANOVAs    
    rav.TA_in_0 <- data.frame (ranova(TA_in_0))
    rav.TA_mc_0 <- data.frame (ranova(TA_mc_0) )
    rav.TA_of_0 <- data.frame (ranova(TA_of_0))
    rav.TA_oc_0 <- data.frame (ranova(TA_oc_0))
    
# Putting all into one dataframe/table
  ranova_TA_0 <- data.frame(cbind
                  (c("<none>", "(1 | Month)", "(1 | SiteID)",
                     "<none>", "(1 | Month)", "(1 | SiteID)",
                     "<none>", "(1 | Month)", "(1 | SiteID)",
                     "<none>", "(1 | Month)", "(1 | SiteID)"), 
               rbind(rav.TA_in_0, rav.TA_mc_0,
                            rav.TA_of_0, rav.TA_oc_0))) 
    colnames(ranova_TA_0) <- c("", "npar", "logLik", "AIC" , "LRT",
                                     "DF", "Pr(>Chi Sq)")
    row.names(ranova_TA_0) <- NULL
    
    # create HTML table using kableExtra
    ranova_TA_0 %>% kable("html", digits=2) %>% 
      kable_styling(bootstrap_options = "striped", full_width = F) %>% 
      pack_rows(., "TA inshore", 1, 3) %>% # groups rows with label
      pack_rows(., "TA mid-channel", 4, 6)  %>% # groups rows with label
      pack_rows(., "TA offshore", 7, 9) %>% # groups rows with label
      pack_rows(., "TA ocean", 10, 12)
```

```{r}
TA_models_0<-list("Inshore" = TA_in_0, 
                   "Mid channel" = TA_mc_0, 
                   "Offshore" = TA_of_0, 
                   "Ocean" = TA_oc_0)
modelsummary(TA_models_0, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'TA model outputs (all factors)',
             coef_map=factor_order)
#modelsummary(TA_models, estimate = "p.value")
```

Factors removed models

```{r}
TA_models<-list("Inshore" = TA_in, 
                   "Mid channel" = TA_mc, 
                   "Offshore" = TA_of, 
                   "Ocean" = TA_oc)
modelsummary(TA_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'TA model outputs (dropped facators)',
             coef_map=factor_order)
#modelsummary(TA_models, estimate = "p.value")
```

# DIC-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Trends.data$DIC_umol_kg)
shapiro.test(Trends.data$DIC_umol_kg)# Normality rejected

DIC_all<- Long_plot+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste("DIC (", mu, "mol ", ~kg^-1, ")")),
                      breaks = seq(0, 3000, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=DIC_umol_kg, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)
    

DIC_all + 
  geom_smooth(aes (x=Date, y=DIC_umol_kg), method = "lm", color="black")

DIC_all + facet_grid(~Zone) + geom_smooth(aes (x=Date, y=DIC_umol_kg), method = "lm", color="black")

DIC_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=DIC_umol_kg, colour=Sub_region), method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
hist(Trends.inshore$DIC_umol_kg)
shapiro.test(Trends.inshore$DIC_umol_kg)# Normality NOT rejected

# Inshore DIC
DIC_in<-lmer(DIC_umol_kg~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.inshore)
  #summary(DIC_in)    
  anova(DIC_in)
  ranova(DIC_in)
  step(DIC_in)

DIC_in<-lmer(DIC_umol_kg ~ Year + Sub_region +
               (1|Month) + (1|SiteID), data=Trends.inshore)
  summary(DIC_in)    
  plot(DIC_in)
  qqnorm(resid(DIC_in))
  acf(resid(DIC_in), main="acf(resid(DIC Inshore))") 
  
  DIC_in.emmc<-emmeans(DIC_in, ~Sub_region+Year)
         DIC_in.emmc<-multcomp::cld(DIC_in.emmc)
         DIC_in.emmc<-DIC_in.emmc[order(DIC_in.emmc$Sub_region),]
  DIC_in.emmc

```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$DIC_umol_kg)
shapiro.test(Trends.midchanel$DIC_umol_kg)# Normality rejected

DIC_mc<-lmer(DIC_umol_kg~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(DIC_mc)    
  anova(DIC_mc)
  ranova(DIC_mc)
  step(DIC_mc)

DIC_mc<-lmer(DIC_umol_kg ~ Year + Sub_region + (1 | Month), 
             data = Trends.midchanel)
  summary(DIC_mc) 
  plot(DIC_mc)
  qqnorm(resid(DIC_mc))
  acf(resid(DIC_mc), main="acf(resid(DIC Mid Channel))") 
  
  DIC_mc.emmc<-emmeans(DIC_mc, ~Sub_region+Year)
         DIC_mc.emmc<-multcomp::cld(DIC_mc.emmc)
         DIC_mc.emmc<-DIC_mc.emmc[order(DIC_mc.emmc$Sub_region),]
  DIC_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$DIC_umol_kg)
shapiro.test(Trends.offshore$DIC_umol_kg)# Normality rejected

DIC_of<-lmer(DIC_umol_kg~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(DIC_of)    
  anova(DIC_of)
  ranova(DIC_of)
  step(DIC_of)

DIC_of<-lmer(DIC_umol_kg ~ Year + Sub_region + (1 | Month),
             data =Trends.offshore)
  summary(DIC_of)
  plot(DIC_of)
  qqnorm(resid(DIC_of))
  acf(resid(DIC_of), main="acf(resid(DIC Offshore))") 
  
  DIC_of.emmc<-emmeans(DIC_of, ~Sub_region+Year)
         DIC_of.emmc<-multcomp::cld(DIC_of.emmc)
         DIC_of.emmc<-DIC_of.emmc[order(DIC_of.emmc$Sub_region),]
  DIC_of.emmc
```

## Oceanic

```{r, fig.height=4, fig.width=4}
hist(Trends.ocean$DIC_umol_kg)
shapiro.test(Trends.ocean$DIC_umol_kg)# Normality rejected

DIC_oc<-lmer(DIC_umol_kg ~ Year * Sub_region + 
               (1 | Month)+ (1|SiteID),
               data=Trends.ocean)
  #summary(DIC_oc)    
  anova(DIC_oc)
  ranova(DIC_oc)
  step(DIC_oc)

DIC_oc<-lmer(DIC_umol_kg ~ Year+ (1 | Month), data = Trends.ocean)
  summary(DIC_oc)    
  plot(DIC_oc)
  qqnorm(resid(DIC_oc))
  acf(resid(DIC_oc), main="acf(resid(DIC open))")
  
  DIC_oc.emmc<-emmeans(DIC_oc, ~Year)
         DIC_oc.emmc<-multcomp::cld(DIC_oc.emmc)
         #DIC_oc.emmc<-DIC_oc.emmc[order(DIC_oc.emmc$Sub_region),]
  DIC_oc.emmc
```

## Models summary

```{r}
DIC_models<-list("Inshore" = DIC_in, 
                   "Mid channel" = DIC_mc, 
                   "Offshore" = DIC_of, 
                   "Ocean" = DIC_oc)
modelsummary(DIC_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'DIC model outputs',
             coef_map=factor_order)
#modelsummary(DIC_models, estimate = "p.value")
```

# dTA-All

```{r}
Long_plot2<- ggplot(Reef.Trends.data) +
        MyTheme +  
        #scale_shape_manual(values=c(24, 25, 21))+
        #guides(fill=guide_legend(override.aes=list(shape=21)))+
        theme(axis.title.x = element_blank())
```

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Reef.Trends.data$dTA_MY)
shapiro.test(Reef.Trends.data$dTA_MY)# Normality rejected

dTA_all<- Long_plot2+
    scale_y_continuous(#limits = c(15,40),
                      breaks = seq(-500, 500, 100),
                      name=expression(paste(Delta, " TA (", mu, "mol ", ~kg^-1, ")")),
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=dTA_MY, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

dTA_all +
    geom_smooth(aes (x=Date, y=dTA_MY), method = "lm",
                color="black")

dTA_all+facet_grid(~Zone)+ 
    geom_smooth(aes (x=Date, y=dTA_MY), method = "lm",
                color="black")

dTA_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=dTA_MY, colour=Sub_region),
              method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore dTA
hist(Trends.inshore$dTA_MY)
shapiro.test(Trends.inshore$dTA_MY)# Normality rejected


dTA_in<-lmer(dTA_MY ~ Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.inshore)
  #summary(dTA_in)    
  anova(dTA_in)
  ranova(dTA_in)
  step(dTA_in)

dTA_in<-lmer(dTA_MY ~ Sub_region + (1 | Month),
             data=Trends.inshore)
  summary(dTA_in)    
  plot(dTA_in)
  qqnorm(resid(dTA_in))
  acf(resid(dTA_in), main="acf(resid(dTA Inshore))")
  
  dTA_in.emmc<-emmeans(dTA_in, ~Sub_region)
         dTA_in.emmc<-multcomp::cld(dTA_in.emmc)
         dTA_in.emmc<-dTA_in.emmc[order(dTA_in.emmc$Sub_region),]
  dTA_in.emmc
```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$dTA_MY)
shapiro.test(Trends.midchanel$dTA_MY)# Normality rejected

dTA_mc<-lmer(dTA_MY~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID),
             data=Trends.midchanel)
  #summary(dTA_mc)    
  anova(dTA_mc)
  ranova(dTA_mc)
  step(dTA_mc)

dTA_mc<-lmer(dTA_MY ~ (1 | Month) + (1|SiteID), 
             data = Trends.midchanel)
  summary(dTA_mc) 
  plot(dTA_mc)
  qqnorm(resid(dTA_mc))
  acf(resid(dTA_mc), main="acf(resid(dTA Mid Channel))") 
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$dTA_MY)
shapiro.test(Trends.offshore$dTA_MY)# Normality rejected

dTA_of<-lmer(dTA_MY~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(dTA_of)    
  anova(dTA_of)
  ranova(dTA_of)
  step(dTA_of)

dTA_of<-lmer(dTA_MY ~ Sub_region + (1 | Month), 
             data =Trends.offshore)
  summary(dTA_of)    
  plot(dTA_of)
  qqnorm(resid(dTA_of))
  acf(resid(dTA_of), main="acf(resid(dTA Offshore))") 
  
  dTA_of.emmc<-emmeans(dTA_of, ~Sub_region)
         dTA_of.emmc<-multcomp::cld(dTA_of.emmc)
         dTA_of.emmc<-dTA_of.emmc[order(dTA_of.emmc$Sub_region),]
  dTA_of.emmc
```

## Models summary

```{r}
dTA_models<-list("Inshore" = dTA_in, 
                   "Mid channel" = dTA_mc, 
                   "Offshore" = dTA_of)
modelsummary(dTA_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'dTA model outputs',
             coef_map=factor_order)
#modelsummary(dTA_models, estimate = "p.value")
```

# dDIC-All

```{r, echo=FALSE, fig.height=5, fig.width=8}
hist(Reef.Trends.data$dDIC_MY)
shapiro.test(Reef.Trends.data$dDIC_MY)# Normality rejected

dDIC_all<- Long_plot2+
    scale_y_continuous(#limits = c(15,40),
                      name=expression(paste(Delta, " DIC (", mu, "mol ", ~kg^-1, ")")),
                      breaks = seq(-900, 900, 100),  
                      expand = c(0.05, 0.05)) +
    geom_point(aes (x=Date, y=dDIC_MY, fill=Precipitation), 
             alpha=0.8, size=1, shape=21)

dDIC_all+ 
    geom_smooth(aes (x=Date, y=dDIC_MY),
                method = "lm", color="black")

dDIC_all + facet_grid(~Zone) + geom_smooth(aes (x=Date, y=dDIC_MY),
                method = "lm", color="black")

dDIC_all+facet_grid(~Zone) +
  geom_smooth(aes (x=Date, y=dDIC_MY, colour=Sub_region),
              method = "lm")

```

## Inshore

```{r, fig.height=4, fig.width=4}
# Inshore dDIC
hist(Trends.inshore$dDIC_MY)
shapiro.test(Trends.inshore$dDIC_MY)# Normality rejected

dDIC_in<-lmer(dDIC_MY~Year * Sub_region + (1|Month)+
                                  #(1|Zone)+             
                                  (1|SiteID), 
              data=Trends.inshore)
  #summary(dDIC_in)    
  anova(dDIC_in)
  ranova(dDIC_in)
  step(dDIC_in)
  
dDIC_in<-lmer(dDIC_MY ~ Sub_region + (1 | Month)+ (1 | SiteID),
              data=Trends.inshore)
  summary(dDIC_in)    
  plot(dDIC_in)
  qqnorm(resid(dDIC_in))
  acf(resid(dDIC_in), main="acf(resid(dDIC Inshore))") 
  
  dDIC_in.emmc<-emmeans(dDIC_in, ~Sub_region)
         dDIC_in.emmc<-multcomp::cld(dDIC_in.emmc)
         dDIC_in.emmc<-dDIC_in.emmc[order(dDIC_in.emmc$Sub_region),]
  dDIC_in.emmc
```

## Mid channel

```{r, fig.height=4, fig.width=4}
hist(Trends.midchanel$dDIC_MY)
shapiro.test(Trends.midchanel$dDIC_MY)# Normality rejected

dDIC_mc<-lmer(dDIC_MY~Year * Sub_region + (1|Month) + 
                                  #(1|Zone)+             
                                  (1|SiteID), data=Trends.midchanel)
  #summary(dDIC_mc)    
  anova(dDIC_mc)
  ranova(dDIC_mc)
  step(dDIC_mc)

dDIC_mc<-lmer(dDIC_MY ~ Sub_region + (1 | Month),
              data = Trends.midchanel)
  summary(dDIC_mc) 
  plot(dDIC_mc) 
  qqnorm(resid(dDIC_mc))
  acf(resid(dDIC_mc), main="acf(resid(dDIC Mid Channel))") 
  
  dDIC_mc.emmc<-emmeans(dDIC_mc, ~Sub_region)
         dDIC_mc.emmc<-multcomp::cld(dDIC_mc.emmc)
         dDIC_mc.emmc<-dDIC_mc.emmc[order(dDIC_mc.emmc$Sub_region),]
  dDIC_mc.emmc
```

## Offshore

```{r, fig.height=4, fig.width=4}
hist(Trends.offshore$dDIC_MY)
shapiro.test(Trends.offshore$dDIC_MY)# Normality rejected

dDIC_of<-lmer(dDIC_MY~Year * Sub_region + 
               (1|Month) + (1|SiteID),
               data=Trends.offshore)
  #summary(dDIC_of)    
  anova(dDIC_of)
  ranova(dDIC_of)
  step(dDIC_of)

dDIC_of<-lmer(dDIC_MY ~ Year+ Sub_region + (1 | Month), 
              data =Trends.offshore)
  summary(dDIC_of)    
  plot(dDIC_of)
  qqnorm(resid(dDIC_of))
  acf(resid(dDIC_of), main="acf(resid(dDIC Offshore))") 
  
  dDIC_of.emmc<-emmeans(dDIC_of, ~Sub_region+Year)
         dDIC_of.emmc<-multcomp::cld(dDIC_of.emmc)
         dDIC_of.emmc<-dDIC_of.emmc[order(dDIC_of.emmc$Sub_region),]
  dDIC_of.emmc

```

## Models summary

```{r}
dDIC_models<-list("Inshore" = dDIC_in, 
                   "Mid channel" = dDIC_mc, 
                   "Offshore" = dDIC_of)
modelsummary(dDIC_models, stars = TRUE, 
             #statistic = c('std.error', 'p.value', 'conf.int'),
             title = 'dDIC model outputs',
             coef_map=factor_order)
#modelsummary(dDIC_models, estimate = "p.value")
```

# Figure 2: Trends

Raw data lm

```{r}
Trends_H<-ggarrange(Trends_a+ theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 legend.position = "none"),
                  Trends_b+ theme(legend.position = "none",
                                 axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 strip.text.x = element_blank()),
                  Trends_c + theme(legend.position = "bottom",
                                 strip.text.x = element_blank()),
          labels = c("A", "B", "C"),
          ncol = 1, nrow = 3, heights = c(0.9, 0.9, 1.2))
Trends_H

Trends_H2<-ggarrange(Trends_a2+ theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 legend.position = "none"),
                  Trends_b2+ theme(legend.position = "none",
                                 axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 strip.text.x = element_blank()),
                  Trends_c2 + theme(legend.position = "bottom",
                                 strip.text.x = element_blank()),
          labels = c("A", "B", "C"),
          ncol = 1, nrow = 3, heights = c(0.9, 0.9, 1.2))
Trends_H2

TrendsV<-ggarrange(Trends_a+ 
                     facet_grid(Zone~., scales = "free_y")+
                     theme(legend.position = "none",
                           panel.spacing = unit(0.6, "cm")),
                  Trends_b+ 
                    facet_grid(Zone~., scales = "free_y")+
                    theme(legend.position = "none",
                              panel.spacing = unit(0.6, "cm")),
                  Trends_c + 
                    facet_grid(Zone~., scales = "free_y")+
                    theme(legend.position = "none", 
                          panel.spacing = unit(0.6, "cm")),
          labels = c("A", "B", "C"),
          ncol = 3, nrow = 1)
#TrendsV
#ggsave(file="FLK_results/Fig_2_Trends.svg", plot=TrendsH, dpi = 300, width=7.5, height=7)
```

**Figure 2: Ocean acidification trends in the Florida Reef Tract.** (A) The partial pressure of the CO2, (B) pH, and (C) Aragonite saturation state (Ωar). The colors represent the biogeographical regions and the panels separate the locations by shelf zone. Text on the top of each panel shows the coefficient of change in the parameter per year (for significant trends) and the significance of the region in the model. Note the different scales between the top and bottom panels.

```{r}
Trends_Modeled<-ggarrange(
                  Trends_pCO2,
                  Trends_pH,
                  Trends_Omega,
          #labels = c("A", "B", "C"),
          ncol = 1, nrow = 3, heights = c(1.1, 0.9, 1.1))
Trends_Modeled

#ggsave(file="FLK_results/Fig_2_Trends.svg", plot=Trends_Modeled, dpi = 300, width=7.5, height=7)


#ggsave(file="FLK_results/Fig_2_Trends_ICRS.svg", plot=Trends_Modeled, dpi = 300, width=9, height=5)
```

**Figure 2: Ocean acidification trends in the Florida Reef Tract.** (A) The partial pressure of the CO2, (B) pH, and (C) Aragonite saturation state (Ωar). The colors represent the biogeographical regions and the panels separate the locations by shelf zone. Text on the top of each panel shows the coefficient of change in the parameter per year (for significant trends). Solid lines represent models with significant trends (year\<0.05). Multiple coloured lines are depicted for models where region was significant (region p\<0.05). Dashed lines represent the intercepts of models with non significant trends (year p\>0.05).

# 7. PCA

```{r}
#str(Month_Stats)
PCA_variables<-c("DIC_mean", "TA_mean", "pCO2_mean", "Ara_mean",
              "pH_mean", "Tem_mean","Sal_mean", "Season",
              "Zone", "Sub_region", "Month2")

PCA.data<-select(Month_Stats, PCA_variables)

Name<-paste(Month_Stats$Zone, Month_Stats$Sub_region, 
            Month_Stats$Month, sep = "_")
rownames(PCA.data) <- (Name)
PCA_var.names<-c("DIC", "TA", "pCO2", "Ara",
              "pH", "Temp","Sal", "Season",
              "Zone", "Sub_region", "Month")
colnames(PCA.data) <- (PCA_var.names)
#ggpairs(PCA.data)
```

```{r}
head(PCA.data)
library(vegan)
#library(autoplot)
library(ggfortify)

CC.rda1 <- rda(PCA.data[, -(6:11)], scale=TRUE)
CC.rda2 <- prcomp(PCA.data[, -(6:11)], scale=TRUE)
summary(CC.rda1)

# Checking if the PC axes are meaningful
eigenval <- CC.rda1$CA$eig   # Here you will get the eigenvalues
sitecoord <- CC.rda1$CA$u[,1:2]   # The site coordinates along PC1 and PC2
  eig <- data.frame(eigenval)
  eig$nb <- c(1:length(eigenval))
  eig$prop <- eig$eigenval/sum(eig$eigenval)
  eig
  
# (Kaiser-Guttman)
par(mfrow=c(1,2))
  barplot(eig$eigenval, main="Eigenvalues",las=2)
  abline(h=mean(eig$eigenval),col="red")    # average eigenvalue
  legend("topright","Average eigenvalue",lwd=1,col=2,bty="n")
  
  barplot(100*eig$prop,main="% of variance",las=2)
par(mfrow=c(1,1))

autoplot(CC.rda2, data = PCA.data, colour="Season", 
                shape="Sub_region",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Zone)+MyTheme+Season_colour+Season_fill

autoplot(CC.rda2, data = PCA.data, colour="Zone", 
                shape="Sub_region",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Season)+MyTheme

autoplot(CC.rda2, data = PCA.data, colour="Sub_region", 
                shape="Zone",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_grid(~Season)+MyTheme

autoplot(CC.rda2, data = PCA.data, colour="Season", 
                shape="Zone",
         loadings = TRUE, loadings.colour = 'black',
         loadings.label = TRUE, loadings.label.size = 3,
         loadings.label.vjust = -1.0,
         loadings.label.colour="black",
         frame = TRUE, frame.type = 'norm')+
facet_wrap(~Sub_region)+MyTheme+Season_colour+Season_fill

```

# Packages used

```{r}
# Creates bibliography 
#knitr::write_bib(c(.packages()), "packages.bib")
```
